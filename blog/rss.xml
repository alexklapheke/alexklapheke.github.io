<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0">
	<channel>
		<title>Alexander Klapheke</title>
		<link>https://alexklapheke.github.io/</link>
		<description></description>
		<language>en-US</language>
		<lastBuildDate>Tue, 20 Oct 2020 17:17:57 -0400</lastBuildDate>
		<item>
			<title>Useful shell scripts</title>
			<link>https://alexklapheke.github.io/blog/publish/bash.md</link>
			<pubDate>Tue, 20 Oct 2020 16:23:10 -0400</pubDate>
	<description>
&lt;div class=&quot;epigraph&quot;&gt;
&lt;p&gt;You should have brought many things, he thought. But you did not bring them, old man. Now is no time to think of what you do not have. Think of what you can do with what there is.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;With increasingly sophisticated tools available, it may seem silly to mess around with shell scripts, which are nearly half a century old and have a clunky, unintuitive syntax. Nevertheless, shell scripts are fast, ubiquitous on UNIX-based systems, and, if they live in your &lt;code&gt;~/.bashrc&lt;/code&gt; (or equivalent) file, always at hand. Much of their power lies in the pipe operator (&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt;&lt;/code&gt;), which is basically function composition in reverse, allowing commands to be strung together without storing intermediate results. In addition, you can add custom tab completion to any function in one line with the &lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span class=&quot;bu&quot;&gt;complete&lt;/span&gt;&lt;/code&gt; command. This can make them an excellent replacement for high-level tools that, while powerful, are often built on an Indra&#8217;s net of dependencies. &lt;!-- You can even augment the functionality of existing programs with simple wrappers. --&gt; Below are some of the everyday tasks I&#8217;ve used the shell to make simpler.&lt;/p&gt;
&lt;h1 id=&quot;data-science&quot;&gt;Data science&lt;/h1&gt;
&lt;p&gt;A lot of data processing can be done using standard commands such as &lt;code&gt;cut&lt;/code&gt;, &lt;code&gt;paste&lt;/code&gt;, &lt;code&gt;column&lt;/code&gt;, &lt;code&gt;comm&lt;/code&gt;, and &lt;code&gt;combine&lt;/code&gt;. For example, the following displays the first ten lines of a CSV file of any size, even a multi-gigabyte file too large to load into pandas.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;fu&quot;&gt;head&lt;/span&gt; -10 file.csv &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;ex&quot;&gt;column&lt;/span&gt; -ts, &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;less&lt;/span&gt; -S&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here, &lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span class=&quot;ex&quot;&gt;column&lt;/span&gt; -ts,&lt;/code&gt; formats the file into columns with a comma delimiter, and &lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span class=&quot;fu&quot;&gt;less&lt;/span&gt; -S&lt;/code&gt; overflows long lines rather than wrapping them. It&#8217;s simple enough to package this into a function that can live in your &lt;code&gt;~/.bashrc&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Show the first few lines of a (potentially large) CSV file&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-2&quot; title=&quot;2&quot;&gt;&lt;span class=&quot;fu&quot;&gt;csv_head ()&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;{&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-3&quot; title=&quot;3&quot;&gt;    &lt;span class=&quot;bu&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;file=${1:?&lt;/span&gt;Usage: csv_head file [rows]&lt;span class=&quot;va&quot;&gt;}&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-4&quot; title=&quot;4&quot;&gt;    &lt;span class=&quot;fu&quot;&gt;head&lt;/span&gt; -&lt;span class=&quot;va&quot;&gt;${2:-&lt;/span&gt;10&lt;span class=&quot;va&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$file&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;ex&quot;&gt;column&lt;/span&gt; -ts, &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;less&lt;/span&gt; -S&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-5&quot; title=&quot;5&quot;&gt;&lt;span class=&quot;kw&quot;&gt;}&lt;/span&gt;&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Using &lt;code&gt;sed&lt;/code&gt; and &lt;code&gt;cut&lt;/code&gt;, we can also write a function that navigates through CSV files, &#224; la pandas&#8217; &lt;code class=&quot;sourceCode python&quot;&gt;.loc[]&lt;/code&gt; function, taking either single numbers or ranges (&lt;code&gt;1-2&lt;/code&gt;) as arguments:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Navigate through cells in a CSV file&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-2&quot; title=&quot;2&quot;&gt;&lt;span class=&quot;fu&quot;&gt;csv_loc ()&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;{&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-3&quot; title=&quot;3&quot;&gt;    &lt;span class=&quot;bu&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;file=${1:?&lt;/span&gt;Usage: csv_loc file.csv [rows] [cols]&lt;span class=&quot;va&quot;&gt;}&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-4&quot; title=&quot;4&quot;&gt;    &lt;span class=&quot;fu&quot;&gt;sed&lt;/span&gt; -n &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;${2/&lt;/span&gt;-&lt;span class=&quot;va&quot;&gt;/&lt;/span&gt;,&lt;span class=&quot;va&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;p&amp;quot;&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$file&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;cut&lt;/span&gt; -d, -f &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;${3:-&lt;/span&gt;1-&lt;span class=&quot;va&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-5&quot; title=&quot;5&quot;&gt;&lt;span class=&quot;kw&quot;&gt;}&lt;/span&gt;&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can do more interesting file processing tasks as well. For a CSV file that&#8217;s truly massive, the &lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span class=&quot;fu&quot;&gt;split&lt;/span&gt;&lt;/code&gt; utility can parse it out into equally-sized chunks, and a simple wrapper script can do this while preserving the header in each file:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;fu&quot;&gt;split_csv ()&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;{&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-2&quot; title=&quot;2&quot;&gt;    &lt;span class=&quot;bu&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;file=${1:?&lt;/span&gt;Usage: split_csv file&lt;span class=&quot;va&quot;&gt;}&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-3&quot; title=&quot;3&quot;&gt;    &lt;span class=&quot;bu&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;base=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;${file%&lt;/span&gt;.*&lt;span class=&quot;va&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-4&quot; title=&quot;4&quot;&gt;    &lt;span class=&quot;bu&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;ext=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;${file##&lt;/span&gt;*.&lt;span class=&quot;va&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-5&quot; title=&quot;5&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-6&quot; title=&quot;6&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# Write out header&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-7&quot; title=&quot;7&quot;&gt;    &lt;span class=&quot;bu&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;header=$(&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;head&lt;/span&gt; -1 &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$file&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;)&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-8&quot; title=&quot;8&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-9&quot; title=&quot;9&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# Split into 100MB chunks, minus header&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-10&quot; title=&quot;10&quot;&gt;    &lt;span class=&quot;fu&quot;&gt;tail&lt;/span&gt; +2 &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$file&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;split&lt;/span&gt; -d -C 100MB - &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$base&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;-&amp;quot;&lt;/span&gt; \&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-11&quot; title=&quot;11&quot;&gt;        --additional-suffix=&lt;span class=&quot;st&quot;&gt;&amp;quot;.&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$ext&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-12&quot; title=&quot;12&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-13&quot; title=&quot;13&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# Write header onto each chunk&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-14&quot; title=&quot;14&quot;&gt;    &lt;span class=&quot;kw&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;ex&quot;&gt;chunk&lt;/span&gt; in &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$base&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;-*.&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$ext&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-15&quot; title=&quot;15&quot;&gt;        &lt;span class=&quot;fu&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;&amp;lt;(&lt;/span&gt;&lt;span class=&quot;bu&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$header&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$chunk&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;ex&quot;&gt;sponge&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$chunk&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-16&quot; title=&quot;16&quot;&gt;    &lt;span class=&quot;kw&quot;&gt;done&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-17&quot; title=&quot;17&quot;&gt;&lt;span class=&quot;kw&quot;&gt;}&lt;/span&gt;&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now you can process the file one piece at a time.&lt;/p&gt;
&lt;h1 id=&quot;jupyter&quot;&gt;Jupyter&lt;/h1&gt;
&lt;p&gt;Of course, data analyses of any sophistication require more advanced tools. &lt;a href=&quot;https://jupyter.org/&quot;&gt;Jupyter&lt;/a&gt; notebooks are a great mini-IDE for creating &lt;a href=&quot;https://en.wikipedia.org/wiki/Literate_programming&quot;&gt;literate&lt;/a&gt; Python programs, but hard to work with in the terminal; one glaring omission is a way to create a new notebook from the command line. This script, which lives in my &lt;code&gt;~/.bashrc&lt;/code&gt;, lets me type &lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span class=&quot;ex&quot;&gt;jn&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;filename&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt; (with or without file extension) at the command line, opening the file if it exists and creating it if not.&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;fu&quot;&gt;jn ()&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;{&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-2&quot; title=&quot;2&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# Complete filename with .ipynb extension if not present&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-3&quot; title=&quot;3&quot;&gt;    &lt;span class=&quot;bu&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;filename=${1%&lt;/span&gt;.ipynb&lt;span class=&quot;va&quot;&gt;}&lt;/span&gt;.ipynb&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-4&quot; title=&quot;4&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-5&quot; title=&quot;5&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# Create notebook if it doesn&amp;#39;t already exist&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-6&quot; title=&quot;6&quot;&gt;    &lt;span class=&quot;kw&quot;&gt;if [[&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$filename&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt; ]]&lt;/span&gt;; &lt;span class=&quot;kw&quot;&gt;then&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-7&quot; title=&quot;7&quot;&gt;        &lt;span class=&quot;bu&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;#39;{&amp;quot;cells&amp;quot;: [], &amp;quot;metadata&amp;quot;: {}, &amp;quot;nbformat&amp;quot;: 4, &amp;quot;nbformat_minor&amp;quot;: 4}&amp;#39;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$filename&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-8&quot; title=&quot;8&quot;&gt;    &lt;span class=&quot;kw&quot;&gt;fi&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-9&quot; title=&quot;9&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-10&quot; title=&quot;10&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# Open notebook&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-11&quot; title=&quot;11&quot;&gt;    &lt;span class=&quot;ex&quot;&gt;jupyter-notebook&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$filename&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-12&quot; title=&quot;12&quot;&gt;&lt;span class=&quot;kw&quot;&gt;}&lt;/span&gt;&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Sometimes, though, I don&#8217;t want to start a whole Jupyter server just to examine the source code in a notebook. You can export the notebooks as pure code with &lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span class=&quot;ex&quot;&gt;jupyter-nbconvert&lt;/span&gt; --to python&lt;/code&gt;, but this is slow and include a lot of cruft like cell numbers. Fortunately, the notebooks themselves are just JSON files, and are easy to parse with a tool like &lt;a href=&quot;https://stedolan.github.io/jq/&quot;&gt;jq&lt;/a&gt;. The following function extracts the code from a notebook:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb7&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Extract code cells from a Jupyter notebook&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-2&quot; title=&quot;2&quot;&gt;&lt;span class=&quot;fu&quot;&gt;jn_src ()&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;{&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-3&quot; title=&quot;3&quot;&gt;    &lt;span class=&quot;ex&quot;&gt;jq&lt;/span&gt; -j &lt;span class=&quot;st&quot;&gt;&amp;#39;.cells[] | select(.cell_type == &amp;quot;code&amp;quot;).source[], &amp;quot;\n\n&amp;quot;&amp;#39;&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-4&quot; title=&quot;4&quot;&gt;&lt;span class=&quot;kw&quot;&gt;}&lt;/span&gt;&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This makes it easy to treat the notebooks just like &lt;code&gt;.py&lt;/code&gt; files:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb8&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Run code from Jupyter notebook&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-2&quot; title=&quot;2&quot;&gt;&lt;span class=&quot;ex&quot;&gt;jn_src&lt;/span&gt; notebook.ipynb &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;ex&quot;&gt;python3&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-3&quot; title=&quot;3&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-4&quot; title=&quot;4&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Edit in Vim&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-5&quot; title=&quot;5&quot;&gt;&lt;span class=&quot;ex&quot;&gt;jn_src&lt;/span&gt; notebook.ipynb &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;ex&quot;&gt;vim&lt;/span&gt; -c &lt;span class=&quot;st&quot;&gt;&amp;quot;setf python&amp;quot;&lt;/span&gt; -&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-6&quot; title=&quot;6&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-7&quot; title=&quot;7&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Show differences between two notebooks&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-8&quot; title=&quot;8&quot;&gt;&lt;span class=&quot;fu&quot;&gt;diff&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;&amp;lt;(&lt;/span&gt;&lt;span class=&quot;ex&quot;&gt;jn_src&lt;/span&gt; notebook1.ipynb&lt;span class=&quot;op&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;&amp;lt;(&lt;/span&gt;&lt;span class=&quot;ex&quot;&gt;jn_src&lt;/span&gt; notebook2.ipynb&lt;span class=&quot;op&quot;&gt;)&lt;/span&gt;&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Finally, you can add tab completion to both these functions to quickly navigate to your notebook files.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb9-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Tab complete files with .ipynb extension&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb9-2&quot; title=&quot;2&quot;&gt;&lt;span class=&quot;bu&quot;&gt;complete&lt;/span&gt; -o plusdirs -f -X &lt;span class=&quot;st&quot;&gt;&amp;#39;!*.ipynb&amp;#39;&lt;/span&gt; jn&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb9-3&quot; title=&quot;3&quot;&gt;&lt;span class=&quot;bu&quot;&gt;complete&lt;/span&gt; -o plusdirs -f -X &lt;span class=&quot;st&quot;&gt;&amp;#39;!*.ipynb&amp;#39;&lt;/span&gt; jn_src&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&quot;tmux&quot;&gt;tmux&lt;/h1&gt;
&lt;p&gt;Another nuisance of Jupyter is that it keeps open the terminal it was launched from for writing log output, which is rarely useful. The solution is to use &lt;a href=&quot;https://tmux.github.io/&quot;&gt;tmux&lt;/a&gt;, a &#8220;terminal multiplexer&#8221; that allows you to manage terminals by naming them, splitting them onscreen into windows, and moving them into the background (&#8220;detaching&#8221;) and foreground (&#8220;attaching&#8221;). I have a shortcut that executes &lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span class=&quot;ex&quot;&gt;tmux&lt;/span&gt; new-session -A -s Jupyter&lt;/code&gt;&#8212;this opens a &#8220;Jupyter&#8221; session, creating it if it doesn&#8217;t exist. From there, I create a new window in the session with &lt;kbd&gt;C-b c&lt;/kbd&gt;, give it a name with &lt;kbd&gt;C-b ,&lt;/kbd&gt;, and launch the notebook server with &lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span class=&quot;ex&quot;&gt;jn&lt;/span&gt;&lt;/code&gt;. I can then detach it with &lt;kbd&gt;C-b d&lt;/kbd&gt; so that it&#8217;s running in the background. If I want to close down the server, I can get back to it from any terminal with &lt;kbd&gt;C-b w&lt;/kbd&gt;.&lt;/p&gt;
&lt;p&gt;For times when I just want to jump into a detached session to close it, I have the following helper function:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb10&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb10-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Attach a detached tmux session from tmux&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb10-2&quot; title=&quot;2&quot;&gt;&lt;span class=&quot;fu&quot;&gt;t ()&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;{&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb10-3&quot; title=&quot;3&quot;&gt;    &lt;span class=&quot;bu&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;curr=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;ex&quot;&gt;tmux&lt;/span&gt; display-message -p &lt;span class=&quot;st&quot;&gt;&amp;quot;#S&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb10-4&quot; title=&quot;4&quot;&gt;    &lt;span class=&quot;ex&quot;&gt;tmux&lt;/span&gt; switch -t &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb10-5&quot; title=&quot;5&quot;&gt;    &lt;span class=&quot;ex&quot;&gt;tmux&lt;/span&gt; kill-session -t &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$curr&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb10-6&quot; title=&quot;6&quot;&gt;&lt;span class=&quot;kw&quot;&gt;}&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb10-7&quot; title=&quot;7&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb10-8&quot; title=&quot;8&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Tab complete with detached tmux sessions&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb10-9&quot; title=&quot;9&quot;&gt;&lt;span class=&quot;bu&quot;&gt;complete&lt;/span&gt; -W &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;ex&quot;&gt;tmux&lt;/span&gt; list-sessions -F &lt;span class=&quot;st&quot;&gt;&amp;quot;#{?session_attached,,#S}&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt; t&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This ability to detach windows is also invaluable when using ssh. For instance, when logging onto an &lt;a href=&quot;https://aws.amazon.com/ec2/&quot;&gt;EC2&lt;/a&gt; instance, I can attach a tmux instance on the server, name it, then detach and close the connection, coming back to it later when I think it&#8217;s almost finished. That way, I am never logged out of the server, and even if my connection breaks, the command won&#8217;t. To automate this, I put the following block in my &lt;code&gt;~/.ssh/config&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;sshconf&quot;&gt;&lt;code&gt;Host *.amazonaws.com
User ubuntu
IdentityFile ~/.ssh/aws-ssh.pem
RequestTTY force
RemoteCommand tmux new -A -s aws
LocalForward 9999 localhost:8888&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now, when I &lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span class=&quot;fu&quot;&gt;ssh&lt;/span&gt; ec2-whatever.compute.amazonaws.com&lt;/code&gt;, it will automatically log in and attach to the tmux instance called &lt;code&gt;aws&lt;/code&gt;, creating it if there is none (the &lt;code class=&quot;sshconf&quot;&gt;RequestTTY&lt;/code&gt; line is there to make sure that tmux starts in a shell). After running a command, I hit &lt;kbd&gt;C-b C-b d&lt;/kbd&gt; to detach the remote session,&lt;a href=&quot;#fn2&quot; class=&quot;footnote-ref&quot; id=&quot;fnref2&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt; and I am disconnected from the server, but the command is still running on the server.&lt;/p&gt;
&lt;p&gt;(The &lt;code class=&quot;sshconf&quot;&gt;LocalForward&lt;/code&gt; line, incidentally, sets up port forwarding for Jupyter notebooks&#8212;using one, though, means I can&#8217;t detach the remote session, as that would sever the connection between local notebook interface and remote kernel.)&lt;/p&gt;
&lt;h1 id=&quot;man-page-replacements&quot;&gt;Man page replacements&lt;/h1&gt;
&lt;p&gt;Lots of small utilities like &lt;a href=&quot;https://github.com/cheat/cheat&quot;&gt;cheat&lt;/a&gt; and &lt;a href=&quot;https://tldr.sh/&quot;&gt;tldr&lt;/a&gt; offer &#8220;example pages&#8221;, supplementing man pages by storing oft-used formulas. The pages themselves are extremely useful, making this one of my most-used commands,&lt;a href=&quot;#fn3&quot; class=&quot;footnote-ref&quot; id=&quot;fnref3&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt; but the utilities themselves tend to be on the bloated side. It&#8217;s simple enough to implement this in a few lines of BASH.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb13&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;bu&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;cheatdir=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$HOME&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;/.cheat/&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-2&quot; title=&quot;2&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-3&quot; title=&quot;3&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Easy user-defined man pages&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-4&quot; title=&quot;4&quot;&gt;&lt;span class=&quot;fu&quot;&gt;cheat ()&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;{&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-5&quot; title=&quot;5&quot;&gt;    &lt;span class=&quot;kw&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt; in&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;-e&amp;quot;&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;shift&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;$EDITOR&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;${cheatdir%&lt;/span&gt;/&lt;span class=&quot;va&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;;;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;esac&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-6&quot; title=&quot;6&quot;&gt;    &lt;span class=&quot;fu&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;${cheatdir%&lt;/span&gt;/&lt;span class=&quot;va&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;${1:?&lt;/span&gt;Usage: cheat [-e] command_name&lt;span class=&quot;va&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-7&quot; title=&quot;7&quot;&gt;&lt;span class=&quot;kw&quot;&gt;}&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-8&quot; title=&quot;8&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-9&quot; title=&quot;9&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Tab complete entries in $cheatdir&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb13-10&quot; title=&quot;10&quot;&gt;&lt;span class=&quot;bu&quot;&gt;complete&lt;/span&gt; -W &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;${cheatdir})&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt; cheat&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Just run &lt;code&gt;cheat &amp;lt;command&amp;gt;&lt;/code&gt; to view its page, and &lt;code&gt;cheat -e &amp;lt;command&amp;gt;&lt;/code&gt; to edit it.&lt;/p&gt;
&lt;p&gt;This template can be expanded on; for instance, if you want syntax highlighting, you can install &lt;a href=&quot;http://www.gnu.org/software/src-highlite/&quot;&gt;source-highlight&lt;/a&gt;, and replace &lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span class=&quot;fu&quot;&gt;cat&lt;/span&gt;&lt;/code&gt; with &lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span class=&quot;ex&quot;&gt;source-highlight&lt;/span&gt; --src-lang shell --out-format esc --input&lt;/code&gt;.&lt;/p&gt;
&lt;h1 id=&quot;passwords&quot;&gt;Passwords&lt;/h1&gt;
&lt;p&gt;I like to use &lt;a href=&quot;https://xkcd.com/936/&quot;&gt;XKCD-style&lt;/a&gt; passwords. They are memorable and secure because they draw from a massive entropy pool we already carry around in our heads: the lexicon. A typical English speaker knows on the order of &lt;span class=&quot;math inline&quot;&gt;10&lt;sup&gt;4&lt;/sup&gt;&lt;/span&gt; words &lt;span class=&quot;citation&quot; data-cites=&quot;nagy1984how&quot;&gt;[see, e.g., @nagy1984how]&lt;/span&gt;, and a typical &lt;a href=&quot;https://www.eff.org/files/2016/07/18/eff_large_wordlist.txt&quot;&gt;diceware wordlist&lt;/a&gt; contains &lt;span class=&quot;math inline&quot;&gt;6&lt;sup&gt;5&lt;/sup&gt;&#8196;=&#8196;7,&#8198;776&lt;/span&gt; of those. Choosing six words from the list, without replacement, provides &lt;span class=&quot;math inline&quot;&gt;$\log_2\left(\frac{{6^5}!}{{(6^5-6)}!}\right) \approx 77$&lt;/span&gt; bits of entropy.&lt;a href=&quot;#fn4&quot; class=&quot;footnote-ref&quot; id=&quot;fnref4&quot;&gt;&lt;sup&gt;4&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb14&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb14-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Generate a memorable passphrase of n words (default: 6)&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb14-2&quot; title=&quot;2&quot;&gt;&lt;span class=&quot;fu&quot;&gt;diceware ()&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;{&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb14-3&quot; title=&quot;3&quot;&gt;    &lt;span class=&quot;ex&quot;&gt;shuf&lt;/span&gt; --random-source=/dev/random -n &lt;span class=&quot;va&quot;&gt;${1:-&lt;/span&gt;6&lt;span class=&quot;va&quot;&gt;}&lt;/span&gt; eff_diceware.txt &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;cut&lt;/span&gt; -f 2 &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;ex&quot;&gt;paste&lt;/span&gt; -s -d &lt;span class=&quot;st&quot;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb14-4&quot; title=&quot;4&quot;&gt;&lt;span class=&quot;kw&quot;&gt;}&lt;/span&gt;&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;--random-source&lt;/code&gt; flag is important here: it provides true hardware randomness, like you&#8217;d get rolling physical dice. By default, the command uses a pseudorandom number generator, which is deterministic; these can be &lt;a href=&quot;https://www.wired.com/story/meet-alex-the-russian-casino-hacker-who-makes-millions-targeting-slot-machines/&quot;&gt;guessed&lt;/a&gt; and even &lt;a href=&quot;https://www.schneier.com/blog/archives/2007/11/the_strange_sto.html&quot;&gt;gamed&lt;/a&gt;, hurting security by making some permutations of words more likely than others.&lt;/p&gt;
&lt;p&gt;Of course, if &lt;a href=&quot;https://www.wsj.com/articles/the-man-who-wrote-those-password-rules-has-a-new-tip-n3v-r-m1-d-1502124118&quot;&gt;fatuous&lt;/a&gt; &lt;a href=&quot;https://www.microsoft.com/en-us/research/publication/where-do-security-policies-come-from/&quot;&gt;rules&lt;/a&gt; like including punctuation are enforced, you can easily generate &#8220;old-fashioned&#8221; passwords:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb15&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb15-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Generate a random password of n characters (default: 16)&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb15-2&quot; title=&quot;2&quot;&gt;&lt;span class=&quot;fu&quot;&gt;bad_password ()&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;{&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb15-3&quot; title=&quot;3&quot;&gt;    &lt;span class=&quot;fu&quot;&gt;strings&lt;/span&gt; /dev/urandom &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tr&lt;/span&gt; -d &lt;span class=&quot;st&quot;&gt;&amp;#39;[:space:]&amp;#39;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;head&lt;/span&gt; -c &lt;span class=&quot;va&quot;&gt;${1:-&lt;/span&gt;16&lt;span class=&quot;va&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;echo&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb15-4&quot; title=&quot;4&quot;&gt;&lt;span class=&quot;kw&quot;&gt;}&lt;/span&gt;&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&quot;music&quot;&gt;Music&lt;/h1&gt;
&lt;p&gt;It&#8217;s not really known for it, but Reddit is home to a huge network of &lt;a href=&quot;https://old.reddit.com/r/Music/wiki/musicsubreddits&quot;&gt;music subreddits&lt;/a&gt;, each representing a genre or subgenre, to which users post YouTube or SoundCloud links. There are services that aggregate these into an internet radio station, but it is simple enough to parse the JSON yourself and pipe it to VLC (make sure it&#8217;s running an updated version of &lt;a href=&quot;https://github.com/videolan/vlc/blob/master/share/lua/playlist/youtube.lua&quot;&gt;&lt;code&gt;youtube.lua&lt;/code&gt;&lt;/a&gt;), or your media player of choice.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb16&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb16-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Play youtube links from music subreddits&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb16-2&quot; title=&quot;2&quot;&gt;&lt;span class=&quot;fu&quot;&gt;reddit_music ()&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;{&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb16-3&quot; title=&quot;3&quot;&gt;    &lt;span class=&quot;ex&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;https://www.reddit.com/r/&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;${1:-&lt;/span&gt;listentothis&lt;span class=&quot;va&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;/.json?limit=100&amp;quot;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;\&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb16-4&quot; title=&quot;4&quot;&gt;        &lt;span class=&quot;ex&quot;&gt;jq&lt;/span&gt; -r &lt;span class=&quot;st&quot;&gt;&amp;#39;.data.children[].data.url&amp;#39;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;\&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb16-5&quot; title=&quot;5&quot;&gt;        &lt;span class=&quot;ex&quot;&gt;vlc&lt;/span&gt; --novideo --preferred-resolution=360 --network-caching=30000 - &lt;span class=&quot;kw&quot;&gt;&amp;amp;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb16-6&quot; title=&quot;6&quot;&gt;&lt;span class=&quot;kw&quot;&gt;}&lt;/span&gt;&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;--novideo&lt;/code&gt; and &lt;code&gt;--preferred-resolution=360&lt;/code&gt; flags save bandwidth by getting only the audio stream, and &lt;code&gt;--network-caching=30000&lt;/code&gt; makes sure the songs buffer long enough that there&#8217;s no lag.&lt;/p&gt;
&lt;p&gt;We can even add &#8220;stations&#8221; manually to the tab completion command as a way of bookmarking them:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb17&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb17-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Add your favorite genres here&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb17-2&quot; title=&quot;2&quot;&gt;&lt;span class=&quot;bu&quot;&gt;complete&lt;/span&gt; -W &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb17-3&quot; title=&quot;3&quot;&gt;&lt;span class=&quot;st&quot;&gt;    listentothis&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb17-4&quot; title=&quot;4&quot;&gt;&lt;span class=&quot;st&quot;&gt;    SoundsVintage&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb17-5&quot; title=&quot;5&quot;&gt;&lt;span class=&quot;st&quot;&gt;    90sAlternative&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb17-6&quot; title=&quot;6&quot;&gt;&lt;span class=&quot;st&quot;&gt;    MFPMPPJWFA&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb17-7&quot; title=&quot;7&quot;&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt; reddit_music&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you want to combine subreddits, you can just concatenate them with a plus sign (&lt;code&gt;swinghouse+triphop&lt;/code&gt;); VLC will play the top songs from both.&lt;/p&gt;
&lt;!--
# Keyboard

While some people do [go a little crazy](https://xkcd.com/1806/) remapping their keyboards, caps lock is (I hope!) a rarely used key, and anyway it&apos;s easy to make text uppercase with &lt;kbd&gt;gU&lt;/kbd&gt; in Vim and &lt;kbd&gt;M-u&lt;/kbd&gt; in Emacs and BASH.

[Ubuntu](https://help.ubuntu.com/community/ComposeKey), [OS\ X](http://lolengine.net/blog/2012/06/17/compose-key-on-os-x)

The default mappings are in `/usr/share/X11/locale/en_US.UTF-8/Compose`, but you can use custom ones by putting them in `~/.XCompose`. For example, to type the &quot;command&quot; symbol on Macs, include the line:

```
&lt;Multi_key&gt; &lt;percent&gt; &lt;percent&gt; : &quot;&#8984;&quot;
```

Now, typing &lt;kbd&gt;Caps % %&lt;/kbd&gt; (sequentially, not holding any keys down) will input that symbol.
--&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot;&gt;&lt;p&gt;The &lt;code&gt;nbformat&lt;/code&gt; and &lt;code&gt;nbformat_minor&lt;/code&gt; keys are for my version of Jupyter. For other versions, you can get the appropriate numbers with:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; nbformat&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-2&quot; title=&quot;2&quot;&gt;&lt;span class=&quot;bu&quot;&gt;print&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-3&quot; title=&quot;3&quot;&gt;    nbformat.current_nbformat,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-4&quot; title=&quot;4&quot;&gt;    nbformat.current_nbformat_minor&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-5&quot; title=&quot;5&quot;&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;a href=&quot;#fnref1&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot;&gt;&lt;p&gt;The extra prefix tells local tmux to send the command through to the server.&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn3&quot;&gt;&lt;p&gt;In fact, it ties for sixth in the past ten weeks: &lt;img src=&quot;commands-sm.svg&quot; /&gt; &lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span class=&quot;ex&quot;&gt;y&lt;/span&gt;&lt;/code&gt; is a wrapper for &lt;a href=&quot;https://youtube-dl.org/&quot;&gt;youtube-dl&lt;/a&gt;, and &lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span class=&quot;ex&quot;&gt;lyrics&lt;/span&gt;&lt;/code&gt; is a BASH script that, well, looks up song lyrics. To get these stats:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb12&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;bu&quot;&gt;history&lt;/span&gt; \&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-2&quot; title=&quot;2&quot;&gt;    &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;cut&lt;/span&gt; -d &lt;span class=&quot;st&quot;&gt;&amp;#39; &amp;#39;&lt;/span&gt; -f 4 \&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-3&quot; title=&quot;3&quot;&gt;    &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sort&lt;/span&gt; \&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-4&quot; title=&quot;4&quot;&gt;    &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;uniq&lt;/span&gt; -c \&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-5&quot; title=&quot;5&quot;&gt;    &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sort&lt;/span&gt; -n \&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-6&quot; title=&quot;6&quot;&gt;    &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;tail&lt;/span&gt; -10&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;a href=&quot;#fnref3&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn4&quot;&gt;&lt;p&gt;Assuming &lt;a href=&quot;https://en.wikipedia.org/wiki/Kerckhoffs%27s_principle&quot;&gt;Kerckhoffs&#8217;s principle&lt;/a&gt;, which I guess we&#8217;ll have to now that I&#8217;ve blogged about it.&lt;a href=&quot;#fnref4&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
	</description>
		</item>
		<item>
			<title>Instant runoff voting</title>
			<link>https://alexklapheke.github.io/blog/publish/irv.md</link>
			<pubDate>Thu, 08 Oct 2020 14:18:52 -0400</pubDate>
	<description>
&lt;style&gt;
/* .dem { background: #727ecf; color: #ffffff; padding: 0.5pt 2pt; border-radius: 3pt; }
.rep { background: #e93834; color: #ffffff; padding: 0.5pt 2pt; border-radius: 3pt; }
.ind { background: #d67c00; color: #ffffff; padding: 0.5pt 2pt; border-radius: 3pt; }
.prg { background: #c55faf; color: #ffffff; padding: 0.5pt 2pt; border-radius: 3pt; }
.grn { background: #76a254; color: #ffffff; padding: 0.5pt 2pt; border-radius: 3pt; }
.wtn { background: #666666; color: #ffffff; padding: 0.5pt 2pt; border-radius: 3pt; } */
.dem { text-decoration: underline 2px #727ecf; }
.rep { text-decoration: underline 2px #e93834; }
.ind { text-decoration: underline 2px #d67c00; }
.prg { text-decoration: underline 2px #c55faf; }
.grn { text-decoration: underline 2px #76a254; }
.wtn { text-decoration: underline 2px #666666; }
&lt;/style&gt;
&lt;div class=&quot;epigraph&quot;&gt;
&lt;p&gt;The sciences have likewise taught us to ascertain the several degrees of certainty to which we may hope to attain; [&#8230;] what are the advantages or disadvantages of various forms of election, and modes of decision dependant on the plurality of voices; the different degrees of probability which may result from such proceedings [&#8230;]. &#8212;Marquis de Condorcet&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;epigraph&quot;&gt;
&lt;p&gt;I consider it completely unimportant who in the party will vote, or how; but what is extraordinarily important is this&#8212;who will count the votes, and how. &#8212;Joseph Stalin&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;With instant-runoff voting &lt;a href=&quot;https://www.bostonglobe.com/2020/07/22/metro/should-person-with-most-number-one-votes-always-win/&quot;&gt;on the ballot&lt;/a&gt; in Massachusetts this year, I&#8217;ve been reading about the math behind voting systems. As a &lt;a href=&quot;https://plato.stanford.edu/entries/voting-methods/&quot;&gt;theoretical problem&lt;/a&gt;, the literature is rife with fascinating results and paradoxes. More pertinent, though, is what effect this measure would have on the actual political process in Massachusetts. It would be a significant change to the electoral process, so it&#8217;s worth using data to weigh the pros and cons. I don&#8217;t presume to tell anyone how to vote on 2; only to collect some of my own thoughts on the matter.&lt;/p&gt;
&lt;p&gt;Instant runoff, like all voting systems, is sometimes derided as electing the &#8220;wrong&#8221; candidate based on the voters&#8217; expressed preferences. It&#8217;s important to remember that, in the absence of either perfect unanimity, there is no single correct way to generalize a set of individual preferences into a group preference; different voting methods simply represent approximations to this, and, though some are better than others, &lt;a href=&quot;https://en.wikipedia.org/wiki/Arrow%27s_impossibility_theorem&quot;&gt;none&lt;/a&gt; &lt;a href=&quot;https://en.wikipedia.org/wiki/Gibbard%E2%80%93Satterthwaite_theorem&quot;&gt;is&lt;/a&gt; &lt;a href=&quot;https://en.wikipedia.org/wiki/Comparison_of_electoral_systems#Compliance_of_selected_single-winner_methods&quot;&gt;perfect&lt;/a&gt;.&lt;/p&gt;
&lt;!--
Arrow himself opined that [-@arrow1951social]:

&gt; it seems to make no sense to add the utility of one individual, a psychic magnitude in his mind, with the utility of another individual.
--&gt;
&lt;h1 id=&quot;instant-runoff-voting&quot;&gt;Instant Runoff Voting&lt;/h1&gt;
&lt;p&gt;Broadly speaking, there are two kinds of voting system. In &lt;strong&gt;ordinal&lt;/strong&gt; systems, voters express relative preferences, usually by ranking candidates. Ordinal methods include &lt;a href=&quot;https://en.wikipedia.org/wiki/Instant-runoff_voting&quot;&gt;instant runoff voting&lt;/a&gt;, &lt;a href=&quot;https://en.wikipedia.org/wiki/Borda_count&quot;&gt;Borda count&lt;/a&gt;, and the various &lt;a href=&quot;https://en.wikipedia.org/wiki/Condorcet_method&quot;&gt;Condorcet methods&lt;/a&gt;. The most common system, and perhaps the simplest, &lt;a href=&quot;https://en.wikipedia.org/wiki/Plurality_voting&quot;&gt;plurality voting&lt;/a&gt;,&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; is a kind of degenerate ordinal system that only looks at (and thus only asks) voters&#8217; first choices. In &lt;strong&gt;cardinal&lt;/strong&gt; systems, voters express absolute preferences, giving each individual candidate a numeric score in the case of &lt;a href=&quot;https://en.wikipedia.org/wiki/Score_voting&quot;&gt;range voting&lt;/a&gt;, or a binary yes or no in the case of &lt;a href=&quot;https://en.wikipedia.org/wiki/Approval_voting&quot;&gt;approval voting&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Instant runoff (hereafter IRV) was developed in the 1870s by William Ware, an architect who also designed Harvard&#8217;s beautiful Gothic-revival &lt;a href=&quot;https://sites.fas.harvard.edu/~memhall/img/building.jpg&quot;&gt;Memorial Hall&lt;/a&gt;. The usual explanation goes like this:&lt;a href=&quot;#fn2&quot; class=&quot;footnote-ref&quot; id=&quot;fnref2&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt; voters rank candidates from their first choice to their last. If a candidate gets a majority (more than 50%) of first-choice votes, that candidate wins. Otherwise, the candidate with the fewest first-choice votes is eliminated, and ballots for that candidate &lt;em&gt;run off&lt;/em&gt; to those voters&#8217; next-choice candidates. Then the ballots are tallied again, and the process repeats, with last-place candidates eliminated, until one candidate has a majority.&lt;/p&gt;
&lt;p&gt;There&#8217;s an equivalent&lt;a href=&quot;#fn3&quot; class=&quot;footnote-ref&quot; id=&quot;fnref3&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt; formulation that may help to illustrate things. Imagine you&#8217;re running a traditional election, in which each person casts a single vote, but in which the winner must get a majority. If this doesn&#8217;t happen, there is a second election: you throw away ballots of the voters who voted for the least popular candidate, call those voters back, and force them to vote for one of the remaining candidates. You recount all the ballots and see if anyone has more than 50%. If not, you remove the last-place candidate from the ballots, call back all voters, and have them vote &lt;em&gt;again&lt;/em&gt;. Repeat until there is a winner (or, heaven forfend, a tie). Of course, asking voters for their fully ranked choices at once means you don&#8217;t have to have multiple successive elections&#8212;that&#8217;s why instant runoff is &lt;em&gt;instant&lt;/em&gt;.&lt;a href=&quot;#fn4&quot; class=&quot;footnote-ref&quot; id=&quot;fnref4&quot;&gt;&lt;sup&gt;4&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Much support for IRV comes from dedicated advocacy nonprofits such as &lt;a href=&quot;https://www.fairvote.org/&quot;&gt;FairVote&lt;/a&gt;, and from third parties vying for a fighting chance at the polls. Opposition often comes from the Democratic and Republican Parties, which allows supporters to paint IRV as a grassroots, anti-system movement. These groups have put forward various arguments for and against IRV.&lt;/p&gt;
&lt;h2 id=&quot;pros&quot;&gt;Pros&lt;/h2&gt;
&lt;h3 id=&quot;nuanced-positions&quot;&gt;Nuanced positions&lt;/h3&gt;
&lt;p&gt;The clearest benefit of IRV&#8212;and most systems besides plurality&#8212;is allowing voters to express nuanced positions, rather than forcing them to throw all their weight behind a single candidate. Given this information, though, it is less clear how to sensibly cohere it into a single choice; hence the existence of multiple competing voting systems.&lt;/p&gt;
&lt;h3 id=&quot;immunity-to-vote-splitting&quot;&gt;Immunity to vote-splitting&lt;/h3&gt;
&lt;p&gt;The best-advertised benefit of IRV is that it prevents minor third-party candidates from &#8220;&lt;a href=&quot;https://en.wikipedia.org/wiki/Vote_splitting#Spoiler_effect&quot;&gt;spoiling&lt;/a&gt;&#8221; the vote for their ideological peers&#8212;the famous examples are (for liberals) Nader taking votes from Gore in 2000, and (for conservatives) Perot taking votes from Bush in 1992. By way of example, &lt;span class=&quot;citation&quot; data-cites=&quot;fig:fake1&quot;&gt;@fig:fake1&lt;/span&gt; shows the results of an election between the Purple Party and the Yellow party.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-burlington-fake-round1.svg&quot; alt=&quot;Round 1: First-choice votes are tallied&quot; id=&quot;fig:fake1&quot; /&gt;&lt;figcaption&gt;&lt;strong&gt;Round 1:&lt;/strong&gt; First-choice votes are tallied&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Two candidates, B and C, ran under the Yellow platform, splitting the vote. In a plurality election, the Purple candidate A would win. Under IRV, though, Purple has failed to attain a majority, so there is a second round (&lt;span class=&quot;citation&quot; data-cites=&quot;fig:fake2&quot;&gt;@fig:fake2&lt;/span&gt;).&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-burlington-fake-round2.svg&quot; alt=&quot;Round 2: With no majority, the last-place candidate&#8217;s votes are run off&quot; id=&quot;fig:fake2&quot; /&gt;&lt;figcaption&gt;&lt;strong&gt;Round 2:&lt;/strong&gt; With no majority, the last-place candidate&#8217;s votes are run off&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;The votes of the least popular candidate, C, are reallocated to B, those voters&#8217; second choice, and B wins with a majority.&lt;/p&gt;
&lt;p&gt;Of course, in national elections, third parties rarely manage numbers like C did, because would-be C voters vote &lt;a href=&quot;https://en.wikipedia.org/wiki/Tactical_voting&quot;&gt;tactically&lt;/a&gt; (i.e., against their preferences) for B to avoid an A victory. I don&#8217;t know how many major-party voters would truly have preferred a third-party candidate, but while &lt;a href=&quot;https://news.gallup.com/poll/244094/majority-say-third-party-needed.aspx&quot;&gt;more than half&lt;/a&gt; of Americans think that the two major parties &#8220;do such a poor job that a third major party is needed&#8221;, fewer than &lt;a href=&quot;https://fivethirtyeight.com/features/america-isnt-really-set-up-for-third-party-presidential-bids/&quot;&gt;ten percent&lt;/a&gt; of voters typically vote third-party. This is pretty damning for plurality, but not the whole story; as we will see, there are other kinds of spoilage under IRV.&lt;/p&gt;
&lt;h3 id=&quot;guaranteed-majority-winner&quot;&gt;Guaranteed majority winner&lt;/h3&gt;
&lt;p&gt;Proponents of IRV often point to the majority criterion as evidence that IRV elects a &#8220;majority winner&#8221;. This is technically true, but a bit misleading, since the round in which the voters express a majority opinion may contain only a small subset of the original candidates.&lt;/p&gt;
&lt;h3 id=&quot;more-positive-campaigning&quot;&gt;More positive campaigning&lt;/h3&gt;
&lt;p&gt;Proponents of IRV often claim that it reduces negative campaigning, since candidates must expand their campaigns to try to capture second-choice votes from outside their bases. The claim, &lt;em&gt;prima facie&lt;/em&gt;, seems pretty fishy&#8212;after all, candidates are still jockeying for a single seat, and even in Cambridge, where the nine city councillors are chosen by a variant of IRV, candidates ask for a &lt;a href=&quot;https://centersandsquares.com/wp-content/uploads/2013/10/Cambridge-Election-Signs.jpg&quot;&gt;#1 vote&lt;/a&gt;&#8212;never for #2. However, &lt;span class=&quot;citation&quot; data-cites=&quot;donovan2016campaign&quot;&gt;@donovan2016campaign&lt;/span&gt; surveyed six cities by phone in 2013, and found that voters in the three cities using IRV perceived less negativity and criticism in political campaigning than in the control cities. Of course, this doesn&#8217;t prove causation: the authors themselves note that &#8220;it may be that cities with a more civil and less adversarial political context were somehow more likely to adopt preferential voting.&#8221; &lt;span class=&quot;citation&quot; data-cites=&quot;donovan2016campaign&quot;&gt;[@donovan2016campaign,p. 162]&lt;/span&gt; It would be most interesting to see voters&#8217; perceptions within a city before and after IRV is enacted. Nonetheless, this is encouraging for voters who are tired of jejune smear campaigns.&lt;/p&gt;
&lt;h2 id=&quot;cons&quot;&gt;Cons&lt;/h2&gt;
&lt;h3 id=&quot;complexity-and-cost&quot;&gt;Complexity and cost&lt;/h3&gt;
&lt;p&gt;A common bugbear is that IRV is too complex in some way&#8212;this will turn out to be overblown. A related, and serious, concern is the need to replace perfectly good voting machines at significant cost to the taxpayer. Even educating voters could be expensive: mailing informational pamphlets to &lt;a href=&quot;https://www.census.gov/quickfacts/MA&quot;&gt;2.6 million households&lt;/a&gt; at a &lt;a href=&quot;https://www.themailshark.com/resources/blog/bulk-mail-postage-rates/&quot;&gt;19&#162; bulk rate&lt;/a&gt; would cost nearly half a million dollars.&lt;/p&gt;
&lt;p&gt;Of course, complaints about implementing the algorithm itself are patently unfounded&#8212;it can be done in just a few lines of code, and has linear complexity in both the number of voters and the number of candidates.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode haskell&quot;&gt;&lt;code class=&quot;sourceCode haskell&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;kw&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;Data.List&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-2&quot; title=&quot;2&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-3&quot; title=&quot;3&quot;&gt;&lt;span class=&quot;kw&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;Candidate&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;Kiss&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;Montroll&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;Simpson&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;Smith&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;Wright&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;deriving&lt;/span&gt; (&lt;span class=&quot;dt&quot;&gt;Show&lt;/span&gt;, &lt;span class=&quot;dt&quot;&gt;Eq&lt;/span&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-4&quot; title=&quot;4&quot;&gt;&lt;span class=&quot;kw&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;Ballot&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;dt&quot;&gt;Candidate&lt;/span&gt;]&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-5&quot; title=&quot;5&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-6&quot; title=&quot;6&quot;&gt;&lt;span class=&quot;ot&quot;&gt;irv ::&lt;/span&gt; [&lt;span class=&quot;dt&quot;&gt;Candidate&lt;/span&gt;] &lt;span class=&quot;ot&quot;&gt;-&amp;gt;&lt;/span&gt; [&lt;span class=&quot;dt&quot;&gt;Ballot&lt;/span&gt;] &lt;span class=&quot;ot&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;Candidate&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-7&quot; title=&quot;7&quot;&gt;irv candidates ballots&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-8&quot; title=&quot;8&quot;&gt;    &lt;span class=&quot;op&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;any&lt;/span&gt; (&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;fl&quot;&gt;0.5&lt;/span&gt;) shares &lt;span class=&quot;ot&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;last&lt;/span&gt; rankings &lt;span class=&quot;co&quot;&gt;-- If we have a majority, return the winner&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-9&quot; title=&quot;9&quot;&gt;    &lt;span class=&quot;op&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;otherwise&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;=&lt;/span&gt; irv candidates&amp;#39; ballots&amp;#39; &lt;span class=&quot;co&quot;&gt;-- Otherwise, rerun with new parameters&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-10&quot; title=&quot;10&quot;&gt;      &lt;span class=&quot;kw&quot;&gt;where&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-11&quot; title=&quot;11&quot;&gt;        &lt;span class=&quot;co&quot;&gt;-- Get vote share of each remaining candidate&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-12&quot; title=&quot;12&quot;&gt;        shares &lt;span class=&quot;ot&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt; (\c &lt;span class=&quot;ot&quot;&gt;-&amp;gt;&lt;/span&gt; (genericLength &lt;span class=&quot;op&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;filter&lt;/span&gt; (&lt;span class=&quot;op&quot;&gt;==&lt;/span&gt; c) &lt;span class=&quot;op&quot;&gt;$&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;head&lt;/span&gt; ballots) &lt;span class=&quot;op&quot;&gt;/&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-13&quot; title=&quot;13&quot;&gt;                            (genericLength ballots)) candidates&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-14&quot; title=&quot;14&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-15&quot; title=&quot;15&quot;&gt;        &lt;span class=&quot;co&quot;&gt;-- Rank candidates in (ascending) order of share&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-16&quot; title=&quot;16&quot;&gt;        rankings &lt;span class=&quot;ot&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;fst&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;.&lt;/span&gt; sortOn &lt;span class=&quot;fu&quot;&gt;snd&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;$&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;zip&lt;/span&gt; candidates shares&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-17&quot; title=&quot;17&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-18&quot; title=&quot;18&quot;&gt;        &lt;span class=&quot;co&quot;&gt;-- Remove eliminated candidates and exhausted ballots &lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-19&quot; title=&quot;19&quot;&gt;        candidates&amp;#39; &lt;span class=&quot;ot&quot;&gt;=&lt;/span&gt; candidates \\ [&lt;span class=&quot;fu&quot;&gt;head&lt;/span&gt; rankings]&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-20&quot; title=&quot;20&quot;&gt;        ballots&amp;#39; &lt;span class=&quot;ot&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;filter&lt;/span&gt; (&lt;span class=&quot;fu&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;op&quot;&gt;$&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;map&lt;/span&gt; (&lt;span class=&quot;fu&quot;&gt;dropWhile&lt;/span&gt; (&lt;span class=&quot;ot&quot;&gt;`notElem`&lt;/span&gt; candidates&amp;#39;)) ballots&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;unequal-representation&quot;&gt;Unequal representation&lt;/h3&gt;
&lt;p&gt;Another complaint about IRV is that it doesn&#8217;t treat all votes equally. Kathy Dopp &lt;a href=&quot;http://electionmathematics.org/ucvAnalysis/US/RCV-IRV/InstantRunoffVotingFlaws.pdf#page=10&quot;&gt;writes&lt;/a&gt; that:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Some voters&#8217; second choices are considered in a timely fashion when their second choice candidates are still in the contest. Less lucky voters&#8217; [sic] have their second choices considered only after it is too late to help that candidate to win. Some of the most unlucky voters only have their first choice considered, even though their first choice candidate loses.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;and an &lt;a href=&quot;https://www.bostonglobe.com/2020/09/20/opinion/why-ranked-choice-is-wrong-choice/&quot;&gt;anti-IRV op-ed&lt;/a&gt; in the &lt;em&gt;Globe&lt;/em&gt; posits that:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;[IRV] thus gives some voters multiple bites of the election apple. At the same time, it effectively disenfranchises other voters&#8212;those who don&#8217;t rank enough candidates for their ballot to last through multiple rounds of tabulation.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This seems to rest on a very strange notion of what it means for two ballots to be equal. The usual, and I think correct, rejoinder is that some voters have their first choice considered &lt;em&gt;multiple times&lt;/em&gt;, while for others consideration runs down their ballot as their favorites are successively struck off. A ballot expressing &lt;em&gt;n&lt;/em&gt; preferences is guaranteed to be counted in the first &lt;em&gt;n&lt;/em&gt; rounds, and one expressing all preferences will always be in contention. It is the same as there being &lt;em&gt;n&lt;/em&gt; consecutive elections with fewer and fewer options. Since in reality these &#8220;elections&#8221; take place at the same time, it costs voters nothing to fill in one extra bubble; if they don&#8217;t, presumably they simply don&#8217;t care.&lt;/p&gt;
&lt;h3 id=&quot;non-additivity&quot;&gt;Non-additivity&lt;/h3&gt;
&lt;p&gt;In an IRV election, every ballot needs to be tallied to know whether a runoff is necessary. This means that there is no meaningful notion of a subtotal in IRV. Unlike in a plurality election, the collection of ballots from a certain district don&#8217;t add to anything, so one can&#8217;t really say who the district &#8220;voted for&#8221;. This is mostly a curiosity&#8212;its only real effect is precluding early reporting, which at any rate is &lt;a href=&quot;https://www.nytimes.com/2016/09/11/us/politics/election-results-voting.html&quot;&gt;notoriously unreliable&lt;/a&gt; and possibly even detrimental, having significant effects on voter turnout &lt;span class=&quot;citation&quot; data-cites=&quot;jackson1983election&quot;&gt;[@jackson1983election]&lt;/span&gt;.&lt;/p&gt;
&lt;h3 id=&quot;paradoxical-results&quot;&gt;Paradoxical results&lt;/h3&gt;
&lt;p&gt;Much more serious are IRV&#8217;s violations of expected behavior. IRV can lead to some &lt;a href=&quot;http://zesty.ca/voting/sim/&quot;&gt;very strange behavior&lt;/a&gt;, an in particular to violations of &lt;a href=&quot;https://en.wikipedia.org/wiki/Monotonicity_criterion&quot;&gt;monotonicity&lt;/a&gt;, by which tactical voting by organized blocs is made possible. To see how, let&#8217;s look at the strange case of Burlington.&lt;/p&gt;
&lt;h1 id=&quot;burlington-2009&quot;&gt;Burlington, 2009&lt;/h1&gt;
&lt;p&gt;The &lt;a href=&quot;https://en.wikipedia.org/wiki/2009_Burlington_mayoral_election&quot;&gt;2009 mayoral election&lt;/a&gt; in Burlington, Vermont unintentionally became a case study in the efficacy of IRV&#8212;and a parable for anti-IRV crusaders after the controversial results led the system to be scrapped the following year.&lt;/p&gt;
&lt;h2 id=&quot;meta-concerns&quot;&gt;Meta concerns&lt;/h2&gt;
&lt;p&gt;Some commentators were concerned about the complexity of IRV&#8212;voters would either fail to understand the new system, or simply be unwilling to express preferences. The latter concern was not borne out; most voters expressed preferences, with interest predictably dropping off by an average of 25% with each successive choice after the first (&lt;span class=&quot;citation&quot; data-cites=&quot;fig:choices&quot;&gt;@fig:choices&lt;/span&gt;).&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-burlington-choices.svg&quot; alt=&quot;Percentage of valid ballots that specified an nth choice (the sixth choice was to allow for write-ins).&quot; id=&quot;fig:choices&quot; /&gt;&lt;figcaption&gt;Percentage of valid ballots that specified an nth choice (the sixth choice was to allow for write-ins).&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Furthermore, the introduction of IRV in 2005 did not depress turnout; as &lt;span class=&quot;citation&quot; data-cites=&quot;fig:turnout&quot;&gt;@fig:turnout&lt;/span&gt; shows, it increased even as the population stagnated.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-burlington-turnout.svg&quot; alt=&quot;Turnout for triennial Burlington mayoral races. Population estimates from WolframAlpha.  &#160;City population est. &#160;Votes cast for mayor &#160;IRV in use&quot; id=&quot;fig:turnout&quot; /&gt;&lt;figcaption&gt;Turnout for triennial Burlington mayoral races. Population estimates from WolframAlpha.&lt;br /&gt;
&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#1b9e77&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;City population est.&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#d95f02&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;Votes cast for mayor&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;10&quot;&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;20&quot; height=&quot;10&quot; fill=&quot;#E0E0E0&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;IRV in use&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Some also expressed concern that introducing ranked choices would render ballots dauntingly complex for some voters. The complexity of a ballot, though, depends much more on the way it presents options than on the options themselves. A well-designed ballot works with voters; a poorly-designed ballot stymies them.&lt;/p&gt;
&lt;p&gt;A Florida ballot from the 2000 presidential election in Florida is shown in &lt;span class=&quot;citation&quot; data-cites=&quot;fig:florida&quot;&gt;@fig:florida&lt;/span&gt;. While Palm Beach&#8217;s infamous &lt;a href=&quot;https://commons.wikimedia.org/wiki/File:Butterfly_Ballot,_Florida_2000_(large).jpg&quot;&gt;&#8220;butterfly ballots&#8221;&lt;/a&gt; dominated the news cycles, these ballots from Duval County are arguably worse&#8212;the &lt;em&gt;New York Times&lt;/em&gt; &lt;a href=&quot;https://www.nytimes.com/images/2001/11/12/politics/recount/results/design-v4.html&quot;&gt;reported&lt;/a&gt; that the two-column layout made voters were &lt;em&gt;twelve&lt;/em&gt; times as likely as other counties to accidentally vote for two candidates.&lt;/p&gt;
&lt;!-- ![Palm Beach &quot;butterfly ballot&quot; from the 2000 presidential election ([source](https://commons.wikimedia.org/wiki/File:Butterfly_Ballot,_Florida_2000_(large).jpg))](Butterfly_Ballot,_Florida_2000_(large).jpg){#fig:florida width=600px} --&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-ballot-columns.gif&quot; alt=&quot;Ballot from the 2000 Duval County, Florida presidential election (source)&quot; id=&quot;fig:florida&quot; width=&quot;400&quot; /&gt;&lt;figcaption&gt;Ballot from the 2000 Duval County, Florida presidential election (&lt;a href=&quot;https://www.nytimes.com/images/2001/11/12/politics/recount/index_BALLOT_fran.html&quot;&gt;source&lt;/a&gt;)&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Other factors besides the columnar layout contribute to the poor design. The incredible preponderance of horizontal lines makes it impossible to divide the ballot into logical sections. They separate the presidential candidates from each other&#8212;though not the others&#8212;and offset the highest-level titles (&#8220;Congressional&#8221;) above and below. In addition, the party labels for the presidential candidates are the same size and style as the smaller titles (&#8220;United States Senator&#8221;). It is easy to see how a voter could mistake the presidential candidates in the middle column for those in another race entirely.&lt;/p&gt;
&lt;p&gt;By way of contrast, a ballot from the Burlington election is shown in &lt;span class=&quot;citation&quot; data-cites=&quot;fig:vermont&quot;&gt;@fig:vermont&lt;/span&gt;.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-ballot-burlington.png&quot; alt=&quot;Ballot from the 2009 Burlington mayoral election&quot; id=&quot;fig:vermont&quot; width=&quot;400&quot; /&gt;&lt;figcaption&gt;Ballot from the 2009 Burlington mayoral election&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;This ballot admittedly has fewer races to collate, but still has to collect rank information. It does so elegantly with a tabular display, like what Tufte calls a &lt;a href=&quot;https://en.wikipedia.org/wiki/Small_multiple&quot;&gt;&lt;em&gt;small multiple&lt;/em&gt;&lt;/a&gt; &lt;span class=&quot;citation&quot; data-cites=&quot;tufte1990envisioning&quot;&gt;[@tufte1990envisioning,p. 29]&lt;/span&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;An economy of perception results; once viewers decode and comprehend the design for one slice of data, they have familiar access to data in all the other slices. As our eye moves from one image to the next, this constancy of design allows viewers to focus on changes in information rather than changes in graphical composition. A steady canvas makes for a clearer picture.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Indeed, unlike Duval County, which saw fully &lt;a href=&quot;https://www.salon.com/2000/11/13/duval/&quot;&gt;nine percent&lt;/a&gt; of its ballots invalidated in 2000, Burlington saw only four ballots incorrectly filled out&#8212;less than a twentieth of a percent. Exit polls from the 2006 election further showed that only &lt;a href=&quot;https://www.uvm.edu/~vlrs/IRV.pdf#page=12&quot;&gt;8.6%&lt;/a&gt; of voters found the ballot confusing.&lt;/p&gt;
&lt;p&gt;Thus, concerns that IRV was too complicated seem to have been unfounded&#8212;though not entirely unfair. Voting systems can be arbitrarily complex, particularly ones that elect multiple winners, and it would not be reasonable feed citizens&#8217; votes into what may as well be a black-box algorithm and expect them to placidly accept the results. Whatever the merits of a voting system, it should also be simple enough for a typical eighteen-year-old to understand, and IRV seems to fit this bill.&lt;/p&gt;
&lt;h2 id=&quot;instant-runoff-results&quot;&gt;Instant runoff results&lt;/h2&gt;
&lt;p&gt;After a successfully executed election, the votes were tallied.&lt;a href=&quot;#fn5&quot; class=&quot;footnote-ref&quot; id=&quot;fnref5&quot;&gt;&lt;sup&gt;5&lt;/sup&gt;&lt;/a&gt; The candidates were &lt;span class=&quot;prg&quot;&gt;Bob Kiss&lt;/span&gt; (Progressive, incumbent), &lt;span class=&quot;dem&quot;&gt;Andy Montroll&lt;/span&gt; (Democrat), &lt;span class=&quot;grn&quot;&gt;James Simpson&lt;/span&gt; (Green). &lt;span class=&quot;ind&quot;&gt;Dan Smith&lt;/span&gt; (Independent), and &lt;span class=&quot;rep&quot;&gt;Kurt Wright&lt;/span&gt; (Republican). Had this been an ordinary plurality election, only voters&#8217; first choices (&lt;span class=&quot;citation&quot; data-cites=&quot;fig:round1&quot;&gt;@fig:round1&lt;/span&gt;) would have been considered. The winner, with less than a third of the votes, would be the conservative &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt;, with the liberal vote &lt;a href=&quot;https://en.wikipedia.org/wiki/Vote_splitting&quot;&gt;split&lt;/a&gt; between &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt; and &lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt;. In a two-round system, as used by France, &lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt; and &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; would have appeared on a second ballot, and&#8212;assuming the same relative preferences as the first time&#8212;&lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt; would have won by four points.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-burlington-round1.svg&quot; alt=&quot;Round 1: Proportion of first-choice votes. In a plurality election, this would be the sole calculation.&quot; id=&quot;fig:round1&quot; /&gt;&lt;figcaption&gt;&lt;strong&gt;Round 1:&lt;/strong&gt; Proportion of first-choice votes. In a plurality election, this would be the sole calculation.&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Of course, IRV requires a majority, which, even after eliminating &lt;span class=&quot;grn&quot;&gt;Simpson&lt;/span&gt; and the write-ins, we clearly do not yet have. The next-least-popular candidate is &lt;span class=&quot;ind&quot;&gt;Smith&lt;/span&gt;&#8212;his votes go more or less evenly to the remaining three.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-burlington-round2.svg&quot; alt=&quot;Round 2: Proportion of first-choice votes after first runoff. Simpson and write-in votes are not shown as they do not affect the totals.&quot; id=&quot;fig:round2&quot; /&gt;&lt;figcaption&gt;&lt;strong&gt;Round 2:&lt;/strong&gt; Proportion of first-choice votes after first runoff. Simpson and write-in votes are not shown as they do not affect the totals.&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Still no majority. Next to go is &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt;. His votes, and the votes of the &lt;span class=&quot;ind&quot;&gt;Smith&lt;/span&gt; voters reallocated to him, are reallocated in round 3.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-burlington-round3.svg&quot; alt=&quot;Round 3: Proportion of first-choice votes after second runoff&quot; id=&quot;fig:round3&quot; /&gt;&lt;figcaption&gt;&lt;strong&gt;Round 3:&lt;/strong&gt; Proportion of first-choice votes after second runoff&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;With most of the votes going to &lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt;, he ekes out a majority. (Since some ballots didn&#8217;t specify higher choices, the percentages are of the ballots remaining after each runoff.)&lt;/p&gt;
&lt;p&gt;The problem with this result is that &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt; was &lt;em&gt;individually&lt;/em&gt; more popular than any of the other candidates. How, then, did he fail to be elected? Basically, voters could be divided into liberal and conservative blocs, with liberals favoring &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt; or &lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt;, and conservatives favoring &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt;, but preferring the more moderate &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt; over the far-left &lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt;. But since &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; was a contender to the last, the lower rankings of his supporters were never accounted for. This can be more easily seen by simulating the results of other voting systems.&lt;/p&gt;
&lt;h2 id=&quot;borda-count-results&quot;&gt;Borda count results&lt;/h2&gt;
&lt;p&gt;In a Borda count, all of a candidate&#8217;s votes are weighted and added; so each first-choice vote gives a candidate 5 points, second-choice votes 4, and so on. For instance, &lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt;&#8217; Borda score would be (2,586 &#215; 5) + (1,404 &#215; 4) + (962 &#215; 3) + (741 &#215; 2) + (491 &#215; 1) = 23,405. This method gives much more weight to lower-ranked candidates than other methods, and is therefore highly amenable to centrist candidates with broad, if tepid, appeal.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-burlington-borda.svg&quot; alt=&quot;Borda scores for each candidate. Montroll wins due to strong first- and second-place scores.&quot; id=&quot;fig:borda&quot; /&gt;&lt;figcaption&gt;Borda scores for each candidate. Montroll wins due to strong first- and second-place scores.&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;&lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; and &lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt; were popular first-choice votes, but didn&#8217;t garner many next-choice votes, while &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt; and &lt;span class=&quot;ind&quot;&gt;Smith&lt;/span&gt; emerged as compromise candidates, with many more second- and third-choice votes than first-choice (the former would indeed have been the Borda winner). &lt;span class=&quot;grn&quot;&gt;Simpson&lt;/span&gt; proved very unpopular, with mostly last-place votes.&lt;/p&gt;
&lt;h2 id=&quot;condorcet-results&quot;&gt;Condorcet results&lt;/h2&gt;
&lt;p&gt;Condorcet voting methods pit each candidate against the others round-robin style; if one always prevails, that candidate wins. The &lt;a href=&quot;https://en.wikipedia.org/wiki/Condorcet_criterion&quot;&gt;Condorcet criterion&lt;/a&gt; of always electing the pairwise winner, if there is one, is sometimes imposed on other methods. Of course, there is not always such a winner, as in rock paper scissors. &lt;!--, or [nontransitive dice](https://www.futilitycloset.com/2013/10/23/nontransitive-dice-2/).--&gt; However, the Burlington race did have such a winner&#8212;Montroll&#8212;and IRV was much maligned after the fact for eliminating him in the second round.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-burlington-condorcet.svg&quot; alt=&quot;Results of a Condorcet-style election, for voters who expressed relative preferences for each pair: Montroll wins head-to-head against every other candidate.&quot; id=&quot;fig:cond&quot; /&gt;&lt;figcaption&gt;Results of a Condorcet-style election, for voters who expressed relative preferences for each pair: Montroll wins head-to-head against every other candidate.&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;h2 id=&quot;summary-lessons&quot;&gt;Summary &amp;amp; lessons&lt;/h2&gt;
&lt;p&gt;The results of different methods are summarized in &lt;span class=&quot;citation&quot; data-cites=&quot;tbl:summary&quot;&gt;@tbl:summary&lt;/span&gt;.&lt;/p&gt;
&lt;table&gt;
&lt;caption&gt;Full rankings produced by various methods, excluding write-ins {#tbl:summary}&lt;/caption&gt;
&lt;thead&gt;
&lt;tr class=&quot;header&quot;&gt;
&lt;th style=&quot;text-align: left;&quot;&gt;Method&lt;/th&gt;
&lt;th style=&quot;text-align: left;&quot;&gt;Choice 1&lt;/th&gt;
&lt;th style=&quot;text-align: left;&quot;&gt;Choice 2&lt;/th&gt;
&lt;th style=&quot;text-align: left;&quot;&gt;Choice 3&lt;/th&gt;
&lt;th style=&quot;text-align: left;&quot;&gt;Choice 4&lt;/th&gt;
&lt;th style=&quot;text-align: left;&quot;&gt;Choice 5&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Plurality&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;ind&quot;&gt;Smith&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;grn&quot;&gt;Simpson&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Two-round&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;grayed&quot;&gt;N/A&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;grayed&quot;&gt;N/A&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;grayed&quot;&gt;N/A&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;IRV&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;ind&quot;&gt;Smith&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;grn&quot;&gt;Simpson&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Borda Count&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;ind&quot;&gt;Smith&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;grn&quot;&gt;Simpson&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Condorcet&lt;a href=&quot;#fn6&quot; class=&quot;footnote-ref&quot; id=&quot;fnref6&quot;&gt;&lt;sup&gt;6&lt;/sup&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;ind&quot;&gt;Smith&lt;/span&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;grn&quot;&gt;Simpson&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Since &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt; would have beat any other candidate head-to-head, he would have been the winner if he had made it to the final round. Of course, this would have happened if more people had ranked him first. But, incredibly, it could also have happened if a contingent of &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; voters had simply &lt;a href=&quot;https://en.wikipedia.org/wiki/Participation_criterion&quot;&gt;stayed home&lt;/a&gt;. Let&#8217;s say that a random third of &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; voters had stayed home on election day.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-burlington-nowright-round1.svg&quot; alt=&quot;Round 1: Proportion of first-choice votes with a third of Wright voters staying home. Simpson and write-ins are omitted for illustration&quot; id=&quot;fig:nowright-round1&quot; /&gt;&lt;figcaption&gt;&lt;strong&gt;Round 1:&lt;/strong&gt; Proportion of first-choice votes with a third of Wright voters staying home. Simpson and write-ins are omitted for illustration&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;&lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; now starts out third in the rankings (&lt;span class=&quot;citation&quot; data-cites=&quot;fig:nowright-round1&quot;&gt;@fig:nowright-round1&lt;/span&gt;), and is still last after &lt;span class=&quot;ind&quot;&gt;Smith&lt;/span&gt; is eliminated (&lt;span class=&quot;citation&quot; data-cites=&quot;fig:nowright-round2&quot;&gt;@fig:nowright-round2&lt;/span&gt;).&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-burlington-nowright-round2.svg&quot; alt=&quot;Round 2: Proportion of first-choice votes after first runoff&quot; id=&quot;fig:nowright-round2&quot; /&gt;&lt;figcaption&gt;&lt;strong&gt;Round 2:&lt;/strong&gt; Proportion of first-choice votes after first runoff&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Now &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; is eliminated, and the bulk of his votes go to &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt;, carrying the latter to a four-point victory.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-burlington-nowright-round3.svg&quot; alt=&quot;Round 3: Proportion of first-choice votes after second runoff&quot; id=&quot;fig:nowright-round3&quot; /&gt;&lt;figcaption&gt;&lt;strong&gt;Round 3:&lt;/strong&gt; Proportion of first-choice votes after second runoff&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;This may seem like an esoteric or academic concern (headline: &#8220;If Public Had Voted Differently, A Different Candidate Would Have Won&#8221;), but its threat is twofold. One is that it makes tactical voting possible. It&#8217;s hard to win the match; it&#8217;s easier to bet against yourself and take a fall. Of course, tactical voting occurs under plurality voting as well: namely, Nader supporters bubbling in Gore to hurt Bush. By not expressing their true preferences, they throw the match for their first-choice candidate in order to help their more popular second choice. The concern here is of the same kind&#8212;that a bloc of &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; supporters could scuttle their own candidate to get a second-favorite in.&lt;a href=&quot;#fn7&quot; class=&quot;footnote-ref&quot; id=&quot;fnref7&quot;&gt;&lt;sup&gt;7&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The second problem is that the results now border on incongruous&#8212;surely whether &lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt; or &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt; wins should not depend on the number of &lt;span class=&quot;rep&quot;&gt;&lt;em&gt;Wright&lt;/em&gt;&lt;/span&gt; voters who turn out. This is a violation of the rule of &lt;a href=&quot;https://en.wikipedia.org/wiki/Independence_of_irrelevant_alternatives&quot;&gt;independence of irrelevant alternatives&lt;/a&gt;. (A similar result, of course, would have happened if these &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; voters had still voted, but ranked &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt; first.) This, in a sense, makes &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; the &#8220;spoiler&#8221; in this election. It actually gets weirder; it is &lt;a href=&quot;https://www.rangevoting.org/Burlington.html&quot;&gt;theoretically possible&lt;/a&gt; for just the right subset of &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; voters to hurt &lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt; &lt;em&gt;by voting for him instead of &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt;&lt;/em&gt;.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-burlington-flip-round1.svg&quot; alt=&quot;Round 1: Proportion of first-choice votes with a contingent of Wright voters supporting Kiss. Simpson and write-ins are omitted for illustration&quot; id=&quot;fig:flip-round1&quot; /&gt;&lt;figcaption&gt;&lt;strong&gt;Round 1:&lt;/strong&gt; Proportion of first-choice votes with a contingent of Wright voters supporting Kiss. Simpson and write-ins are omitted for illustration&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;&lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt; now has a very strong out-of-the-gate lead, with &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; barely ahead of &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt;.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-burlington-flip-round2.svg&quot; alt=&quot;Round 2: Proportion of first-choice votes after first runoff&quot; id=&quot;fig:flip-round2&quot; /&gt;&lt;figcaption&gt;&lt;strong&gt;Round 2:&lt;/strong&gt; Proportion of first-choice votes after first runoff&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;With &lt;span class=&quot;ind&quot;&gt;Smith&lt;/span&gt;&#8217;s votes reallocated, &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; is eliminated, and now all of his votes go to &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt;.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-burlington-flip-round3.svg&quot; alt=&quot;Round 3: Proportion of first-choice votes after second runoff&quot; id=&quot;fig:flip-round3&quot; /&gt;&lt;figcaption&gt;&lt;strong&gt;Round 3:&lt;/strong&gt; Proportion of first-choice votes after second runoff&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;This illustrates how IRV violates the principle of &lt;a href=&quot;https://en.wikipedia.org/wiki/Monotonicity_criterion&quot;&gt;monotonicity&lt;/a&gt;, which says that you shouldn&#8217;t be able to hurt a candidate by giving them more votes, or help them by taking away votes.&lt;a href=&quot;#fn8&quot; class=&quot;footnote-ref&quot; id=&quot;fnref8&quot;&gt;&lt;sup&gt;8&lt;/sup&gt;&lt;/a&gt; &lt;span class=&quot;citation&quot; data-cites=&quot;riker1982liberalism&quot;&gt;@riker1982liberalism [p. 51]&lt;/span&gt; writes that:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If we assume that the purpose of voting is to amalgamate individual tastes into a social decision, then monotonicity requires that voting actually do so by counting all individual judgments in generating an outcome. Moral (as distinct from technical) considerations may arise in choosing between forms of monotonicity. For example, one might prefer a two-thirds majority (monotonic) to a simple majority (strongly monotonic) on ethical grounds. But that some kind of monotonicity be required is hardly a moral question. It is simply a straightforward matter of making the voting system do what it is supposed to do.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--
&gt; Monotonicity is primarily a technical requirement that one would
&gt; want to impose on *any* voting system. If we assume that the
&gt; purpose of voting is to amalgamate individual tastes into a social
&gt; decision, then monotonicity requires that voting actually do so by
&gt; counting all individual judgments in generating an outcome. Moral
&gt; (as distinct from technical) considerations may arise in choosing
&gt; between forms of monotonicity. For example, one might prefer a
&gt; two-thirds majority (monotonic) to a simple majority (strongly
&gt; monotonic) on ethical grounds. But that some kind of monotonicity be
&gt; required is hardly a moral question. It is simply a straightforward
&gt; matter of making the voting system do what it is supposed to do.
&gt;
&gt; Theoretically, therefore, one should, on technical grounds, reject
&gt; all nonmonotonic systems, although practically compromise may be
&gt; appropriate. Two-stage majority rule, though nonmonotonic, may be
&gt; better than the plurality system it replaces. It is hard to believe
&gt; there is any good justification for the single transferable vote,
&gt; however, when there exist proportional representation systems (such
&gt; as list systems) that are at least weakly monotonic. In rejecting
&gt; the single transferable vote, technical considerations ought to
&gt; dominate.
--&gt;
&lt;p&gt;Tactical voting, if prevalent enough, could neutralize the boost IRV is supposed to provide to third parties&#8212;notice that if &lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt; voters were concerned about &lt;em&gt;his&lt;/em&gt; viability hurting &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt; and putting &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; in office, they might have bailed on &lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt; in the same way. The odds of this happening are pretty slim, as it more or less requires knowing the results in advance (if &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; had any kind of fighting chance, it&#8217;s unlikely his voters would have thrown the vote by staying home). But the odds of getting an monotonicity violation, as Burlington did, may be significant enough to worry about.&lt;/p&gt;
&lt;h1 id=&quot;probability-of-paradoxical-results&quot;&gt;Probability of paradoxical results&lt;/h1&gt;
&lt;!-- https://www.rangevoting.org/IRVStratPf.html --&gt;
&lt;!-- https://www.rangevoting.org/IrvPathologySurvey.html --&gt;
&lt;!-- https://www.rangevoting.org/FunnyElections.html --&gt;
&lt;!-- https://www.rangevoting.org/IrvParadoxProbabilities.html --&gt;
&lt;p&gt;Of course, no voting system is perfect; all fall prey to unexpected results given the right input parameters. Much of the literature looks at the probability of not having a Condorcet winner at all; e.g., Riker &lt;span class=&quot;citation&quot; data-cites=&quot;riker1982liberalism&quot;&gt;[@riker1982liberalism,p. 122]&lt;/span&gt; puts it at about 25% for 5 candidates, assuming people vote &lt;a href=&quot;https://en.wikipedia.org/wiki/Impartial_culture&quot;&gt;basically at random&lt;/a&gt;. This is of lower import, though, because neither plurality nor IRV may deal with this kind of paradox sensibly&#8212;and under plurality, no one would ever even know it happened. More serious is the probability of nonmonotonicity&#8212;of seeing a repeat of Burlington in Massachusetts. This can be done theoretically, with Monte Carlo simulations, or empirically, by looking at datasets of past elections.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;citation&quot; data-cites=&quot;ornstein2014frequency&quot;&gt;@ornstein2014frequency&lt;/span&gt; run simulations of three-candidate elections to find the probability of a monotonicity failure, by which giving more votes to the top-ranked candidate A might end up electing candidate C. For this to happen, C must receive more than one fourth of the total votes, and be the Condorcet winner, if there is one. A simplified version of the Burlington election satisfies these requirements, as &lt;span class=&quot;citation&quot; data-cites=&quot;tbl:rank&quot;&gt;@tbl:rank&lt;/span&gt; shows. Here, A is &lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt;, B is &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt;, and C is &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt;.&lt;/p&gt;
&lt;table&gt;
&lt;caption&gt;Relative rankings of the three top candidates, from the 40% of ballots that ranked all three. Montroll emerged as a compromise over the more polarizing Kiss and Wright. {#tbl:rank}&lt;/caption&gt;
&lt;thead&gt;
&lt;tr class=&quot;header&quot;&gt;
&lt;th style=&quot;text-align: left;&quot;&gt;Relative ranking&lt;/th&gt;
&lt;th&gt;Ballots&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt; &amp;gt; &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt; &amp;gt; &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt;&lt;/td&gt;
&lt;td&gt;2,043&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt; &amp;gt; &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; &amp;gt; &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt;&lt;/td&gt;
&lt;td&gt;371&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; &amp;gt; &lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt; &amp;gt; &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt;&lt;/td&gt;
&lt;td&gt;496&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; &amp;gt; &lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt; &amp;gt; &lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt;&lt;/td&gt;
&lt;td&gt;1,513&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt; &amp;gt; &lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt; &amp;gt; &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt;&lt;/td&gt;
&lt;td&gt;1,332&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;&lt;span class=&quot;dem&quot;&gt;Montroll&lt;/span&gt; &amp;gt; &lt;span class=&quot;rep&quot;&gt;Wright&lt;/span&gt; &amp;gt; &lt;span class=&quot;prg&quot;&gt;Kiss&lt;/span&gt;&lt;/td&gt;
&lt;td&gt;767&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;They find that roughly 15&#8211;20% of elections exhibit this behavior, with the number reaching 50% for elections in which two of the three candidates are ideologically very close. &lt;span class=&quot;citation&quot; data-cites=&quot;miller2017closeness&quot;&gt;@miller2017closeness&lt;/span&gt; calculates similar numbers&#8212;around 50% for certain assumptions about voter distribution, and the election being competitive.&lt;/p&gt;
&lt;p&gt;What, then, is the probability of an election being &#8220;competitive&#8221;? Miller &lt;span class=&quot;citation&quot; data-cites=&quot;miller2017closeness&quot;&gt;[-@miller2017closeness]&lt;/span&gt; analyzes U.K. Parliamentary races with only three parties, finding that only 5% could be considered competitive. This is encouraging, but Parliamentary elections use plurality voting; IRV may well lead to an increase in competitiveness as third parties vie more strongly. FairVote, a pro-IRV nonprofit, &lt;a href=&quot;https://www.fairvote.org/data_on_rcv&quot;&gt;claims&lt;/a&gt; that &#8220;[o]f the 322 single-winner RCV elections in the United States since 2004 in which we have sufficient ballot data [&#8230;], 321 elections were won by the Condorcet winner&#8221;, although they don&#8217;t make their data public (the exception, of course, was Burlington). They also claim that:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;There have been 204 single-winner ranked choice elections in the U.S. which included at least 3 candidates. In 96 of these (or 47%), a majority winner was identified in the first round. The remaining 108 races went into the instant runoff before declaring a winner.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;They count 381 races total, so half had more than two candidates, and half again had no first-round majority. Miller &lt;span class=&quot;citation&quot; data-cites=&quot;miller2017closeness&quot;&gt;[-@miller2017closeness]&lt;/span&gt; claims that 60% of the 2,642 Parliamentary elections analyzed had a majority winner. This is significantly different from FairVote&#8217;s numbers (&#967;&#178;&#160;=&#160;12.588, p&#160;&amp;lt;&#160;0.001),&lt;a href=&quot;#fn9&quot; class=&quot;footnote-ref&quot; id=&quot;fnref9&quot;&gt;&lt;sup&gt;9&lt;/sup&gt;&lt;/a&gt; but it&#8217;s unclear that IRV was the cause.&lt;/p&gt;
&lt;p&gt;As an educated guess, we can estimate that 10&#8211;20% of IRV elections will be &#8220;competitive&#8221;, and that half of those, or 5&#8211;10%, will display a monotonicity failure.&lt;/p&gt;
&lt;!--
Analyzing these failures empirically is harder due to a scarcity of ballot data.
@ornstein2014frequency [p. 9] note that:

&gt; Perhaps the only definitive way these questions can be resolved is
&gt; by examining a broad body of data from real IRV elections. Such a
&gt; body does not yet exist, though it is telling that out of only two
&gt; IRV elections in Burlington, VT, there has already been one recorded
&gt; instance of nonmonotonicity.

and while the latter remark is [obviously fallacious](https://en.wikipedia.org/wiki/Survivorship_bias), it would indeed be nice to have ballot data to analyze.
--&gt;
&lt;!--
# Effect of ballot truncation

This isn&apos;t totally true---if my ballot only lists A as my first choice and B as my second, it can be inferred that I like C less than either of them, even if I didn&apos;t explicitly say so.
But it can&apos;t be inferred whether I prefer C to D.
--&gt;
&lt;h1 id=&quot;propensity-to-a-two-party-system&quot;&gt;Propensity to a two-party system&lt;/h1&gt;
&lt;p&gt;A well-known critique of plurality voting, known as &lt;a href=&quot;https://en.wikipedia.org/wiki/Duverger%27s_law&quot;&gt;Duverger&#8217;s law&lt;/a&gt;, is that it tends toward a two-party system over time. The reasoning, of course, is that voters shy away from voting third-party for fear of splitting the vote. The United States, which has always used plurality voting nationally, has largely hewn to this law, with each &lt;a href=&quot;https://en.wikipedia.org/wiki/Party_system#United_States&quot;&gt;party system&lt;/a&gt; shakeup quickly stabilizing to two dominant parties. &lt;!-- with [a](https://en.wikipedia.org/wiki/1824_United_States_presidential_election) [few](https://en.wikipedia.org/wiki/1856_United_States_presidential_election) [exceptions](https://en.wikipedia.org/wiki/1912_United_States_presidential_election). --&gt; However, some contend that due to paradoxical results like Burlington, IRV has the same tendency over a long enough period.&lt;/p&gt;
&lt;p&gt;We can get a sense of whether this is true by looking at countries that use IRV nationally. For example, the Australian House of Representatives, the lower of its houses of parliament, has used IRV since 1918.&lt;a href=&quot;#fn10&quot; class=&quot;footnote-ref&quot; id=&quot;fnref10&quot;&gt;&lt;sup&gt;10&lt;/sup&gt;&lt;/a&gt; If we look at &lt;a href=&quot;https://australianpolitics.com/elections/house-results/house-election-results-since-1972&quot;&gt;results&lt;/a&gt; of House elections for the past half-century, we see that while politics is largely dominated by the left-leaning Labor Party and right-leaning Liberal and National Parties, a small number of seats have gone to Greens and independent candidates.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-australia-house.svg&quot; alt=&quot;Party allocations from Australian House elections since 1972. Note that the number of seats increased after 1983 from ~125 to ~150  &#160;Labor &#160;Liberal &#160;Liberal National &#160;National &#160;Country Liberal &#160;Greens &#160;Independent/other&quot; id=&quot;fig:aus-house&quot; /&gt;&lt;figcaption&gt;Party allocations from Australian House elections since 1972. Note that the number of seats increased after 1983 from ~125 to ~150&lt;br /&gt;
&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#e93834&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;a href=&quot;https://en.wikipedia.org/wiki/Australian_Labor_Party&quot;&gt;Labor&lt;/a&gt;&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#727ecf&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;a href=&quot;https://en.wikipedia.org/wiki/Liberal_Party_of_Australia&quot;&gt;Liberal&lt;/a&gt;&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#b9bfe7&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;a href=&quot;https://en.wikipedia.org/wiki/Liberal_National_Party_of_Queensland&quot;&gt;Liberal National&lt;/a&gt;&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#e6ab02&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;a href=&quot;https://en.wikipedia.org/wiki/National_Party_of_Australia&quot;&gt;National&lt;/a&gt;&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#d67c00&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;a href=&quot;https://en.wikipedia.org/wiki/Country_Liberal_Party&quot;&gt;Country Liberal&lt;/a&gt;&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#76a254&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;a href=&quot;https://en.wikipedia.org/wiki/Australian_Greens&quot;&gt;Greens&lt;/a&gt;&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#888888&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;Independent/other&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;It&#8217;s important to note that &lt;span class=&quot;citation&quot; data-cites=&quot;fig:aus-house&quot;&gt;@fig:aus-house&lt;/span&gt; presents statistical averages. Each bar represents the results of a 150 or so &lt;em&gt;individual&lt;/em&gt; elections, each of which might have seen different local factions competing on different issues. Nevertheless, compare this with the party allocations in the U.S. House during the same period:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-us-house.svg&quot; alt=&quot;Party allocations from U.S. House of Representatives elections since 1971 (from 92nd Congress on)  &#160;Republican &#160;Democrat &#160;Independent/other&quot; id=&quot;fig:us-house&quot; /&gt;&lt;figcaption&gt;Party allocations from U.S. House of Representatives elections since 1971 (from 92nd Congress on)&lt;br /&gt;
&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#e93834&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;Republican&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#727ecf&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;Democrat&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#888888&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;Independent/other&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;There are only a &lt;a href=&quot;https://en.wikipedia.org/wiki/Third-party_and_independent_members_of_the_United_States_House_of_Representatives#1949%E2%80%93present:_Modern_era&quot;&gt;handful&lt;/a&gt; of independents, most of whom are closely affiliated with one party or another, and only one third-party candidate: Libertarian Justin Amash, MI-3, who was elected as a Republican. So the U.S., possibly because as a side effect of plurality voting, is particularly inimical to third-party representation. We don&#8217;t see this effect in &lt;a href=&quot;https://commonslibrary.parliament.uk/research-briefings/cbp-8647/&quot;&gt;Commons elections&lt;/a&gt; in the U.K., however, which also use plurality voting, but has relatively rich third-party representations (note that the pink and gray bands in &lt;span class=&quot;citation&quot; data-cites=&quot;fig:uk-house&quot;&gt;@fig:uk-house&lt;/span&gt; represent multiple parties).&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;irv-uk-house.svg&quot; alt=&quot;Party allocations from U.K. House of Commons elections since 1970  &#160;Labour &#160;Conservative &#160;Liberal Democrats &#160;Scottish &amp;amp; Welsh national parties &#160;Independent/other&quot; id=&quot;fig:uk-house&quot; /&gt;&lt;figcaption&gt;Party allocations from U.K. House of Commons elections since 1970&lt;br /&gt;
&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#e93834&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;Labour&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#727ecf&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;Conservative&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#e6ab02&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;Liberal Democrats&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#c55faf&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;Scottish &amp;amp; Welsh national parties&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#888888&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;Independent/other&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;This may be an effect of the parliamentary system, which allows coalitions, reducing competition between ideologically similar parties. It may also be an effect of smaller constituencies&#8212;about 100,000 people per district in the U.K., versus 750,000 in the U.S.&#8212;making it easier for smaller parties to secure local support. The final salient difference is that U.S. House elections are much less consequential than Commons or Australian House elections, because they are more frequent (compare the sizes of the graphs), and because since &lt;a href=&quot;https://www.law.cornell.edu/constitution-conan/amendment-17&quot;&gt;1913&lt;/a&gt; the U.S. has also directly elected senators, though it&#8217;s unclear why this would make a difference. Possibly, the two-party system is simply too deeply set in U.S. culture to be meaningfully pried away.&lt;/p&gt;
&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;The pros of adopting IRV seem to be:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Relative simplicity, assuming the ballots are not designed by lunatics from Florida&lt;/li&gt;
&lt;li&gt;Allowing voters to express nuanced opinions&lt;/li&gt;
&lt;li&gt;Elimination of spoilage by small parties&lt;/li&gt;
&lt;li&gt;Probable reduction in tactical voting, and the slim possibility of third parties becoming serious contenders&lt;/li&gt;
&lt;li&gt;Possible reduction in negative campaigning&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;and the cons are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A possibly nontrivial one-time cost of converting voting machines and educating voters&lt;/li&gt;
&lt;li&gt;Small (5&#8211;10%) chance of spoilage with three or more large parties&lt;/li&gt;
&lt;li&gt;The very remote possibility of tactical voting by voting blocs on the extremes of the political spectrum&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It&#8217;s important in all this to avoid two traps. One is the &lt;a href=&quot;https://en.wikipedia.org/wiki/Lucas_critique&quot;&gt;Lucas&lt;/a&gt; trap: you can&#8217;t theorize about the outcome of an election using past data from a &lt;em&gt;different&lt;/em&gt; voting system. Both voters and political parties will change their strategies if the system changes. Burlington voters would not likely have voted the same way in 2009 if the decision was to have been by simple plurality.&lt;a href=&quot;#fn11&quot; class=&quot;footnote-ref&quot; id=&quot;fnref11&quot;&gt;&lt;sup&gt;11&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The second trap, of course, is of caring more about voting systems than their results. There are many more voting systems out there, many of them &lt;a href=&quot;https://www.daneckam.com/?p=374&quot;&gt;combining&lt;/a&gt; the methods above, and a whole &lt;a href=&quot;https://plato.stanford.edu/entries/social-choice/&quot;&gt;branch of economics&lt;/a&gt; that studies them. It&#8217;s easy to get stuck in the mire of voting system wonkery, but only IRV is on the ballot this year, so ultimately it doesn&#8217;t matter whether it is better than proportional Bayesian transferable semi-ranked-score-minimax; only whether it&#8217;s better than plurality.&lt;a href=&quot;#fn12&quot; class=&quot;footnote-ref&quot; id=&quot;fnref12&quot;&gt;&lt;sup&gt;12&lt;/sup&gt;&lt;/a&gt; Anthony Gottlieb in the &lt;em&gt;New Yorker&lt;/em&gt; &lt;a href=&quot;https://www.newyorker.com/magazine/2010/07/26/win-or-lose&quot;&gt;points out&lt;/a&gt; that:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Mathematics can suggest what approaches are worth trying, but it can&#8217;t reveal what will suit a particular place, and best deliver what we want from a democratic voting system: to create a government that feels legitimate to people&#8212;to reconcile people to being governed, and give them reason to feel that, win or lose (especially lose), the game is fair.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Incidentally, after a decade of dormancy, IRV is &lt;a href=&quot;https://vtdigger.org/2020/07/14/burlington-council-puts-ranked-choice-voting-on-november-ballot-%EF%BB%BF/&quot;&gt;back on the ballot&lt;/a&gt; in Burlington. It will be interesting to see if the public warms to it again.&lt;/p&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot;&gt;&lt;p&gt;Sometimes given the hokey name &#8220;first past the post&#8221;. Note that a &lt;strong&gt;plurality&lt;/strong&gt; is not the same as a &lt;strong&gt;majority&lt;/strong&gt;: a majority requires more than 50% of votes, while a plurality just requires more votes than anyone else.&lt;a href=&quot;#fnref1&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot;&gt;&lt;p&gt;See, e.g., &lt;a href=&quot;https://www.youtube.com/watch?v=HoAnYQZrNrQ&quot;&gt;PBS&lt;/a&gt; or &lt;a href=&quot;http://www.cgpgrey.com/politics-in-the-animal-kingdom/&quot;&gt;C.G.P. Grey&lt;/a&gt;.&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn3&quot;&gt;&lt;p&gt;Assuming voters&#8217; preferences are stable across time.&lt;a href=&quot;#fnref3&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn4&quot;&gt;&lt;p&gt;In a &lt;a href=&quot;https://en.wikipedia.org/wiki/Two-round_system&quot;&gt;two-round system&lt;/a&gt;, the second election really does take place, but with all but two candidates removed, to guarantee there will be a majority.&lt;a href=&quot;#fnref4&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn5&quot;&gt;&lt;p&gt;&lt;a href=&quot;https://web.archive.org/web/20110725111632/http://www.burlingtonvotes.org/20090303/2009%20Mayor%20Reports.zip&quot;&gt;Full ballot data&lt;/a&gt; (ZIP, 72 KiB)&lt;a href=&quot;#fnref5&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn6&quot;&gt;&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Copeland%27s_method&quot;&gt;Copeland&#8217;s method&lt;/a&gt;&lt;a href=&quot;#fnref6&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn7&quot;&gt;&lt;p&gt;See &lt;a href=&quot;https://www.youtube.com/embed/JtKAScORevQ&quot;&gt;this video&lt;/a&gt; for another illustration.&lt;a href=&quot;#fnref7&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn8&quot;&gt;&lt;p&gt;The former case is known as an &lt;em&gt;upward monotonicity violation&lt;/em&gt;, and the latter a &lt;em&gt;downward monotonicity violation&lt;/em&gt;.&lt;a href=&quot;#fnref8&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn9&quot;&gt;&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode r&quot;&gt;&lt;code class=&quot;sourceCode r&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;kw&quot;&gt;chisq.test&lt;/span&gt;(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-2&quot; title=&quot;2&quot;&gt;    &lt;span class=&quot;kw&quot;&gt;matrix&lt;/span&gt;(&lt;span class=&quot;kw&quot;&gt;c&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;2642&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;0.6&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-3&quot; title=&quot;3&quot;&gt;             &lt;span class=&quot;dv&quot;&gt;2642&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;0.4&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-4&quot; title=&quot;4&quot;&gt;             &lt;span class=&quot;dv&quot;&gt;96&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-5&quot; title=&quot;5&quot;&gt;             &lt;span class=&quot;dv&quot;&gt;204-96&lt;/span&gt;),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-6&quot; title=&quot;6&quot;&gt;        &lt;span class=&quot;dt&quot;&gt;nrow=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;))&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;a href=&quot;#fnref9&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn10&quot;&gt;&lt;p&gt;Ireland also uses runoff voting to elect its lower house, &lt;a href=&quot;https://en.wikipedia.org/wiki/D%C3%A1il_%C3%89ireann&quot;&gt;D&#225;il &#201;ireann&lt;/a&gt;, to elect its lower house, but it is more complicated as most district races have multiple winners.&lt;a href=&quot;#fnref10&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn11&quot;&gt;&lt;p&gt;Indeed, in the &lt;a href=&quot;https://www.burlingtonvt.gov/sites/default/files/CT/ElectionResults/20120306/election_summary_report_20120306.pdf&quot;&gt;2012 race&lt;/a&gt;, after IRV was repealed, only three candidates ran, with the independent barely mustering 5%.&lt;a href=&quot;#fnref11&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn12&quot;&gt;&lt;p&gt;(Source: &lt;a href=&quot;https://xkcd.com/1844/&quot;&gt;xkcd&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;irv-xkcd.png&quot; /&gt;&lt;a href=&quot;#fnref12&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
	</description>
		</item>
		<item>
			<title>Cambridge street trees</title>
			<link>https://alexklapheke.github.io/blog/publish/trees.md</link>
			<pubDate>Tue, 21 Jul 2020 20:49:29 -0400</pubDate>
	<description>
&lt;div class=&quot;epigraph&quot;&gt;
&lt;p&gt;I think that I shall never see&lt;br /&gt;
A billboard lovely as a tree.&lt;br /&gt;
Indeed, unless the billboards fall&lt;br /&gt;
I&#8217;ll never see a tree at all.&lt;/p&gt;
&lt;/div&gt;
&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;
&lt;p&gt;Every spring, the Callery pear down the street from me displays a magnificent panoply of white blossoms, and releases&#8230; let&#8217;s say a &lt;em&gt;distinct&lt;/em&gt; odor. A few months later, the tree of heaven in my backyard drops an incredible torrent of flowers onto my porch, and within a few months, another torrent of seed pods (this tree has it&#8217;s own smell which is marginally less unpleasant). It&#8217;s a subtle difference between a street lined with, say, honeylocusts and one lined with sycamores, but trees really do go a long way in defining the character of a place, making them a crucial consideration in urban planning.&lt;/p&gt;
&lt;p&gt;Like many cities, Cambridge has long maintained a &lt;a href=&quot;https://data.cambridgema.gov/Public-Works/Street-Trees/ni4i-5bnn&quot;&gt;dataset of all municipal trees&lt;/a&gt;, including the species, location, date planted, and &lt;a href=&quot;https://en.wikipedia.org/wiki/Diameter_at_breast_height&quot;&gt;diameter&lt;/a&gt;.&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; By exploring this data, we can see what trends and patterns emerge, and learn something about the arboreal life of our cities.&lt;/p&gt;
&lt;h1 id=&quot;cleaning&quot;&gt;Cleaning&lt;/h1&gt;
&lt;p&gt;Although the dataset does seem to cover every public tree, much of the data is missing. For example, 83% of trees are missing the date they were planted, presumably at least in part because they predate the record system (a few of those that do list dates are from the 1970s).&lt;/p&gt;
&lt;p&gt;There are many spurious values as well. Besides misaligned species names (to be discussed in &lt;span class=&quot;citation&quot; data-cites=&quot;sec:var&quot;&gt;@sec:var&lt;/span&gt;), there are several misspelled genera (e.g., &#8220;Planatus&#8221; for &lt;abbr title=&quot;sycamore&quot;&gt;&lt;em&gt;Platanus&lt;/em&gt;&lt;/abbr&gt;). The diameter of each tree is listed, but the highest values are 154, 715, 745, 915, and 945 inches, corresponding respectively to about 13, 60, 62, 76, and 79 feet (the &lt;a href=&quot;https://en.wikipedia.org/wiki/%C3%81rbol_del_Tule&quot;&gt;stoutest tree in the world&lt;/a&gt; is only 46 feet in diameter), casting all values into some suspicion. The dataset also lists properties such as number of trunks&#8212;one &lt;a href=&quot;https://goo.gl/maps/fzSmAtdHHqaXnHv5A&quot;&gt;katsura tree&lt;/a&gt; has ten, and two, a &lt;a href=&quot;https://goo.gl/maps/WjFi3ZdhdnzqxiG38&quot;&gt;Japanese tree lilac&lt;/a&gt; and a &lt;a href=&quot;https://goo.gl/maps/Ma7ErKrC9TMTSWmu8&quot;&gt;serviceberry&lt;/a&gt; have eleven&#8212;and things of municipal importance, such as whether there are overhead wires, or whether the roots are emerging through the sidewalk.&lt;/p&gt;
&lt;p&gt;I also included data about invasiveness, by grabbing the &lt;a href=&quot;https://www.mass.gov/doc/prohibited-plant-list-sorted-by-scientific-name/download&quot; class=&quot;pdf&quot;&gt;list&lt;/a&gt; of species considered invasive in Massachusetts, copying the scientific names to a text file, and merging.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-1&quot; title=&quot;1&quot;&gt;invasive_species &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; pd.read_csv(&lt;span class=&quot;st&quot;&gt;&amp;quot;prohibited-species.txt&amp;quot;&lt;/span&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-2&quot; title=&quot;2&quot;&gt;invasive_species[&lt;span class=&quot;st&quot;&gt;&amp;quot;Invasive&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;True&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-3&quot; title=&quot;3&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-4&quot; title=&quot;4&quot;&gt;trees &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; pd.merge(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-5&quot; title=&quot;5&quot;&gt;    left &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; trees,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-6&quot; title=&quot;6&quot;&gt;    right &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; invasive_species,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-7&quot; title=&quot;7&quot;&gt;    how &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;left&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-8&quot; title=&quot;8&quot;&gt;    on &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;st&quot;&gt;&amp;quot;Genus&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;species&amp;quot;&lt;/span&gt;]&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-9&quot; title=&quot;9&quot;&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-10&quot; title=&quot;10&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-11&quot; title=&quot;11&quot;&gt;trees[&lt;span class=&quot;st&quot;&gt;&amp;quot;Invasive&amp;quot;&lt;/span&gt;].fillna(&lt;span class=&quot;va&quot;&gt;False&lt;/span&gt;, inplace&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;True&lt;/span&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;SiteType&lt;/code&gt; column helpfully tells us whether the tree is, in fact, a tree at all, or a stump, a plot being prepared for a tree, etc. After cleaning, I removing all of the latter cases&#8212;although really, the cleaning was a process ongoing until the end.&lt;/p&gt;
&lt;h1 id=&quot;sec:var&quot;&gt;Varieties&lt;/h1&gt;
&lt;p&gt;The obvious first thing to do after cleaning is look at what varieties line the city&#8217;s streets. &lt;span class=&quot;citation&quot; data-cites=&quot;fig:gen&quot;&gt;@fig:gen&lt;/span&gt; shows the most popular genera as recorded in the dataset (their corresponding common names are in &lt;a href=&quot;#appendix-a-common-names-of-trees&quot;&gt;Appendix A&lt;/a&gt;).&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;trees-genera.svg&quot; alt=&quot;The top 20 genera of street tree in Cambridge&quot; id=&quot;fig:gen&quot; /&gt;&lt;figcaption&gt;The top 20 genera of street tree in Cambridge&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;However, just knowing that the streets are lined with maples (genus &lt;abbr title=&quot;maple&quot;&gt;&lt;em&gt;Acer&lt;/em&gt;&lt;/abbr&gt;) doesn&#8217;t tell us if they are towering, stately silver maples (&lt;abbr title=&quot;silver maple&quot;&gt;&lt;em&gt;A. saccharinum&lt;/em&gt;&lt;/abbr&gt;), or splendiferous red maples (&lt;abbr title=&quot;red maple&quot;&gt;&lt;em&gt;A. rubrum&lt;/em&gt;&lt;/abbr&gt;), or invasive Norway maples (&lt;abbr title=&quot;Norway maple&quot;&gt;&lt;em&gt;A. platanoides&lt;/em&gt;&lt;/abbr&gt;), nor does knowing there are over 3,000 oaks (genus &lt;abbr title=&quot;oak&quot;&gt;&lt;em&gt;Quercus&lt;/em&gt;&lt;/abbr&gt;) cast light on which of the &lt;a href=&quot;https://en.wikipedia.org/wiki/List_of_Quercus_species&quot;&gt;over 600 species&lt;/a&gt; they comprise. We can break this graph down further by species (&lt;span class=&quot;citation&quot; data-cites=&quot;fig:spec&quot;&gt;@fig:spec&lt;/span&gt;).&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;trees-species.svg&quot; alt=&quot;The top 20 genera of street tree in Cambridge, broken down by species (hover over each bar to see the specific name)&quot; id=&quot;fig:spec&quot; /&gt;&lt;figcaption&gt;The top 20 genera of street tree in Cambridge, broken down by species (hover over each bar to see the specific name)&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;There are some interesting takeaways here. For instance, not a single public apple tree (genus &lt;abbr title=&quot;apple&quot;&gt;&lt;em&gt;Malus&lt;/em&gt;&lt;/abbr&gt;) has been identified for species. This indicates that the data was not logged at the time of planting; possibly, the species were identified by sight in a later survey (ornamental apple trees are typically hard-to-identify hybrids). Some of the &#8220;unknown species&#8221; labels are clearly in error. &lt;abbr title=&quot;sweetgum&quot;&gt;&lt;em&gt;Liquidambar&lt;/em&gt;&lt;/abbr&gt;, for example, contains only four species, only one of which (&lt;abbr title=&quot;American sweetgum&quot;&gt;&lt;em&gt;L. styraciflua&lt;/em&gt;&lt;/abbr&gt;) is grown ornamentally in the U.S., and is easily distinguished from its relatives by its five-pointed leaves.&lt;a href=&quot;#fn2&quot; class=&quot;footnote-ref&quot; id=&quot;fnref2&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt; More alarmingly, &lt;abbr title=&quot;ginkgo&quot;&gt;&lt;em&gt;Ginkgo biloba&lt;/em&gt;&lt;/abbr&gt; is the only extant species in its entire class (a sister clade to the conifers), but 79 specimens are missing species information, and one is apparently of &lt;em&gt;Ginkgo triacanthos&lt;/em&gt;! Presumably, city arborists have not discovered a new living fossil, but rather this row has gotten mixed up somehow (maybe during merging) with a honeylocust, &lt;abbr title=&quot;honeylocust&quot;&gt;&lt;em&gt;Gleditsia triacanthos&lt;/em&gt;&lt;/abbr&gt;. We also see such botanical novelties as &lt;em&gt;Ulmus cordata&lt;/em&gt;, &lt;em&gt;Tilia calleryana&lt;/em&gt;, and, amusingly, &lt;em&gt;Acer acerifolia&lt;/em&gt;&#8212;literally, a maple-leafed maple.&lt;/p&gt;
&lt;p&gt;Besides the missing and spurious data, we see that over a third of city-planted maples are Norway maples, which are now &lt;a href=&quot;https://www.mass.gov/doc/prohibited-plant-list-sorted-by-scientific-name/download&quot; class=&quot;pdf&quot;&gt;illegal&lt;/a&gt; in Massachusetts due to their propensity to crowd out native species. In all, 2,282 trees considered invasive, representing five species, are present in the dataset.&lt;/p&gt;
&lt;p&gt;Invasive plants are not the only menace to biodiversity. We are lucky to have over a thousand elms in Cambridge&#8212;after Dutch elm disease ravaged populations in the 1960s and &#8217;70s, disease-resistant cultivars of &lt;abbr title=&quot;American elm&quot;&gt;&lt;em&gt;Ulmus americana&lt;/em&gt;&lt;/abbr&gt; were developed which, along with fungicide, managed the destruction. The chestnut blight fungus, introduced from East Asia around the turn of the 20th century, has made the American chestnut (&lt;abbr title=&quot;American chestnut&quot;&gt;&lt;em&gt;Castanea dentata&lt;/em&gt;&lt;/abbr&gt;) all but extinct, with a onetime population of several billion dwindling to a few hundred today. So I was surprised to see four trees in the genus &lt;abbr title=&quot;chestnut&quot;&gt;&lt;em&gt;Castanea&lt;/em&gt;&lt;/abbr&gt; in the dataset, but less surprised when three turned out to be misidentified horse chestnuts (&lt;abbr title=&quot;horse chestnut&quot;&gt;&lt;em&gt;Aesculus hippocastanum&lt;/em&gt;&lt;/abbr&gt;), and the fourth was&#8230; wait for it&#8230; &lt;a href=&quot;https://goo.gl/maps/2Jar5K1Qrc5mFW5RA&quot;&gt;a Norway maple&lt;/a&gt;.&lt;/p&gt;
&lt;h1 id=&quot;mapping&quot;&gt;Mapping&lt;/h1&gt;
&lt;p&gt;Every tree in the dataset has an associated latitude and longitude. Indeed, the coordinates given for each tree display &lt;a href=&quot;https://xkcd.com/2170/&quot;&gt;incredible precision&lt;/a&gt;, giving no fewer than 15 decimal places, making them &lt;a href=&quot;http://gis.stackexchange.com/a/8674&quot;&gt;accurate&lt;/a&gt; to about 100 picometers, or approximately an atomic radius (I have no idea how they chose which atom of the tree to use as a reference). In order to map trees against Cambridge&#8217;s &lt;a href=&quot;https://www.cambridgema.gov/GIS/gisdatadictionary/Basemap/BASEMAP_Roads&quot;&gt;basemap shapefiles&lt;/a&gt;, I used &lt;a href=&quot;https://pypi.org/project/pyshp/&quot;&gt;PyShp&lt;/a&gt; to parse the shapefiles and &lt;a href=&quot;https://pypi.org/project/PyCRS/&quot;&gt;PyCRS&lt;/a&gt; and &lt;a href=&quot;https://pypi.org/project/pyproj/&quot;&gt;PyProj&lt;/a&gt; to convert from &lt;a href=&quot;https://epsg.io/4326&quot;&gt;WGS84&lt;/a&gt; (i.e., standard latitude and longitude) to &lt;a href=&quot;https://epsg.io/102686&quot;&gt;NAD 1983&lt;/a&gt;, the coordinate system used in the shapefiles.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; pyproj &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; Transformer&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-2&quot; title=&quot;2&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-3&quot; title=&quot;3&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Convert between coordinate systems&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-4&quot; title=&quot;4&quot;&gt;transformer &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; Transformer.from_crs(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-5&quot; title=&quot;5&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# WGS84 (EPSG:4326)&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-6&quot; title=&quot;6&quot;&gt;    &lt;span class=&quot;st&quot;&gt;&amp;quot;+proj=longlat +a=6378137.0 +rf=298.257223563 +pm=0 +nodef&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-7&quot; title=&quot;7&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-8&quot; title=&quot;8&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# NAD 1983 StatePlane Massachusetts Mainland FIPS 2001 Feet&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-9&quot; title=&quot;9&quot;&gt;    &lt;span class=&quot;st&quot;&gt;&amp;quot;+proj=lcc +lat_1=41.71666666666667 +lat_2=42.68333333333333 &amp;quot;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-10&quot; title=&quot;10&quot;&gt;    &lt;span class=&quot;st&quot;&gt;&amp;quot;+lat_0=41 +lon_0=-71.5 +x_0=200000 +y_0=750000.0000000001 &amp;quot;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-11&quot; title=&quot;11&quot;&gt;    &lt;span class=&quot;st&quot;&gt;&amp;quot;+ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 no_defs&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-12&quot; title=&quot;12&quot;&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-13&quot; title=&quot;13&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-14&quot; title=&quot;14&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Convert coordinates of invasive trees and plot on basemap&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-15&quot; title=&quot;15&quot;&gt;&lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; label &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; invasives[&lt;span class=&quot;st&quot;&gt;&amp;quot;label&amp;quot;&lt;/span&gt;].unique():&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-16&quot; title=&quot;16&quot;&gt;    plt.scatter(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-17&quot; title=&quot;17&quot;&gt;        &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;transformer.transform(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-18&quot; title=&quot;18&quot;&gt;            invasives[invasives[&lt;span class=&quot;st&quot;&gt;&amp;quot;label&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;==&lt;/span&gt; label][&lt;span class=&quot;st&quot;&gt;&amp;quot;lon&amp;quot;&lt;/span&gt;].to_list(),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-19&quot; title=&quot;19&quot;&gt;            invasives[invasives[&lt;span class=&quot;st&quot;&gt;&amp;quot;label&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;==&lt;/span&gt; label][&lt;span class=&quot;st&quot;&gt;&amp;quot;lat&amp;quot;&lt;/span&gt;].to_list()&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-20&quot; title=&quot;20&quot;&gt;        ),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-21&quot; title=&quot;21&quot;&gt;    )&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In &lt;span class=&quot;citation&quot; data-cites=&quot;fig:invmap&quot;&gt;@fig:invmap&lt;/span&gt;, we can see the locations of invasive species of tree. Norway maples (&lt;abbr title=&quot;Norway maple&quot;&gt;&lt;em&gt;Acer platanoides&lt;/em&gt;&lt;/abbr&gt;) are predictably strewn across the city, but we see clusters of trees of heaven (&lt;abbr title=&quot;tree of heaven&quot;&gt;&lt;em&gt;Ailanthus altissima&lt;/em&gt;&lt;/abbr&gt;), and a few sizeable black locusts (&lt;abbr title=&quot;black locust&quot;&gt;&lt;em&gt;Robinia pseudoacacia&lt;/em&gt;&lt;/abbr&gt;), the impressive diameters indicating older trees. Of course, many more specimens of these noxious species exist on private land, and many of the worst invasive species are not trees at all, such as reeds (&lt;abbr title=&quot;common reed&quot;&gt;&lt;em&gt;Phragmites australis&lt;/em&gt;&lt;/abbr&gt;) and garlic mustard (&lt;abbr title=&quot;garlic mustard&quot;&gt;&lt;em&gt;Alliaria petiolata&lt;/em&gt;&lt;/abbr&gt;).&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;trees-map-invasives.svg&quot; alt=&quot;Locations of public trees in Cambridge considered invasive. Marker size is proportional to tree diameter.  &#160;Acer platanoides (2,121) &#160;Robinia pseudoacacia (55) &#160;Phellodendron amurense (54) &#160;Ailanthus altissima (50) &#160;Rhamnus cathartica (2)&quot; id=&quot;fig:invmap&quot; /&gt;&lt;figcaption&gt;Locations of public trees in Cambridge considered invasive. Marker size is proportional to tree diameter.&lt;br /&gt;
&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#1b9e77&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;abbr title=&quot;Norway maple&quot;&gt;&lt;em&gt;Acer platanoides&lt;/em&gt;&lt;/abbr&gt; (2,121)&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#d95f02&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;abbr title=&quot;black locust&quot;&gt;&lt;em&gt;Robinia pseudoacacia&lt;/em&gt;&lt;/abbr&gt; (55)&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#7570b3&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;abbr title=&quot;Amur cork tree&quot;&gt;&lt;em&gt;Phellodendron amurense&lt;/em&gt;&lt;/abbr&gt; (54)&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#e7298a&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;abbr title=&quot;tree of heaven&quot;&gt;&lt;em&gt;Ailanthus altissima&lt;/em&gt;&lt;/abbr&gt; (50)&lt;br /&gt;
&lt;svg width=&quot;8&quot; height=&quot;8&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#66a61e&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;abbr title=&quot;common buckthorn&quot;&gt;&lt;em&gt;Rhamnus cathartica&lt;/em&gt;&lt;/abbr&gt; (2)&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;To see what trees are popular in different areas, I downloaded the &lt;a href=&quot;https://www.cambridgema.gov/GIS/gisdatadictionary/Boundary/BOUNDARY_CDDNeighborhoods&quot;&gt;neighborhood boundary shapefiles&lt;/a&gt;, and used &lt;a href=&quot;https://pypi.org/project/Shapely/&quot;&gt;Shapely&lt;/a&gt; to categorize each latitude&#8211;longitude pair as being in one of the resulting polygons (dismayingly, although the dataset has a &lt;code&gt;Neighborhood&lt;/code&gt; column, it doesn&#8217;t contain a single data point). By filtering, we can see what the most popular species is in each neighborhood.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;trees-map-neighborhoods.svg&quot; alt=&quot;Most popular tree per neighborhood.  &#160;Gleditsia triacanthos &#160;Acer (unknown species) &#160;Acer rubrum &#160;Fraxinus americana &#160;Acer platanoides&quot; id=&quot;fig:neighmap&quot; /&gt;&lt;figcaption&gt;Most popular tree per neighborhood.&lt;br /&gt;
&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;10&quot;&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;20&quot; height=&quot;10&quot; fill=&quot;#1b9e77&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;abbr title=&quot;honeylocust&quot;&gt;&lt;em&gt;Gleditsia triacanthos&lt;/em&gt;&lt;/abbr&gt;&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;10&quot;&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;20&quot; height=&quot;10&quot; fill=&quot;#d95f02&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;abbr title=&quot;maple&quot;&gt;&lt;em&gt;Acer&lt;/em&gt;&lt;/abbr&gt; (unknown species)&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;10&quot;&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;20&quot; height=&quot;10&quot; fill=&quot;#7570b3&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;abbr title=&quot;red maple&quot;&gt;&lt;em&gt;Acer rubrum&lt;/em&gt;&lt;/abbr&gt;&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;10&quot;&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;20&quot; height=&quot;10&quot; fill=&quot;#e7298a&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;abbr title=&quot;white ash&quot;&gt;&lt;em&gt;Fraxinus americana&lt;/em&gt;&lt;/abbr&gt;&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;10&quot;&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;20&quot; height=&quot;10&quot; fill=&quot;#66a61e&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;abbr title=&quot;Norway maple&quot;&gt;&lt;em&gt;Acer platanoides&lt;/em&gt;&lt;/abbr&gt;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;We can get an even more granular look by plotting each individual tree:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;trees-map-neighborhoods-trees.svg&quot; alt=&quot;Distributions of each neighborhood&#8217;s most popular tree. Marker size is proportional to tree diameter.  &#160;Gleditsia triacanthos &#160;Acer (unknown species) &#160;Acer rubrum &#160;Fraxinus americana &#160;Acer platanoides&quot; id=&quot;fig:neighmapdots&quot; /&gt;&lt;figcaption&gt;Distributions of each neighborhood&#8217;s most popular tree. Marker size is proportional to tree diameter.&lt;br /&gt;
&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;10&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#1b9e77&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;abbr title=&quot;honeylocust&quot;&gt;&lt;em&gt;Gleditsia triacanthos&lt;/em&gt;&lt;/abbr&gt;&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;10&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#d95f02&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;abbr title=&quot;maple&quot;&gt;&lt;em&gt;Acer&lt;/em&gt;&lt;/abbr&gt; (unknown species)&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;10&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#7570b3&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;abbr title=&quot;red maple&quot;&gt;&lt;em&gt;Acer rubrum&lt;/em&gt;&lt;/abbr&gt;&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;10&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#e7298a&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;abbr title=&quot;white ash&quot;&gt;&lt;em&gt;Fraxinus americana&lt;/em&gt;&lt;/abbr&gt;&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;10&quot;&gt;&lt;circle cx=&quot;4&quot; cy=&quot;4&quot; r=&quot;4&quot; fill=&quot;#66a61e&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;&lt;abbr title=&quot;Norway maple&quot;&gt;&lt;em&gt;Acer platanoides&lt;/em&gt;&lt;/abbr&gt;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Here we see some interesting patterns. The unidentified maples so popular around MIT almost exclusively line the Charles River embankment. The white ashes (&lt;abbr title=&quot;white ash&quot;&gt;&lt;em&gt;Fraxinus americana&lt;/em&gt;&lt;/abbr&gt;) in the Cambridge Highlands are concentrated in the &lt;a href=&quot;https://www.google.com/maps/place/Lusitania+Field/@42.3879328,-71.1463062,17z&quot;&gt;Lusitania Woods&lt;/a&gt; by Fresh Pond.&lt;/p&gt;
&lt;h1 id=&quot;planting-dates&quot;&gt;Planting dates&lt;/h1&gt;
&lt;p&gt;As mentioned above, only 17% of trees have a plant date listed, making it difficult to find trends. Of course, it is still interesting to examine the data we have&#8212;&lt;span class=&quot;citation&quot; data-cites=&quot;fig:dates&quot;&gt;@fig:dates&lt;/span&gt; shows recorded plantings for the genera in &lt;span class=&quot;citation&quot; data-cites=&quot;fig:gen&quot;&gt;@fig:gen&lt;/span&gt; starting in 2007 since there are only a handful of data points before then.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;trees-dates.svg&quot; alt=&quot;Planting rate per year of 20 most popular genera since 2007, for those recorded.&quot; id=&quot;fig:dates&quot; /&gt;&lt;figcaption&gt;Planting rate per year of 20 most popular genera since 2007, for those recorded.&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;In particular, it is to determine when invasives were planted&#8212;of the 2,282 invasive trees in the dataset, only five Norway maples have a date listed. This is unsurprising&#8212;the &#8220;invasiveness&#8221; of invasives is precisely their ability to aggressively reproduce. However, even of these, we can see in &lt;span class=&quot;citation&quot; data-cites=&quot;fig:acerdates&quot;&gt;@fig:acerdates&lt;/span&gt; that two were planted in 2013 and 2014, respectively, well after the &lt;a href=&quot;https://www.mass.gov/service-details/prohibited-plant-list-background&quot;&gt;2006 law&lt;/a&gt; prohibiting such species took effect.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;trees-dates-acer.svg&quot; alt=&quot;Planting dates of Acer platanoides, for those recorded.  &#160;Law banning invasive species in effect&quot; id=&quot;fig:acerdates&quot; /&gt;&lt;figcaption&gt;Planting dates of &lt;abbr title=&quot;Norway maple&quot;&gt;&lt;em&gt;Acer platanoides&lt;/em&gt;&lt;/abbr&gt;, for those recorded.&lt;br /&gt;
&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;10&quot;&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;20&quot; height=&quot;10&quot; fill=&quot;#e8e8e8&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;Law banning invasive species in effect&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;There are some interesting trends visible in &lt;span class=&quot;citation&quot; data-cites=&quot;fig:dates&quot;&gt;@fig:dates&lt;/span&gt;&#8212;a recent fad for magnolias, a steady increase in serviceberry plantings (genus &lt;abbr title=&quot;serviceberry&quot;&gt;&lt;em&gt;Amelanchier&lt;/em&gt;&lt;/abbr&gt;), and spikes in pear tree plantings (nearly all of which are Callery pears, &lt;abbr title=&quot;Callery pear&quot;&gt;&lt;em&gt;Pyrus calleryana&lt;/em&gt;&lt;/abbr&gt;) in 2009 and 2017&#8212;although given the paucity of data, it is impossible to say if they are real.&lt;/p&gt;
&lt;p&gt;We can get another sense of trends by looking at location, rather than genus.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;trees-map-dates.svg&quot; alt=&quot;Planting dates of trees by location since 2007, for those with a date listed.  2007  2020&quot; id=&quot;fig:mapdates&quot; /&gt;&lt;figcaption&gt;Planting dates of trees by location since 2007, for those with a date listed.&lt;br /&gt;
&lt;br /&gt;
2007&lt;br /&gt;
&lt;svg width=&quot;11&quot; height=&quot;218&quot;&gt;&lt;image x=&quot;0&quot; y=&quot;0&quot; xlink:href=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAADaCAYAAABwzrisAAAABHNCSVQICAgIfAhkiAAAAV1JREFUaIHd2ktuAkEQA9D+gdjk3Dl1aK5Qb2GpCGurZLvcnoZh/rx+7yh+zvOuKnacPSaAZfKSyQR+jBiNsstRgQTeOTfK0DHOuimBU8An5nMd6qmjdac2SD6bdbFjlXMjKRDAtJSkGwCeVgUweRON4EkBcM5ncwNId3GDJm8SKGATaJPrxaECYTJlw4IUo7HhrtaFM06WbOzU5C4Cbd0C7hIkAK/17kBjQpvrukEg5rlJkFLrtsnBx0TKupwbTcBr/3OB1qKy7pF7TPQAW/hj/Uzg0aPrco82Etik+ZMnpYzlpVD4WxxY+BECmz+XutzptkbKVYFkI+hz7FtbjnOwN5q48YXZIBq5DZob1HWxm0wX6+zOX8Yi55wbmI0WNIKTqeuCAsvYqHXiBvwHIbtuoUGczY0enAV87XTL5JhATB28ebxHaAQFAmdct7jxheumM3jt2vNXBsub1fEBZTWVbVihQd8AAAAASUVORK5CYII=&quot; /&gt;&lt;/svg&gt;&lt;br /&gt;
2020&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;We can see several strings of orange and yellow where a whole row of trees was planted all at once. In addition, unsurprisingly, the largest trees tend to be the oldest, shown in purple.&lt;/p&gt;
&lt;p&gt;There is much more I would like to do with this data&#8212;and much more, and cleaner, data I&#8217;d like to have&#8212;but I&#8217;ve learned a lot about Cambridge&#8217;s trees, especially about the prevalence of invasive species on my local streets.&lt;/p&gt;
&lt;h1 id=&quot;appendix-a-common-names-of-trees&quot; class=&quot;unnumbered&quot;&gt;Appendix A: Common names of trees&lt;/h1&gt;
&lt;table&gt;
&lt;caption&gt;Common names of the tree genera found in Cambridge. Note that, in general, there is not a one-to-one correspondence between common and scientific names, which is why the latter are generally preferred. {#tbl:latin}&lt;/caption&gt;
&lt;thead&gt;
&lt;tr class=&quot;header&quot;&gt;
&lt;th&gt;Genus&lt;/th&gt;
&lt;th&gt;Common name&lt;/th&gt;
&lt;th&gt;Family (APG IV &lt;span class=&quot;citation&quot; data-cites=&quot;apg4&quot;&gt;[@apg4]&lt;/span&gt;)&lt;/th&gt;
&lt;th&gt;Population&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Abies&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;fir&lt;/td&gt;
&lt;td&gt;Pinaceae&lt;/td&gt;
&lt;td&gt;46&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Acer&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;maple&lt;/td&gt;
&lt;td&gt;Sapindaceae&lt;/td&gt;
&lt;td&gt;4,875&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Aesculus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;horse chestnut&lt;/td&gt;
&lt;td&gt;Sapindaceae&lt;/td&gt;
&lt;td&gt;84&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Ailanthus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;tree of heaven&lt;/td&gt;
&lt;td&gt;Simaroubaceae&lt;/td&gt;
&lt;td&gt;67&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Amelanchier&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;serviceberry&lt;/td&gt;
&lt;td&gt;Rosaceae&lt;/td&gt;
&lt;td&gt;499&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Betula&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;birch&lt;/td&gt;
&lt;td&gt;Betulaceae&lt;/td&gt;
&lt;td&gt;374&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Carpinus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;hornbeam&lt;/td&gt;
&lt;td&gt;Betulaceae&lt;/td&gt;
&lt;td&gt;205&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Carya&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;hickory&lt;/td&gt;
&lt;td&gt;Juglandaceae&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Castanea&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;chestnut&lt;/td&gt;
&lt;td&gt;Fagaceae&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Catalpa&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;catalpa&lt;/td&gt;
&lt;td&gt;Bignoniaceae&lt;/td&gt;
&lt;td&gt;27&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Cedrus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;cedar&lt;/td&gt;
&lt;td&gt;Pinaceae&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Celtis&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;hackberry&lt;/td&gt;
&lt;td&gt;Cannabaceae&lt;/td&gt;
&lt;td&gt;155&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Cercidiphyllum&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;katsura&lt;/td&gt;
&lt;td&gt;Cercidiphyllaceae&lt;/td&gt;
&lt;td&gt;79&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Cercis&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;redbud&lt;/td&gt;
&lt;td&gt;Fabaceae&lt;/td&gt;
&lt;td&gt;169&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Chionanthus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;fringetre&lt;/td&gt;
&lt;td&gt;Oleaceae&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Cladrastis&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;yellowwood&lt;/td&gt;
&lt;td&gt;Fabaceae&lt;/td&gt;
&lt;td&gt;122&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Cornus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;dogwood&lt;/td&gt;
&lt;td&gt;Cornaceae&lt;/td&gt;
&lt;td&gt;504&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Corylus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;hazel&lt;/td&gt;
&lt;td&gt;Betulaceae&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Cotinus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;smoketree&lt;/td&gt;
&lt;td&gt;Anacardiaceae&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Crataegus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;hawthorn&lt;/td&gt;
&lt;td&gt;Rosaceae&lt;/td&gt;
&lt;td&gt;82&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Enkianthus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;enkianthus&lt;/td&gt;
&lt;td&gt;Ericaceae&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Eucommia&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;Chinese rubber tree&lt;/td&gt;
&lt;td&gt;Eucommiaceae&lt;/td&gt;
&lt;td&gt;51&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Fagus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;beech&lt;/td&gt;
&lt;td&gt;Fagaceae&lt;/td&gt;
&lt;td&gt;130&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Fraxinus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;ash&lt;/td&gt;
&lt;td&gt;Oleaceae&lt;/td&gt;
&lt;td&gt;1,427&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Ginkgo&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;ginkgo&lt;/td&gt;
&lt;td&gt;Ginkgoaceae&lt;/td&gt;
&lt;td&gt;467&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Gleditsia&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;honeylocust&lt;/td&gt;
&lt;td&gt;Fabaceae&lt;/td&gt;
&lt;td&gt;2,637&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Gymnocladus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;coffeetree&lt;/td&gt;
&lt;td&gt;Fabaceae&lt;/td&gt;
&lt;td&gt;171&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Halesia&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;silverbell&lt;/td&gt;
&lt;td&gt;Styracaceae&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Hamamelis&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;witch hazel&lt;/td&gt;
&lt;td&gt;Hamamelidaceae&lt;/td&gt;
&lt;td&gt;46&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Ilex&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;holly&lt;/td&gt;
&lt;td&gt;Aquifoliaceae&lt;/td&gt;
&lt;td&gt;33&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Juglans&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;walnut&lt;/td&gt;
&lt;td&gt;Juglandaceae&lt;/td&gt;
&lt;td&gt;19&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Juniperus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;juniper&lt;/td&gt;
&lt;td&gt;Cupressaceae&lt;/td&gt;
&lt;td&gt;104&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Koelreuteria&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;golden rain tree&lt;/td&gt;
&lt;td&gt;Sapindaceae&lt;/td&gt;
&lt;td&gt;106&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Laburnum&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;golden rain&lt;/td&gt;
&lt;td&gt;Fabaceae&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Larix&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;larch&lt;/td&gt;
&lt;td&gt;Pinaceae&lt;/td&gt;
&lt;td&gt;17&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Liquidambar&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;sweetgum&lt;/td&gt;
&lt;td&gt;Altingiaceae&lt;/td&gt;
&lt;td&gt;377&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Liriodendron&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;tuliptree&lt;/td&gt;
&lt;td&gt;Magnoliaceae&lt;/td&gt;
&lt;td&gt;177&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Maackia&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;maackia&lt;/td&gt;
&lt;td&gt;Fabaceae&lt;/td&gt;
&lt;td&gt;26&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Magnolia&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;magnolia&lt;/td&gt;
&lt;td&gt;Magnoliaceae&lt;/td&gt;
&lt;td&gt;244&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Malus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;apple&lt;/td&gt;
&lt;td&gt;Rosaceae&lt;/td&gt;
&lt;td&gt;762&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Metasequoia&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;dawn redwood&lt;/td&gt;
&lt;td&gt;Cupressaceae&lt;/td&gt;
&lt;td&gt;49&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Morus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;mulberry&lt;/td&gt;
&lt;td&gt;Moraceae&lt;/td&gt;
&lt;td&gt;33&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Nyssa&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;tupelo&lt;/td&gt;
&lt;td&gt;Nyssaceae&lt;/td&gt;
&lt;td&gt;25&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Ostrya&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;hophornbeam&lt;/td&gt;
&lt;td&gt;Betulaceae&lt;/td&gt;
&lt;td&gt;40&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Oxydendrum&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;sourwood&lt;/td&gt;
&lt;td&gt;Ericaceae&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Parrotia&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;ironwood&lt;/td&gt;
&lt;td&gt;Hamamelidaceae&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Phellodendron&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;cork tree&lt;/td&gt;
&lt;td&gt;Rutaceae&lt;/td&gt;
&lt;td&gt;59&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Picea&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;spruce&lt;/td&gt;
&lt;td&gt;Pinaceae&lt;/td&gt;
&lt;td&gt;105&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Pinus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;pine&lt;/td&gt;
&lt;td&gt;Pinaceae&lt;/td&gt;
&lt;td&gt;964&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Platanus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;sycamore&lt;/td&gt;
&lt;td&gt;Platanaceae&lt;/td&gt;
&lt;td&gt;1,244&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Populus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;poplar/aspen&lt;/td&gt;
&lt;td&gt;Salicaceae&lt;/td&gt;
&lt;td&gt;192&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Prunus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;cherry/plum&lt;/td&gt;
&lt;td&gt;Rosaceae&lt;/td&gt;
&lt;td&gt;1,092&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Pseudotsuga&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;Douglas fir&lt;/td&gt;
&lt;td&gt;Pinaceae&lt;/td&gt;
&lt;td&gt;11&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Ptelea&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;hoptree&lt;/td&gt;
&lt;td&gt;Rutaceae&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Pyrus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;pear&lt;/td&gt;
&lt;td&gt;Rosaceae&lt;/td&gt;
&lt;td&gt;1,072&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Quercus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;oak&lt;/td&gt;
&lt;td&gt;Fagaceae&lt;/td&gt;
&lt;td&gt;3,015&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Rhamnus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;buckthorn&lt;/td&gt;
&lt;td&gt;Rhamnaceae&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Robinia&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;black locust&lt;/td&gt;
&lt;td&gt;Fabaceae&lt;/td&gt;
&lt;td&gt;59&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Salix&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;willow&lt;/td&gt;
&lt;td&gt;Salicaceae&lt;/td&gt;
&lt;td&gt;38&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Sassafras&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;sassafras&lt;/td&gt;
&lt;td&gt;Lauraceae&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Sciadopitys&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;umbrella pine&lt;/td&gt;
&lt;td&gt;Sciadopityaceae&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Sorbus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;rowan&lt;/td&gt;
&lt;td&gt;Rosaceae&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Stewartia&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;tea tree&lt;/td&gt;
&lt;td&gt;Theaceae&lt;/td&gt;
&lt;td&gt;19&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Styphnolobium&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;pagoda tree&lt;/td&gt;
&lt;td&gt;Fabaceae&lt;/td&gt;
&lt;td&gt;357&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Styrax&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;storax&lt;/td&gt;
&lt;td&gt;Styracaceae&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Syringa&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;lilac&lt;/td&gt;
&lt;td&gt;Oleaceae&lt;/td&gt;
&lt;td&gt;422&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Taxus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;yew&lt;/td&gt;
&lt;td&gt;Taxaceae&lt;/td&gt;
&lt;td&gt;26&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Thuja&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;arborvitae&lt;/td&gt;
&lt;td&gt;Cupressaceae&lt;/td&gt;
&lt;td&gt;142&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Tilia&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;linden&lt;/td&gt;
&lt;td&gt;Malvaceae&lt;/td&gt;
&lt;td&gt;1,544&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Tsuga&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;hemlock&lt;/td&gt;
&lt;td&gt;Pinaceae&lt;/td&gt;
&lt;td&gt;101&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Ulmus&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;elm&lt;/td&gt;
&lt;td&gt;Ulmaceae&lt;/td&gt;
&lt;td&gt;1,204&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;&lt;em&gt;Viburnum&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;viburnum&lt;/td&gt;
&lt;td&gt;Adoxaceae&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;&lt;em&gt;Zelkova&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;zelokva&lt;/td&gt;
&lt;td&gt;Ulmaceae&lt;/td&gt;
&lt;td&gt;627&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot;&gt;&lt;p&gt;They&#8217;ve also compiled it into quite a nice &lt;a href=&quot;https://gis.cambridgema.gov/dpw/trees/trees_walk.html&quot;&gt;browsable map&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://opentrees.org/&quot;&gt;OpenTrees.org&lt;/a&gt; maintains a collection of such datasets (possible fodder for future projects) as well as a browsable map of all of them.&lt;a href=&quot;#fnref1&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot;&gt;&lt;p&gt;Like so (&lt;a href=&quot;https://commons.wikimedia.org/wiki/File:NAS-062-c_Liquidambar_styraciflua.png&quot;&gt;source&lt;/a&gt;) &lt;img src=&quot;sweetgum.jpg&quot; /&gt;&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
	</description>
		</item>
		<item>
			<title>Automated essay scoring</title>
			<link>https://alexklapheke.github.io/blog/publish/essay.md</link>
			<pubDate>Sun, 12 Jul 2020 18:20:44 -0400</pubDate>
	<description>
&lt;!-- https://www.forbes.com/sites/petergreene/2020/05/25/no-software-still-cant-grade-student-essays/ --&gt;
&lt;!-- https://www.ets.org/research/topics/as_nlp --&gt;
&lt;div class=&quot;epigraph&quot;&gt;
&lt;p&gt;&#8217;Tis hard to say, if greater Want of Skill&lt;br /&gt;
Appear in Writing or in Judging ill&lt;/p&gt;
&lt;/div&gt;
&lt;h1 id=&quot;prolegomenon&quot;&gt;Prolegomenon&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Automated_essay_scoring&quot;&gt;Automated Essay Scoring&lt;/a&gt; has been contemplated as an application of machine learning since its earliest days. The ETS began using its proprietary &lt;a href=&quot;https://www.ets.org/erater/about&quot;&gt;e-rater&lt;/a&gt; in 1999, which, with a human cohort, now grades the SAT essay. In 2012, the Hewlitt Foundation sponsored the &lt;a href=&quot;https://www.kaggle.com/c/asap-aes&quot;&gt;Automated Student Assessment Prize&lt;/a&gt; (ASAP), offering a $100,000 reward for the best scoring system. Not long after, &lt;span class=&quot;citation&quot; data-cites=&quot;shermis2013contrasting&quot;&gt;@shermis2013contrasting&lt;/span&gt; found that automated scoring systems performed similarly to human graders, a claim met with both &lt;a href=&quot;https://www.insidehighered.com/news/2012/04/13/large-study-shows-little-difference-between-human-and-robot-essay-graders&quot;&gt;praise&lt;/a&gt; and &lt;a href=&quot;https://www.nytimes.com/2012/04/23/education/robo-readers-used-to-grade-test-essays.html&quot;&gt;skepticism&lt;/a&gt;. Les Perelman, for example, inveighed that e-rater looked for particular stylistic cues without considering their rhetorical effect:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;E-Rater, [Perelman] said, does not like short sentences.&lt;/p&gt;
&lt;p&gt;Or short paragraphs.&lt;/p&gt;
&lt;p&gt;Or sentences that begin with &#8220;or.&#8221; And sentences that start with &#8220;and.&#8221; Nor sentence fragments.&lt;/p&gt;
&lt;p&gt;However, he said, e-Rater likes connectors, like &#8220;however,&#8221; which serve as programming proxies for complex thinking. Moreover, &#8220;moreover&#8221; is good, too.&lt;/p&gt;
&lt;p&gt;Gargantuan words are indemnified because e-Rater interprets them as a sign of lexical complexity. &#8220;Whenever possible,&#8221; Mr.&#160;Perelman advises, &#8220;use a big word. &#8216;Egregious&#8217; is better than &#8216;bad.&#8217;&#8221;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;And in a more thorough rejoinder &lt;span class=&quot;citation&quot; data-cites=&quot;perelman2013critique&quot;&gt;[-@perelman2013critique]&lt;/span&gt;, Perelman contests the statistical results as cherry-picked:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The clearest omission is the failure of the authors to report the fairly large percentage of machine values for the Pearson &lt;span class=&quot;math inline&quot;&gt;&lt;em&gt;r&lt;/em&gt;&lt;/span&gt; and the Quadratic Weighted Kappa that fell below the minimum standard of 0.7. [&#8230;] Any value below 0.7 will be predicting significantly less than half the population and, because this is an exponential function, small decreases in value produce large decreases in the percentage accurately predicted. [&#8230;] Yet for the Quadratic Weighted Kappa, 28 of the 81 machine scores, 35.6%, are below the minimally acceptable level of 0.7, even though the machines had the advantage in half of the essay sets of matching an inflated Resolved Score. In contrast, the human readers, who had to match each other with no artificial advantage, had only one Quadratic Weighted Kappa below 0.7, for the composite score on essay set #8 or only 1 out of 9 or 11.1%.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Besides these issues, and the ethics of eschewing a human reader&#8217;s eye, criticism of these systems has focused on the ease of gaming them, such as &lt;span class=&quot;citation&quot; data-cites=&quot;powers2002stumping&quot;&gt;@powers2002stumping&lt;/span&gt;, who managed to finagle higher scores from e-rater than humans were willing to grant (though not lower scores). Perelman himself, in response to a prompt about whether &#8220;the rising cost of a college education is the fault of students who demand [&#8230;] luxuries&#8221;, wrote an essay, excerpted below, which despite earning e-rater&#8217;s highest possible score of 6, is laden with solecisms, factual errors, and non sequiturs, including a full line of Allen Ginsberg&#8217;s &#8220;Howl&#8221; (the full essay is reproduced in &lt;a href=&quot;#appendix-a-perelmans-2012-essay&quot;&gt;Appendix A&lt;/a&gt;):&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I live in a luxury dorm. In reality, it costs no more than rat infested rooms at a Motel Six. The best minds of my generation were destroyed by madness, starving hysterical naked, and publishing obscene odes on the windows of the skull. Luxury dorms pay for themselves because they generate thousand and thousands of dollars of revenue. In the Middle Ages, the University of Paris grew because it provided comfortable accommodations for each of its students, large rooms with servants and legs of mutton. Although they are expensive, these rooms are necessary to learning. The second reason for the five-paragraph theme is that it makes you focus on a single topic. Some people start writing on the usual topic, like TV commercials, and they wind up all over the place, talking about where TV came from or capitalism or health foods or whatever. But with only five paragraphs and one topic you&#8217;re not tempted to get beyond your original idea, like commercials are a good source of information about products. You give your three examples, and zap! you&#8217;re done. This is another way the five-paragraph theme keeps you from thinking too much.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--
The question of whether computer models---including the most sophisticated ones, such as GPT-2---can understand

This is similar to a genre of [Google Translate poetry](https://languagelog.ldc.upenn.edu/nll/?cat=299) in which the same letter or syllable is repeated over and over, as in @fig:googletranslate. Having never been trained on sheer noise, the translation engine can only produce a meaningful &quot;translation&quot; of what it is fed.

![Google Translate desparately seeking order where there is only chaos. Source: [Riddled](http://eusa-riddled.blogspot.com/2017/05/sorry-for-inconvenience.html)](nu.png){#fig:googletranslate}
--&gt;
&lt;p&gt;With the above criticisms leveled, I should disclaim that I am training a model to &lt;em&gt;predict essay scores&lt;/em&gt;, not to &lt;em&gt;score essays&lt;/em&gt;, which is a much harder task (and should be held to a much higher standard) and not an obviously meaningful thing to ask of a mathematical model to begin with. However, the results show that much&#8212;even if not all&#8212;of what constitutes an essay grade is not the &lt;em&gt;je ne sais quoi&lt;/em&gt; only a human evaluator can glimpse, but rather mechanical issues that can be straightforwardly calculated and modeled.&lt;/p&gt;
&lt;h1 id=&quot;sec:dataexp&quot;&gt;Data exploration &amp;amp; cleaning&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;h2 id=&quot;essay-set-selection&quot;&gt;Essay set selection&lt;/h2&gt;
&lt;p&gt;The corpus is in the form of 13,000 essays, totaling 2.9 million words&#8212;more than twice the length of Proust&#8217;s &lt;em&gt;In Search of Lost Time&lt;/em&gt;. The length, however, was not as immediate an obstacle as the composition, shown in &lt;span class=&quot;citation&quot; data-cites=&quot;tbl:sets&quot;&gt;@tbl:sets&lt;/span&gt;. The eight essay sets were not only responding to different prompts, but were of different lengths and genres, written by students of different grade levels, and, most importantly, scored using incommensurate rubrics and scoring protocols.&lt;/p&gt;
&lt;table&gt;
&lt;caption&gt;Summary of the essay sets in the ASAP corpus. &#8220;Rubric range&#8221; and &#8220;resolved range&#8221; are scores before and after adjudication, respectively. Adjudication rules have been simplified {#tbl:sets}&lt;/caption&gt;
&lt;thead&gt;
&lt;tr class=&quot;header&quot;&gt;
&lt;th style=&quot;text-align: left;&quot;&gt;Essay set&lt;/th&gt;
&lt;th style=&quot;text-align: left;&quot;&gt;Grade level&lt;/th&gt;
&lt;th style=&quot;text-align: left;&quot;&gt;Genre&lt;/th&gt;
&lt;th style=&quot;text-align: left;&quot;&gt;Train size&lt;/th&gt;
&lt;th style=&quot;text-align: left;&quot;&gt;Test size&lt;/th&gt;
&lt;th style=&quot;text-align: left;&quot;&gt;Avg. length&lt;/th&gt;
&lt;th style=&quot;text-align: left;&quot;&gt;Rubric range&lt;/th&gt;
&lt;th style=&quot;text-align: left;&quot;&gt;Resolved score range&lt;/th&gt;
&lt;th style=&quot;text-align: left;&quot;&gt;Adjudication&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;1&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;8&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Persuasion&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;1,785&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;592&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;350&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;1&#8211;6&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;2&#8211;12&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Sum if adjacent, else third scorer&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;2&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;10&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Persuasion&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;1,800&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;600&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;350&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;1&#8211;6, 1&#8211;4&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;1&#8211;6, 1&#8211;4&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;First&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;3&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;10&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Exposition&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;1,726&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;575&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;150&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;0&#8211;3&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;0&#8211;3&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Higher if adjacent, else third scorer&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;4&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;10&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Exposition&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;1,772&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;589&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;150&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;0&#8211;3&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;0&#8211;3&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Higher if adjacent, else third scorer&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;5&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;8&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Exposition&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;1,805&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;601&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;150&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;0&#8211;4&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;0&#8211;4&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Higher&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;6&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;10&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Exposition&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;1,800&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;600&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;150&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;0&#8211;4&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;0&#8211;4&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Higher&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;7&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;7&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Narrative&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;1,730&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;576&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;250&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;0&#8211;15&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;0&#8211;30&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Sum&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;8&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;10&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Narrative&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;918&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;305&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;650&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;0&#8211;30, 0&#8211;30&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;0&#8211;60&lt;/td&gt;
&lt;td style=&quot;text-align: left;&quot;&gt;Sum if adjacent, else third scorer&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Limiting myself to a single essay set would have produced a somewhat feeble model, as words idiosyncratic to the topic in question became artificially elevated in importance. In the end, I combined sets 3 and 4, which both consisted of expository essays written by tenth graders, graded on a scale from 0 (worst) to 3 (best). These scores are holistic, i.e., not broken down into categories representing grammar and mechanics, relevance, organization, etc., which makes them easier for a model to predict.&lt;/p&gt;
&lt;h2 id=&quot;data-cleaning&quot;&gt;Data cleaning&lt;/h2&gt;
&lt;p&gt;The scores are broken down, for each essay set, into &#8220;domain scores&#8221; representing the valuations of the individual scorers. In the interest of having a single number to try to predict, I combined these scores by taking the mean:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;co&quot;&gt;# If only one score exists, use that. Otherwise, take the mean of both scores.&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-2&quot; title=&quot;2&quot;&gt;essays[&lt;span class=&quot;st&quot;&gt;&amp;quot;score&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;list&lt;/span&gt;(&lt;span class=&quot;bu&quot;&gt;map&lt;/span&gt;(np.nanmean, &lt;span class=&quot;bu&quot;&gt;zip&lt;/span&gt;(essays[&lt;span class=&quot;st&quot;&gt;&amp;quot;domain1_score&amp;quot;&lt;/span&gt;], essays[&lt;span class=&quot;st&quot;&gt;&amp;quot;domain2_score&amp;quot;&lt;/span&gt;])))&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can then look at the way scores are distributed among the essays in our chosen subset.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;essays-score-hist.svg&quot; alt=&quot;Number of essays given each score&quot; id=&quot;fig:score&quot; /&gt;&lt;figcaption&gt;Number of essays given each score&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;In &lt;span class=&quot;citation&quot; data-cites=&quot;fig:score&quot;&gt;@fig:score&lt;/span&gt;, we see that the scorers of the fourth essay set were somewhat less lenient than those grading the third, the latter of whom awarded the highest score to a full quarter of the papers, and the lowest score of 0 to only 39 unhappy test-takers. Putting these together, we have a roughly normal-looking distribution, with many ones and twos, and fewer zeroes and threes. This gives us a baseline to use for the modeling below: a dumb model, which assigned every essay to the plurality score class, giving every essay a score 1, would have an accuracy of 35%. This is the number our models must beat.&lt;/p&gt;
&lt;p&gt;The essays themselves are in little need of cleaning: they are hand-transcribed from the originals, and have been anonymized by replacing named entities, including names, dates, addresses, and numbers, with enumerated placeholders.&lt;/p&gt;
&lt;h2 id=&quot;data-exploration&quot;&gt;Data exploration&lt;a href=&quot;#fn2&quot; class=&quot;footnote-ref&quot; id=&quot;fnref2&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;A basic exploration of the essays shows some striking patters. For example, as &lt;span class=&quot;citation&quot; data-cites=&quot;fig:length&quot;&gt;@fig:length&lt;/span&gt; illustrates, score is highly correlated with length at &lt;span class=&quot;math inline&quot;&gt;&lt;em&gt;R&lt;/em&gt;&lt;sup&gt;2&lt;/sup&gt;&#8196;=&#8196;0.51&lt;/span&gt;, meaning that over half the variation in score can be explained by variation in length. In other words, all else held equal, adding 82 words corresponds with a point increase in score.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;essay-score-length.svg&quot; alt=&quot;Length of essays (number of word tokens) by score. Box shows IQR. Whiskers show full range of data.&quot; id=&quot;fig:length&quot; /&gt;&lt;figcaption&gt;Length of essays (number of word tokens) by score. Box shows IQR. Whiskers show full range of data.&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;One interesting thing we see is that, despite the correlation, there are many essays earning top marks that are almost impossibly short. The following are recorded in the dataset as having earned a top score (both prompts instructed students to use examples from the texts):&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The features of the setting affect the cyclist in many ways. It made him tired thirsty and he was near exaustion [sic].&lt;a href=&quot;#fn3&quot; class=&quot;footnote-ref&quot; id=&quot;fnref3&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Because she saying when the @CAPS1 grow back she will be @CAPS2 to take the test again.&lt;a href=&quot;#fn4&quot; class=&quot;footnote-ref&quot; id=&quot;fnref4&quot;&gt;&lt;sup&gt;4&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Reserved need to check keenly&lt;a href=&quot;#fn5&quot; class=&quot;footnote-ref&quot; id=&quot;fnref5&quot;&gt;&lt;sup&gt;5&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That that gnomic last &#8220;essay&#8221; (yes, that&#8217;s the whole text!) earned a coveted score of 3 is almost certainly an error, though the source of the error (the recording of the scores, the compilation of the dataset, or the scoring process itself) is as mysterious as the cryptic phrase&#8217;s meaning. However, there doesn&#8217;t seem to be an objective way of pruning these aberrant rows from the dataset, necessitating my leaving them in.&lt;/p&gt;
&lt;!--
We can try to estimate vocabulary by looking at number of word types; however, this runs into two problems.
The first is that number of types closely tracks number of tokens ($R^2=0.92$), meaning that type length is basically a proxy for token length.
The second problem is that lower-scored essays are more likely to have misspelled words, and in particular to misspell the same word multiple ways, which will inflate the type count

```python
# Type count minus misspellings
essays[&quot;types&quot;] = len(set([word.lemma_ for word in doc if is_word(word)]) &amp; wordlist)

# Type-token ratio
essays[&quot;type_ratio&quot;] = essays[&quot;types&quot;] / essays[&quot;tokens&quot;]
```
--&gt;
&lt;p&gt;Other measures are telling as well. For instance, we can look at the rate of misspelled words, by tokenizing with spaCy, and counting each token that is not in a given wordlist.&lt;a href=&quot;#fn6&quot; class=&quot;footnote-ref&quot; id=&quot;fnref6&quot;&gt;&lt;sup&gt;6&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; spacy&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-2&quot; title=&quot;2&quot;&gt;nlp &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; spacy.load(&lt;span class=&quot;st&quot;&gt;&amp;quot;en&amp;quot;&lt;/span&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-3&quot; title=&quot;3&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-4&quot; title=&quot;4&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Generate wordlist&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-5&quot; title=&quot;5&quot;&gt;&lt;span class=&quot;cf&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;open&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;/usr/share/dict/words&amp;quot;&lt;/span&gt; , &lt;span class=&quot;st&quot;&gt;&amp;quot;r&amp;quot;&lt;/span&gt;) &lt;span class=&quot;im&quot;&gt;as&lt;/span&gt; infile:&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-6&quot; title=&quot;6&quot;&gt;    wordlist &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;set&lt;/span&gt;(infile.read().lower().strip().split(&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;))&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-7&quot; title=&quot;7&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-8&quot; title=&quot;8&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Number of words that are misspelled&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-9&quot; title=&quot;9&quot;&gt;essays[&lt;span class=&quot;st&quot;&gt;&amp;quot;misspellings&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;len&lt;/span&gt;([word &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; word &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; nlp(essays[&lt;span class=&quot;st&quot;&gt;&amp;quot;essay&amp;quot;&lt;/span&gt;])&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-10&quot; title=&quot;10&quot;&gt;     &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;not&lt;/span&gt; word.is_space&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-11&quot; title=&quot;11&quot;&gt;     &lt;span class=&quot;kw&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;not&lt;/span&gt; word.is_punct&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-12&quot; title=&quot;12&quot;&gt;     &lt;span class=&quot;kw&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;not&lt;/span&gt; word.text.startswith(&lt;span class=&quot;st&quot;&gt;&amp;quot;@&amp;quot;&lt;/span&gt;) &lt;span class=&quot;co&quot;&gt;# named entities&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-13&quot; title=&quot;13&quot;&gt;     &lt;span class=&quot;kw&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;not&lt;/span&gt; word.text.startswith(&lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;#39;&amp;quot;&lt;/span&gt;) &lt;span class=&quot;co&quot;&gt;# contractions&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-14&quot; title=&quot;14&quot;&gt;     &lt;span class=&quot;kw&quot;&gt;and&lt;/span&gt; word.text.lower() &lt;span class=&quot;kw&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; wordlist])&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-15&quot; title=&quot;15&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-16&quot; title=&quot;16&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Percentage of words misspelled&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-17&quot; title=&quot;17&quot;&gt;essays[&lt;span class=&quot;st&quot;&gt;&amp;quot;misspellings&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;/=&lt;/span&gt; essays[&lt;span class=&quot;st&quot;&gt;&amp;quot;tokens&amp;quot;&lt;/span&gt;]&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The results, in &lt;span class=&quot;citation&quot; data-cites=&quot;fig:missp&quot;&gt;@fig:missp&lt;/span&gt;, are curiously complementary to those in &lt;span class=&quot;citation&quot; data-cites=&quot;fig:length&quot;&gt;@fig:length&lt;/span&gt;: the rate of misspellings is practically the same across score classes (&lt;span class=&quot;math inline&quot;&gt;&lt;em&gt;R&lt;/em&gt;&lt;sup&gt;2&lt;/sup&gt;&#8196;=&#8196;0.002&lt;/span&gt;), but those at the extremes, with 10% or more of their words misspelled, are overwhelmingly likely to be low scorers.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;essay-score-misspell.svg&quot; alt=&quot;Percent of words misspelled by score. Box shows IQR. Whiskers show full range of data.&quot; id=&quot;fig:missp&quot; /&gt;&lt;figcaption&gt;Percent of words misspelled by score. Box shows IQR. Whiskers show full range of data.&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;The question of assessing prompt-relevance is trickier. One way of tackling it is to calculate the document vector of the story to which the students are responding, and calculate its &lt;a href=&quot;https://en.wikipedia.org/wiki/Cosine_similarity&quot;&gt;cosine similarity&lt;/a&gt; with the document vector of each essay. We can see the results in &lt;span class=&quot;citation&quot; data-cites=&quot;fig:prompt&quot;&gt;@fig:prompt&lt;/span&gt;.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;essay-score-prompt.svg&quot; alt=&quot;Vector similarity to prompt, calculated as the cosine similarity of the mean of the word vectors in each text. Box shows IQR. Whiskers show full range of data.&quot; id=&quot;fig:prompt&quot; /&gt;&lt;figcaption&gt;Vector similarity to prompt, calculated as the cosine similarity of the mean of the word vectors in each text. Box shows IQR. Whiskers show full range of data.&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;The results aren&#8217;t bad (&lt;span class=&quot;math inline&quot;&gt;&lt;em&gt;R&lt;/em&gt;&lt;sup&gt;2&lt;/sup&gt;&#8196;=&#8196;0.28&lt;/span&gt;), especially considering the outliers for score 3 are the same bizarrely short essays we saw above, including our Delphic &#8220;reserved need to check keenly&#8221;.&lt;/p&gt;
&lt;p&gt;At this point, we must ask what the value of this metadata is. The ETS &lt;a href=&quot;https://www.ets.org/research/topics/as_nlp/writing_quality/&quot;&gt;claims&lt;/a&gt; that its e-rater accounts for prompt-relevance, as well as:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;errors in grammar (e.g., subject&#8211;verb agreement)&lt;/li&gt;
&lt;li&gt;usage (e.g., preposition selection)&lt;/li&gt;
&lt;li&gt;mechanics (e.g., capitalization)&lt;/li&gt;
&lt;li&gt;style (e.g., repetitious word use)&lt;/li&gt;
&lt;li&gt;discourse structure (e.g., presence of a thesis statement, main points)&lt;/li&gt;
&lt;li&gt;vocabulary usage (e.g., relative sophistication of vocabulary)&lt;/li&gt;
&lt;li&gt;sentence variety&lt;/li&gt;
&lt;li&gt;source use&lt;/li&gt;
&lt;li&gt;discourse coherence quality&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;While it would take a sophisticated natural language parser to incorporate these details into our model, we may be able to approximate these things using metadata as proxies. Type&#8211;token ratio, for instance, could stand in for &#8220;repetitious word use&#8221;, and vector similarity to the prompt for relevance. As an alternative to parsing for narrative structure, I included a count of &#8220;linking words&#8221; that would likely signal a transition between paragraphs,&lt;a href=&quot;#fn7&quot; class=&quot;footnote-ref&quot; id=&quot;fnref7&quot;&gt;&lt;sup&gt;7&lt;/sup&gt;&lt;/a&gt; but this bore little relationship to the human scorers&#8217; judgments (&lt;span class=&quot;math inline&quot;&gt;&lt;em&gt;R&lt;/em&gt;&lt;sup&gt;2&lt;/sup&gt;&#8196;=&#8196;0.0004&lt;/span&gt;). Finally, as a proxy for sentence complexity, I used spaCy to parse the syntactic trees of each sentence, and took the longest branch, thus rewarding complex sentences with prepositional phrases and dependent clauses.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Depth of longest branch in dependency tree&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-2&quot; title=&quot;2&quot;&gt;essays[&lt;span class=&quot;st&quot;&gt;&amp;quot;max_depth&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;bu&quot;&gt;max&lt;/span&gt;([&lt;span class=&quot;bu&quot;&gt;len&lt;/span&gt;(&lt;span class=&quot;bu&quot;&gt;list&lt;/span&gt;(token.children))&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-3&quot; title=&quot;3&quot;&gt;                       &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; token &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; nlp(essay)])&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-4&quot; title=&quot;4&quot;&gt;                       &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; essay &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; essays[&lt;span class=&quot;st&quot;&gt;&amp;quot;essay&amp;quot;&lt;/span&gt;]]&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This fared somewhat better as a metric: &lt;span class=&quot;math inline&quot;&gt;&lt;em&gt;R&lt;/em&gt;&lt;sup&gt;2&lt;/sup&gt;&#8196;=&#8196;0.13&lt;/span&gt;. Finally, I tried to measure &#8220;relative sophistication of vocabulary&#8221; by quantifying the uncommonness of the words used. I did this by building a word frequency list from the 14-million-word &lt;a href=&quot;http://www.anc.org/&quot;&gt;American National Corpus&lt;/a&gt;, the details of which are in &lt;a href=&quot;#appendix-b-anc-wordlist&quot;&gt;Appendix B&lt;/a&gt;. This correlated well with score (&lt;span class=&quot;math inline&quot;&gt;&lt;em&gt;R&lt;/em&gt;&lt;sup&gt;2&lt;/sup&gt;&#8196;=&#8196;0.40&lt;/span&gt;), although it was no doubt standing in somewhat for length.&lt;/p&gt;
&lt;h1 id=&quot;modeling&quot;&gt;Modeling&lt;/h1&gt;
&lt;h2 id=&quot;sec:class&quot;&gt;Classical models&lt;a href=&quot;#fn8&quot; class=&quot;footnote-ref&quot; id=&quot;fnref8&quot;&gt;&lt;sup&gt;8&lt;/sup&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;As hinted at by the high &lt;span class=&quot;math inline&quot;&gt;&lt;em&gt;R&lt;/em&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/span&gt; scores above, we can get fair prediction scores by modeling on metadata alone. The first step, after splitting our essays into train and test sets, is to standardize the data by scaling to &lt;span class=&quot;math inline&quot;&gt;&lt;em&gt;z&lt;/em&gt;&lt;/span&gt;-score. I then ran principal component analysis (PCA) on the data, because many of the columns (e.g., type count and token count) encoded essentially the same information in parallel. The PCA transformation extracts those components which encode the greatest variance; together, the ten components extracted accounted for 98% of the variance within the metadata.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; sklearn.model_selection &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; train_test_split&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-2&quot; title=&quot;2&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; sklearn.preprocessing &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; StandardScaler&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-3&quot; title=&quot;3&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; sklearn.decomposition &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; PCA&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-4&quot; title=&quot;4&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-5&quot; title=&quot;5&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Split into train and test sets&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-6&quot; title=&quot;6&quot;&gt;X_train, X_test, y_train, y_test &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; train_test_split(X, y)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-7&quot; title=&quot;7&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-8&quot; title=&quot;8&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Standardize to z-score&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-9&quot; title=&quot;9&quot;&gt;ss &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; StandardScaler()&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-10&quot; title=&quot;10&quot;&gt;X_train_sc &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; ss.fit_transform(X_train))&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-11&quot; title=&quot;11&quot;&gt;X_test_sc &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; ss.transform(X_test))&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-12&quot; title=&quot;12&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-13&quot; title=&quot;13&quot;&gt;&lt;span class=&quot;co&quot;&gt;# PCA-transform&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-14&quot; title=&quot;14&quot;&gt;pca &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; PCA(n_components&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;10&lt;/span&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-15&quot; title=&quot;15&quot;&gt;Z_train &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; pca.fit_transform(X_train_sc)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-16&quot; title=&quot;16&quot;&gt;Z_test &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; pca.transform(X_test_sc)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The modeling itself is fairly straightforward. I modeled the data both with and without the PCA transform, and found the latter to have a slight edge, although all models achieved similar test scores (&lt;span class=&quot;citation&quot; data-cites=&quot;tbl:models&quot;&gt;@tbl:models&lt;/span&gt;).&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; sklearn.naive_bayes &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; GaussianNB&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-2&quot; title=&quot;2&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; sklearn.svm &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; SVC&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-3&quot; title=&quot;3&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; sklearn.ensemble &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; AdaBoostClassifier, ExtraTreesClassifier&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-4&quot; title=&quot;4&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; sklearn.metrics &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; cohen_kappa_score&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-5&quot; title=&quot;5&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-6&quot; title=&quot;6&quot;&gt;gnb &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; GaussianNB().fit(Z_train, y_train)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-7&quot; title=&quot;7&quot;&gt;svm &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; SVC(kernel&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;rbf&amp;quot;&lt;/span&gt;, C&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;).fit(Z_train, y_train)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-8&quot; title=&quot;8&quot;&gt;ext &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; ExtraTreesClassifier().fit(Z_train, y_train)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-9&quot; title=&quot;9&quot;&gt;ada &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; AdaBoostClassifier().fit(Z_train, y_train)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-10&quot; title=&quot;10&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-11&quot; title=&quot;11&quot;&gt;&lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; model &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; [gnb, svm, ext, ada]:&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-12&quot; title=&quot;12&quot;&gt;    &lt;span class=&quot;bu&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;Test score:&amp;quot;&lt;/span&gt;, model.score(X_test_sc, y_test))&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-13&quot; title=&quot;13&quot;&gt;    &lt;span class=&quot;bu&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;Test kappa:&amp;quot;&lt;/span&gt;, cohen_kappa_score(model.predict(X_test_sc), y_test),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-14&quot; title=&quot;14&quot;&gt;                                           weighting&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;quadratic&amp;quot;&lt;/span&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I also included the weighted Cohen&#8217;s kappa, which was the metric used for the original competition, although Cohen&#8217;s kappa is typically used to compare model results to each other, not to a gold standard.&lt;/p&gt;
&lt;!--
| Train acc.   | PCA train acc.
| ------------ | ------------
| 60.7%        | 58.8%
| 67.7%        | 67.4%
| 99.9%        | 99.9%
| 60.6%        | 51.2%
--&gt;
&lt;table&gt;
&lt;caption&gt;Results of some classical models vs.&#160;35% baseline accuracy {#tbl:models}&lt;/caption&gt;
&lt;thead&gt;
&lt;tr class=&quot;header&quot;&gt;
&lt;th&gt;Model&lt;/th&gt;
&lt;th&gt;Test acc.&lt;/th&gt;
&lt;th&gt;PCA test acc.&lt;/th&gt;
&lt;th&gt;Test &lt;span class=&quot;math inline&quot;&gt;&lt;em&gt;&#954;&lt;/em&gt;&lt;/span&gt;&lt;/th&gt;
&lt;th&gt;PCA Test &lt;span class=&quot;math inline&quot;&gt;&lt;em&gt;&#954;&lt;/em&gt;&lt;/span&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;Na&#239;ve Bayes&lt;/td&gt;
&lt;td&gt;59.8%&lt;/td&gt;
&lt;td&gt;59.3%&lt;/td&gt;
&lt;td&gt;0.710&lt;/td&gt;
&lt;td&gt;0.613&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;Support vector machine&lt;/td&gt;
&lt;td&gt;65.1%&lt;/td&gt;
&lt;td&gt;63.6%&lt;/td&gt;
&lt;td&gt;0.690&lt;/td&gt;
&lt;td&gt;0.674&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;ExtraTrees&lt;/td&gt;
&lt;td&gt;63.7%&lt;/td&gt;
&lt;td&gt;62.4%&lt;/td&gt;
&lt;td&gt;0.695&lt;/td&gt;
&lt;td&gt;0.679&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;AdaBoost&lt;/td&gt;
&lt;td&gt;60.0%&lt;/td&gt;
&lt;td&gt;56.8%&lt;/td&gt;
&lt;td&gt;0.664&lt;/td&gt;
&lt;td&gt;0.670&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;The support vector machine and ExtraTrees models performed slightly better than their rivals, and in fact made similar predictions to each other (&lt;span class=&quot;math inline&quot;&gt;&lt;em&gt;&#954;&lt;/em&gt;&#8196;=&#8196;0.81&lt;/span&gt;). We should also take into account that on essay sets 3 and 4, human graders agreed only about 75% of the time, with a weighted Cohen&#8217;s kappa of 0.77 and 0.85, respectively &lt;span class=&quot;citation&quot; data-cites=&quot;shermis2013contrasting&quot;&gt;[@shermis2013contrasting, p. 316]&lt;/span&gt;.&lt;/p&gt;
&lt;h2 id=&quot;recurrent-neural-network&quot;&gt;Recurrent Neural Network&lt;a href=&quot;#fn9&quot; class=&quot;footnote-ref&quot; id=&quot;fnref9&quot;&gt;&lt;sup&gt;9&lt;/sup&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;One of the state of the art tools in text processing is the recurrent neural network, into which ordered data is fed in series, and the model is retrained on prior data, in order to learn things about the sequence. The first step to doing this with word data is to convert the words to numerical indices (so &#8220;a&#8221; becomes 1, &#8220;aardvark&#8221; becomes 2, &#8220;Aaron&#8221; becomes 3, etc.), then padding them to be of equal length.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; tensorflow.keras.preprocessing.sequence &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; pad_sequences&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-2&quot; title=&quot;2&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-3&quot; title=&quot;3&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Define vocabulary&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-4&quot; title=&quot;4&quot;&gt;vocab &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;set&lt;/span&gt;(token.text &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; essay &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; essays[&lt;span class=&quot;st&quot;&gt;&amp;quot;essay&amp;quot;&lt;/span&gt;] &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; token &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; nlp.tokenizer(essay))&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-5&quot; title=&quot;5&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-6&quot; title=&quot;6&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Convert words to numerical indices &amp;lt;https://www.tensorflow.org/tutorials/text/text_generation&amp;gt;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-7&quot; title=&quot;7&quot;&gt;word2idx &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; {u: i &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; i, u &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;enumerate&lt;/span&gt;(vocab)}&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-8&quot; title=&quot;8&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-9&quot; title=&quot;9&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Convert essays to vectors of indices&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-10&quot; title=&quot;10&quot;&gt;X_vector &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [[word2idx[token.text]&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-11&quot; title=&quot;11&quot;&gt;            &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; token &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; nlp.tokenizer(essay)]&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-12&quot; title=&quot;12&quot;&gt;            &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; essay &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; essays[&lt;span class=&quot;st&quot;&gt;&amp;quot;essay&amp;quot;&lt;/span&gt;]]&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-13&quot; title=&quot;13&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-14&quot; title=&quot;14&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Create padded sequences&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-15&quot; title=&quot;15&quot;&gt;X_vector &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; pad_sequences(X_vector)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-16&quot; title=&quot;16&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-17&quot; title=&quot;17&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Split into train and test sets&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-18&quot; title=&quot;18&quot;&gt;X_vector_train, X_vector_test &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; train_test_split(X_vector)&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This then goes into an embedding layer, which condenses it into a dense vector.&lt;/p&gt;
&lt;p&gt;With neural networks, it is possible to include both the vectorized document and the metadata, by processing the former in a &lt;a href=&quot;https://en.wikipedia.org/wiki/Gated_recurrent_unit&quot;&gt;GRU&lt;/a&gt; or &lt;a href=&quot;https://en.wikipedia.org/wiki/Long_short-term_memory&quot;&gt;LSTM&lt;/a&gt; layer, concatenating the latter to its output neurons, and processing both in a regular perceptron structure &lt;span class=&quot;citation&quot; data-cites=&quot;xing2017incorporating&quot;&gt;[See, e.g., @xing2017incorporating]&lt;/span&gt;. Following the example in &lt;a href=&quot;https://www.digital-thinking.de/deep-learning-combining-numerical-and-text-features-in-deep-neural-networks/&quot;&gt;this blog post&lt;/a&gt;, I implemented the code below:&lt;a href=&quot;#fn10&quot; class=&quot;footnote-ref&quot; id=&quot;fnref10&quot;&gt;&lt;sup&gt;10&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
&lt;!-- ![Simplified RNN schema](rnn.svg){#fig:rnn} --&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb7&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; tensorflow.keras.layers &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; Dense, GRU, Embedding, Input, Bidirectional, Concatenate&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-2&quot; title=&quot;2&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; tensorflow.keras.models &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; Model&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-3&quot; title=&quot;3&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-4&quot; title=&quot;4&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Define inputs&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-5&quot; title=&quot;5&quot;&gt;vector_input &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; Input(shape&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;(X_vector.shape[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;],)) &lt;span class=&quot;co&quot;&gt;# Text vectors, in series of length 1,000&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-6&quot; title=&quot;6&quot;&gt;meta_input &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; Input(shape&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;(X_meta.shape[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;],)) &lt;span class=&quot;co&quot;&gt;# Scaled metadata (types, tokens, etc.)&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-7&quot; title=&quot;7&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-8&quot; title=&quot;8&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Embedding layer turns lists of word indices into dense vectors&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-9&quot; title=&quot;9&quot;&gt;rnn &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; Embedding(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-10&quot; title=&quot;10&quot;&gt;        input_dim &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;len&lt;/span&gt;(vocab),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-11&quot; title=&quot;11&quot;&gt;        output_dim &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;128&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-12&quot; title=&quot;12&quot;&gt;        input_length &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; X_vector.shape[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;],&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-13&quot; title=&quot;13&quot;&gt;    )(vector_input)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-14&quot; title=&quot;14&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-15&quot; title=&quot;15&quot;&gt;&lt;span class=&quot;co&quot;&gt;# GRU layers for RNN&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-16&quot; title=&quot;16&quot;&gt;rnn &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; Bidirectional(GRU(&lt;span class=&quot;dv&quot;&gt;128&lt;/span&gt;, return_sequences&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;True&lt;/span&gt;, kernel_regularizer&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;l2(&lt;span class=&quot;fl&quot;&gt;0.01&lt;/span&gt;)))(rnn)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-17&quot; title=&quot;17&quot;&gt;rnn &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; Bidirectional(GRU(&lt;span class=&quot;dv&quot;&gt;128&lt;/span&gt;, return_sequences&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;False&lt;/span&gt;, kernel_regularizer&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;l2(&lt;span class=&quot;fl&quot;&gt;0.01&lt;/span&gt;)))(rnn)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-18&quot; title=&quot;18&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-19&quot; title=&quot;19&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Incorporate metadata&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-20&quot; title=&quot;20&quot;&gt;rnn &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; Concatenate()([rnn, meta_input])&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-21&quot; title=&quot;21&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-22&quot; title=&quot;22&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Define hidden and output layers&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-23&quot; title=&quot;23&quot;&gt;rnn &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; Dense(&lt;span class=&quot;dv&quot;&gt;128&lt;/span&gt;, activation&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;relu&amp;quot;&lt;/span&gt;, kernel_regularizer&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;l2(&lt;span class=&quot;fl&quot;&gt;0.01&lt;/span&gt;))(rnn)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-24&quot; title=&quot;24&quot;&gt;rnn &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; Dense(&lt;span class=&quot;dv&quot;&gt;128&lt;/span&gt;, activation&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;relu&amp;quot;&lt;/span&gt;, kernel_regularizer&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;l2(&lt;span class=&quot;fl&quot;&gt;0.01&lt;/span&gt;))(rnn)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-25&quot; title=&quot;25&quot;&gt;rnn &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; Dense(&lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;, activation&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;softmax&amp;quot;&lt;/span&gt;)(rnn)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-26&quot; title=&quot;26&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-27&quot; title=&quot;27&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Define model&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-28&quot; title=&quot;28&quot;&gt;model &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; Model(inputs&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;[vector_input, meta_input], outputs&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;[rnn])&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-29&quot; title=&quot;29&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-30&quot; title=&quot;30&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Fit model&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-31&quot; title=&quot;31&quot;&gt;model.fit([X_vector_train, X_meta_train_sc], y_train,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-32&quot; title=&quot;32&quot;&gt;          validation_data&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;([X_vector_test, X_meta_test_sc], y_test))&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The results are surprisingly close to the models in &lt;span class=&quot;citation&quot; data-cites=&quot;sec:class&quot;&gt;@sec:class&lt;/span&gt; above. Amending our previous table:&lt;/p&gt;
&lt;table&gt;
&lt;caption&gt;Comparison of all models vs.&#160;35% baseline accuracy {#tbl:rnn}&lt;/caption&gt;
&lt;thead&gt;
&lt;tr class=&quot;header&quot;&gt;
&lt;th&gt;Model&lt;/th&gt;
&lt;th&gt;Test acc.&lt;/th&gt;
&lt;th&gt;Test &lt;span class=&quot;math inline&quot;&gt;&lt;em&gt;&#954;&lt;/em&gt;&lt;/span&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;Na&#239;ve Bayes&lt;/td&gt;
&lt;td&gt;59.8%&lt;/td&gt;
&lt;td&gt;0.710&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;Support vector machine&lt;/td&gt;
&lt;td&gt;65.1%&lt;/td&gt;
&lt;td&gt;0.690&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;ExtraTrees&lt;/td&gt;
&lt;td&gt;63.7%&lt;/td&gt;
&lt;td&gt;0.695&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;AdaBoost&lt;/td&gt;
&lt;td&gt;60.0%&lt;/td&gt;
&lt;td&gt;0.664&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;RNN&lt;/td&gt;
&lt;td&gt;63.6%&lt;/td&gt;
&lt;td&gt;0.704&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;It seems that the metadata was more valuable in predicting test scores than the vectorized documents&#8212;or else, that the RNN couldn&#8217;t make better use of the two than a support vector machine could of the one. Nevertheless, I have shown that using a few key linguistic metrics, we can train a simple model to predict essay scores in fairly good agreement with human scorers.&lt;/p&gt;
&lt;h1 id=&quot;appendix-a-perelmans-2012-essay&quot; class=&quot;unnumbered&quot;&gt;Appendix A: Perelman&#8217;s (2012) essay&lt;/h1&gt;
&lt;!-- source: http://www.documentcloud.org/documents/346138-essay-awarded-a-top-grade-by-e-rater.html --&gt;
&lt;p&gt;Prompt:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Question: &#8220;The rising cost of a college education is the fault of students who demand that colleges offer students luxuries unheard of by earlier generations of college students&#8212;single dorm rooms, private bathrooms, gourmet meals, etc.&#8221;&lt;/p&gt;
&lt;p&gt;Discuss the extent to which you agree or disagree with this opinion. Support your views with specific reasons and examples from your own experience, observations, or reading.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Response:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In today&#8217;s society, college is ambiguous. We need it to live, but we also need it to love. Moreover, without college most of the world&#8217;s learning would be egregious. College, however, has myriad costs. One of the most important issues facing the world is how to reduce college costs. Some have argued that college costs are due to the luxuries students now expect. Others have argued that the costs are a result of athletics. In reality, high college costs are the result of excessive pay for teaching assistants.&lt;/p&gt;
&lt;p&gt;I live in a luxury dorm. In reality, it costs no more than rat infested rooms at a Motel Six. The best minds of my generation were destroyed by madness, starving hysterical naked, and publishing obscene odes on the windows of the skull. Luxury dorms pay for themselves because they generate thousand and thousands of dollars of revenue. In the Middle Ages, the University of Paris grew because it provided comfortable accommodations for each of its students, large rooms with servants and legs of mutton. Although they are expensive, these rooms are necessary to learning. The second reason for the five-paragraph theme is that it makes you focus on a single topic. Some people start writing on the usual topic, like TV commercials, and they wind up all over the place, talking about where TV came from or capitalism or health foods or whatever. But with only five paragraphs and one topic you&#8217;re not tempted to get beyond your original idea, like commercials are a good source of information about products. You give your three examples, and zap! you&#8217;re done. This is another way the five-paragraph theme keeps you from thinking too much.&lt;/p&gt;
&lt;p&gt;Teaching assistants are paid an excessive amount of money. The average teaching assistant makes six times as much money as college presidents. In addition, they often receive a plethora of extra benefits such as private jets, vacations in the south seas, a staring roles in motion pictures. Moreover, in the Dickens novel Great Expectation, Pip makes his fortune by being a teaching assistant. It doesn&#8217;t matter what the subject is, since there are three parts to everything you can think of. If you can&#8217;t think of more than two, you just have to think harder or come up with something that might fit. An example will often work, like the three causes of the Civil War or abortion or reasons why the ridiculous twenty-one-year-old limit for drinking alcohol should be abolished. A worse problem is when you wind up with more than three subtopics, since sometimes you want to talk about all of them.&lt;/p&gt;
&lt;p&gt;There are three main reasons while Teaching Assistants receive such high remuneration. First, they have the most powerful union in the United States. Their union is greater than the Teamsters or Freemasons, although it is slightly smaller than the international secret society of the Jedi Knights. Second, most teaching assistants have political connections, from being children of judges and governors to being the brothers and sisters of kings and princes. In Heart of Darkness, Mr.&#160;Kurtz is a teaching assistant because of his connections, and he ruins all the universities that employ him. Finally, teaching assistants are able to exercise mind control over the rest of the university community. The last reason to write this way is the most important. Once you have it down, you can use it for practically anything. Does God exist? Well, you can say yes and give three reasons, or no and give three different reasons. It doesn&#8217;t really matter. You&#8217;re sure to get a good grade whatever you pick to put into the formula. And that&#8217;s the real reason for education, to get those good grades without thinking too much and using up too much time.&lt;/p&gt;
&lt;p&gt;In conclusion, as Oscar Wilde said, &#8220;I can resist everything except temptation.&#8221; Luxury dorms are not the problem. The problem is greedy teaching assistants. It gives me an organizational scheme that looks like an essay, it limits my focus to one topic and three subtopics so I don&#8217;t wander about thinking irrelevant thoughts, and it will be useful for whatever writing I do in any subject.1 I don&#8217;t know why some teachers seem to dislike it so much. They must have a different idea about education than I do. By Les Perelman&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;appendix-b-anc-wordlist&quot; class=&quot;unnumbered&quot;&gt;Appendix B: ANC wordlist&lt;/h1&gt;
&lt;p&gt;The following code generates the &lt;a href=&quot;https://github.com/alexklapheke/essay/blob/master/data/anc_frequency_list.csv&quot;&gt;wordlist&lt;/a&gt; I used (see &lt;span class=&quot;citation&quot; data-cites=&quot;sec:dataexp&quot;&gt;@sec:dataexp&lt;/span&gt;). It took about 15 minutes to run. The ANC data is available from &lt;a href=&quot;https://www.anc.org&quot;&gt;anc.org&lt;/a&gt;, and is, per that website, &#8220;fully open and unrestricted for any use&#8221;. The resulting wordlist obeys &lt;a href=&quot;https://en.wikipedia.org/wiki/Zipf%27s_law&quot;&gt;Zipf&#8217;s law&lt;/a&gt;, as shown in &lt;span class=&quot;citation&quot; data-cites=&quot;fig:zipf&quot;&gt;@fig:zipf&lt;/span&gt;, and is part-of-speech tagged, so homographs of different frequencies (e.g., saw&lt;sub&gt;V&lt;/sub&gt; vs.&#160;saw&lt;sub&gt;N&lt;/sub&gt;) can be distinguished.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;anc_zipf.svg&quot; alt=&quot;Demonstration of Zipf&#8217;s Law on ANC&quot; id=&quot;fig:zipf&quot; /&gt;&lt;figcaption&gt;Demonstration of Zipf&#8217;s Law on ANC&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;The actual frequency measure used was the sum of word token ranks. While this gave higher results for longer sentences, and was therefore intercorrelated with token length, a very uncommon word could give the score an order-of-magnitude boost.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb8&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;co&quot;&gt;#!/usr/bin/env python3&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-2&quot; title=&quot;2&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-3&quot; title=&quot;3&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Libraries&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-4&quot; title=&quot;4&quot;&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; glob&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-5&quot; title=&quot;5&quot;&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; spacy&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-6&quot; title=&quot;6&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; unidecode &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; unidecode&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-7&quot; title=&quot;7&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-8&quot; title=&quot;8&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Options&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-9&quot; title=&quot;9&quot;&gt;anc_path &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;/home/alex/Data/ANC/&amp;quot;&lt;/span&gt;  &lt;span class=&quot;co&quot;&gt;# freely downloadable from anc.org&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-10&quot; title=&quot;10&quot;&gt;dict_path &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;/usr/share/dict/words&amp;quot;&lt;/span&gt;  &lt;span class=&quot;co&quot;&gt;# wamerican-insane v2017.08.24-1&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-11&quot; title=&quot;11&quot;&gt;freq_per &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt; 100_000&lt;/span&gt;  &lt;span class=&quot;co&quot;&gt;# scaling factor (i.e., compute freq. per this many words)&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-12&quot; title=&quot;12&quot;&gt;include_hapaxes &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;True&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-13&quot; title=&quot;13&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-14&quot; title=&quot;14&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Initialize spaCy&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-15&quot; title=&quot;15&quot;&gt;nlp &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; spacy.load(&lt;span class=&quot;st&quot;&gt;&amp;quot;en&amp;quot;&lt;/span&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-16&quot; title=&quot;16&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-17&quot; title=&quot;17&quot;&gt;freqs &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; {}&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-18&quot; title=&quot;18&quot;&gt;total_tokens &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-19&quot; title=&quot;19&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-20&quot; title=&quot;20&quot;&gt;&lt;span class=&quot;cf&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;open&lt;/span&gt;(dict_path, &lt;span class=&quot;st&quot;&gt;&amp;quot;r&amp;quot;&lt;/span&gt;) &lt;span class=&quot;im&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;file&lt;/span&gt;:&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-21&quot; title=&quot;21&quot;&gt;    dictionary &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;set&lt;/span&gt;(&lt;span class=&quot;bu&quot;&gt;file&lt;/span&gt;.read().split(&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;))&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-22&quot; title=&quot;22&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-23&quot; title=&quot;23&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Get all text files recursively &amp;lt;https://stackoverflow.com/a/45172387&amp;gt;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-24&quot; title=&quot;24&quot;&gt;&lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; filename &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; glob.iglob(anc_path &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;**/*.txt&amp;quot;&lt;/span&gt;, recursive&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;True&lt;/span&gt;):&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-25&quot; title=&quot;25&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-26&quot; title=&quot;26&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# Open each file in the corpus&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-27&quot; title=&quot;27&quot;&gt;    &lt;span class=&quot;cf&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;open&lt;/span&gt;(filename, &lt;span class=&quot;st&quot;&gt;&amp;quot;r&amp;quot;&lt;/span&gt;) &lt;span class=&quot;im&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;file&lt;/span&gt;:&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-28&quot; title=&quot;28&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-29&quot; title=&quot;29&quot;&gt;        &lt;span class=&quot;co&quot;&gt;# Remove diacritics, parse, &amp;amp; tokenize&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-30&quot; title=&quot;30&quot;&gt;        &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; token &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; nlp(unidecode(&lt;span class=&quot;bu&quot;&gt;file&lt;/span&gt;.read())):&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-31&quot; title=&quot;31&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-32&quot; title=&quot;32&quot;&gt;            &lt;span class=&quot;co&quot;&gt;# Eliminate non-words&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-33&quot; title=&quot;33&quot;&gt;            &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;not&lt;/span&gt; token.is_punct &lt;span class=&quot;kw&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;not&lt;/span&gt; token.is_space:&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-34&quot; title=&quot;34&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-35&quot; title=&quot;35&quot;&gt;                &lt;span class=&quot;co&quot;&gt;# Lemmatize and remove diacritics/ligatures&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-36&quot; title=&quot;36&quot;&gt;                lemma &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; token.lemma_.lower().strip(&lt;span class=&quot;st&quot;&gt;&amp;quot;-&amp;quot;&lt;/span&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-37&quot; title=&quot;37&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-38&quot; title=&quot;38&quot;&gt;                &lt;span class=&quot;co&quot;&gt;# Only use dictionary words&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-39&quot; title=&quot;39&quot;&gt;                &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; lemma &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; dictionary:&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-40&quot; title=&quot;40&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-41&quot; title=&quot;41&quot;&gt;                    &lt;span class=&quot;co&quot;&gt;# Add lemma/part-of-speech tag&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-42&quot; title=&quot;42&quot;&gt;                    type_pos &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;,&amp;quot;&lt;/span&gt;.join([lemma, token.pos_])&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-43&quot; title=&quot;43&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-44&quot; title=&quot;44&quot;&gt;                    &lt;span class=&quot;co&quot;&gt;# Update our dictionary&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-45&quot; title=&quot;45&quot;&gt;                    freqs[type_pos] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; freqs.setdefault(type_pos, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-46&quot; title=&quot;46&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-47&quot; title=&quot;47&quot;&gt;                    &lt;span class=&quot;co&quot;&gt;# Update our running total&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-48&quot; title=&quot;48&quot;&gt;                    total_tokens &lt;span class=&quot;op&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-49&quot; title=&quot;49&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-50&quot; title=&quot;50&quot;&gt;&lt;span class=&quot;bu&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;{:,} tokens,&amp;quot;&lt;/span&gt;.&lt;span class=&quot;bu&quot;&gt;format&lt;/span&gt;(total_tokens),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-51&quot; title=&quot;51&quot;&gt;      &lt;span class=&quot;st&quot;&gt;&amp;quot;{:,} types&amp;quot;&lt;/span&gt;.&lt;span class=&quot;bu&quot;&gt;format&lt;/span&gt;(&lt;span class=&quot;bu&quot;&gt;len&lt;/span&gt;(freqs.keys())))&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-52&quot; title=&quot;52&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-53&quot; title=&quot;53&quot;&gt;&lt;span class=&quot;co&quot;&gt;# &amp;lt;https://stackoverflow.com/a/9001529&amp;gt;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-54&quot; title=&quot;54&quot;&gt;freqs_sorted &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;dict&lt;/span&gt;(&lt;span class=&quot;bu&quot;&gt;sorted&lt;/span&gt;(freqs.items()))&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-55&quot; title=&quot;55&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-56&quot; title=&quot;56&quot;&gt;&lt;span class=&quot;cf&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;open&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;anc_frequency_list.csv&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;w&amp;quot;&lt;/span&gt;) &lt;span class=&quot;im&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;file&lt;/span&gt;:&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-57&quot; title=&quot;57&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-58&quot; title=&quot;58&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# CSV header&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-59&quot; title=&quot;59&quot;&gt;    &lt;span class=&quot;bu&quot;&gt;file&lt;/span&gt;.write(&lt;span class=&quot;ss&quot;&gt;f&amp;quot;lemma,pos,count,freq_per_&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;{&lt;/span&gt;freq_per&lt;span class=&quot;sc&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;&amp;quot;&lt;/span&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-60&quot; title=&quot;60&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-61&quot; title=&quot;61&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# CSV rows&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-62&quot; title=&quot;62&quot;&gt;    &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; word, freq &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; freqs_sorted.items():&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-63&quot; title=&quot;63&quot;&gt;        &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; include_hapaxes &lt;span class=&quot;kw&quot;&gt;or&lt;/span&gt; freq &lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;:&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-64&quot; title=&quot;64&quot;&gt;            &lt;span class=&quot;bu&quot;&gt;file&lt;/span&gt;.write(&lt;span class=&quot;ss&quot;&gt;f&amp;quot;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;{&lt;/span&gt;word&lt;span class=&quot;sc&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;{&lt;/span&gt;freq&lt;span class=&quot;sc&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;{&lt;/span&gt;freq_per&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;freq&lt;span class=&quot;op&quot;&gt;/&lt;/span&gt;total_tokens&lt;span class=&quot;sc&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;&amp;quot;&lt;/span&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot;&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/alexklapheke/essay/blob/master/code/0-Parse_data-EDA.ipynb&quot;&gt;Relevant notebook&lt;/a&gt;&lt;a href=&quot;#fnref1&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot;&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/alexklapheke/essay/blob/master/code/2-Hypothesis-tests.ipynb&quot;&gt;Relevant notebook&lt;/a&gt;&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn3&quot;&gt;&lt;p&gt;Essay no. 6332, set 3&lt;a href=&quot;#fnref3&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn4&quot;&gt;&lt;p&gt;Essay no. 10057, set 4&lt;a href=&quot;#fnref4&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn5&quot;&gt;&lt;p&gt;Essay no. 9870, set 4&lt;a href=&quot;#fnref5&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn6&quot;&gt;&lt;p&gt;I used &lt;a href=&quot;https://packages.ubuntu.com/bionic/wamerican-insane&quot;&gt;wamerican-insane v2017.08.24-1&lt;/a&gt;, which contains 654,749 entries.&lt;a href=&quot;#fnref6&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn7&quot;&gt;&lt;p&gt;Phrases culled from Wiktionary (&lt;a href=&quot;https://en.wiktionary.org/wiki/Category:English_conjunctive_adverbs&quot;&gt;1&lt;/a&gt;, &lt;a href=&quot;https://en.wiktionary.org/wiki/Category:English_sequence_adverbs&quot;&gt;2&lt;/a&gt;). The full list:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;accordingly, additionally, alphabetically, alphanumerically, also, alternatively, antepenultimately, anyway, at any rate, before, besides, by the way, chronologically, consequently, conversely, eighthly, either, eleventhly, equally, fifthly, fiftiethly, finally, first, first of all, first off, first up, firstly, for another thing, for example, for instance, for one thing, fortiethly, fourthly, further, furthermore, hence, however, hundredthly, in addition, in other words, in the first place, incidentally, indeed, lastly, likewise, moreover, neither, nevertheless, next, nextly, ninthly, nonetheless, on the contrary, on the gripping hand, on the one hand, on the other hand, otherwise, parenthetically, penultimately, rather, secondly, serially, seventhly, similarly, sixthly, sixtiethly, still, tenthly, that is, that is to say, then again, therefore, thirdly, thirteenthly, thirtiethly, though, thus, to that end, too, twelfthly, twentiethly, wherefore&lt;/p&gt;
&lt;/blockquote&gt;
&lt;a href=&quot;#fnref7&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn8&quot;&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/alexklapheke/essay/blob/master/code/3-Model_data.ipynb&quot;&gt;Relevant notebook&lt;/a&gt;&lt;a href=&quot;#fnref8&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn9&quot;&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/alexklapheke/essay/blob/master/code/4-Neural_net.ipynb&quot;&gt;Relevant notebook&lt;/a&gt;&lt;a href=&quot;#fnref9&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn10&quot;&gt;&lt;p&gt;The schema is, roughly:&lt;img src=&quot;rnn.svg&quot; /&gt;&lt;a href=&quot;#fnref10&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
	</description>
		</item>
		<item>
			<title>How I use org-mode to organize my recipes</title>
			<link>https://alexklapheke.github.io/blog/publish/recipes.md</link>
			<pubDate>Sun, 05 Jul 2020 14:28:24 -0400</pubDate>
	<description>
&lt;div class=&quot;epigraph&quot;&gt;
&lt;p&gt;Here the Red Queen began again. &#8220;Can you answer useful questions?&#8221; she said. &#8220;How is bread made?&#8221;&lt;/p&gt;
&lt;p&gt;&#8220;I know &lt;em&gt;that&lt;/em&gt;!&#8221; Alice cried eagerly. &#8220;You take some flour&#8212;&#8221;&lt;/p&gt;
&lt;p&gt;&#8220;Where do you pick the flower?&#8221; the White Queen asked. &#8220;In a garden, or in the hedges?&#8221;&lt;/p&gt;
&lt;p&gt;&#8220;Well, it isn&#8217;t &lt;em&gt;picked&lt;/em&gt; at all,&#8221; Alice explained: &#8220;it&#8217;s &lt;em&gt;ground&lt;/em&gt;&#8212;&#8221;&lt;/p&gt;
&lt;p&gt;&#8220;How many acres of ground?&#8221; said the White Queen. &#8220;You mustn&#8217;t leave out so many things.&#8221;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Cooking is a major hobby of mine, and for a long time, I kept recipes either in text files or printed PDFs in a poorly organized folder on my hard drive. It was hard to find specific recipes (did I file &lt;a href=&quot;https://www.tastemade.com/shows/thirsty-for/mexican-horchata&quot;&gt;horchata&lt;/a&gt; under &#8220;Drinks&#8221; or &#8220;Mexican&#8221;?), hard to remember whether I had made a recipe before (and whether it was any good), and pretty much impossible to search for complicated things like &#8220;recipes without seafood&#8221; or &#8220;recipes that take less than an hour&#8221;. To make things worse, the whole folder was cluttered with useless infographics and spreadsheets.&lt;/p&gt;
&lt;p&gt;I recently discovered &lt;a href=&quot;https://orgmode.org/&quot;&gt;org-mode&lt;/a&gt;, an organization system for the &lt;a href=&quot;https://www.gnu.org/software/emacs/&quot;&gt;Emacs&lt;/a&gt; text editor, and while there is a bit of a learning curve, it is the best organization tool I&#8217;ve ever used. I took a few days last winter to wrangle my recipe collection into something manageable. I had the following criteria for my setup:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Recipes can easily be copied from websites without adding a lot of formatting/structure.&lt;/li&gt;
&lt;li&gt;Recipes can be searched or filtered based on common metadata, such as yield or cooking time.&lt;/li&gt;
&lt;li&gt;There is a space to add &#8220;cooking notes&#8221;, so the next time I make the recipe I&#8217;ll remember what happened the first time (say, substitutions I made or steps that were unclear).&lt;/li&gt;
&lt;li&gt;It is obvious where any particular recipe should be placed.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;After playing with some possible schemes, I settled on the one below.&lt;/p&gt;
&lt;h1 id=&quot;file-structure&quot;&gt;File structure&lt;/h1&gt;
&lt;p&gt;All my recipes are in the single file &lt;code&gt;Cooking.org&lt;/code&gt;, the basic structure of which is below.&lt;/p&gt;
&lt;pre class=&quot;org-mode&quot;&gt;&lt;code&gt;#+TITLE: Recipes
#+STARTUP: indent align overview
#+TODO: NEVERMADE(n) | HAVEMADE(h@)
#+TAGS: { weekday weekend } { vegetarian seafood } glutenfree breakfast instantpot slowcooker
#+TAGS: { { asian : chinese(c) japanese(j) korean(k) vietnamese(v) } lebanese(l) indian(i) }

* Meals:
** Meats:
** Vegetables, stir-fries, &amp;amp; curries:
** Rice/orzo &amp;amp; grains:
** Pasta &amp;amp; noodles:
** Soups, stews, &amp;amp; casseroles:
** Salads:
** Sandwiches:
** Breakfast eggs &amp;amp; grains:
* Condiments &amp;amp; snacks:
** Pickles &amp;amp; preserves:
** Sauces &amp;amp; toppings:
** Snacks &amp;amp; dips:
* Baked goods:
** Savory breads/rolls:
** Sweet breads/rolls:
** Batters:
** Cakes &amp;amp; tortes:
** Pies, tarts, &amp;amp; cobblers:
** Pastries, custards/curds, &amp;amp; ice cream:
** Cookies:
* Drinks:
** Hot drinks:
** Cold drinks:
* Projects:
** Brewing:
** Dairy:
** Bread &amp;amp; noodles:
** Candy:
* Notes:
** Price book:
** Unsorted recipes:
** Settings:&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The first few lines, starting with &lt;code&gt;#+&lt;/code&gt;, make up the file header. The &lt;code&gt;#+STARTUP&lt;/code&gt; line defines some &lt;a href=&quot;https://orgmode.org/manual/In_002dbuffer-settings.html#index-_0023_002bSTARTUP&quot;&gt;settings&lt;/a&gt; for when I open the file. The most important is &lt;code&gt;overview&lt;/code&gt;, which makes sure only the headings are shown, and not all ~30,000 lines of text. Unfortunately, this only shows top-level headings. I can use &lt;kbd&gt;M-2 S-Tab&lt;/kbd&gt;&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; to see the second-level headings as well, or &lt;kbd&gt;M-3 S-Tab&lt;/kbd&gt; to see all recipes, although at this point, I have far too many for the latter to be useful.&lt;/p&gt;
&lt;p&gt;I also define &lt;a href=&quot;https://orgmode.org/manual/Tags.html&quot;&gt;tags&lt;/a&gt; and &lt;a href=&quot;https://orgmode.org/manual/TODO-Items.html&quot;&gt;TODO states&lt;/a&gt;, the latter of which let you mark an item as being in any of various states of completion. The &lt;code&gt;@&lt;/code&gt; after the &lt;code&gt;HAVEMADE&lt;/code&gt; state means that when I mark a recipe as &lt;code&gt;HAVEMADE&lt;/code&gt;, org should prompt me to &lt;a href=&quot;https://orgmode.org/manual/Tracking-TODO-state-changes.html&quot;&gt;leave a note&lt;/a&gt;. Thus, after I make a recipe, I can jot down what went well and what I should change next time. The tags define ancillary properties of the recipe&#8212;whether it is gluten-free, what part of the world it comes from&#8212;and tags surrounded with curly braces are mutually exclusive, such as &lt;code&gt;{ vegetarian seafood }&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;In the body of the file, the recipes are organized into first- and second-level &lt;a href=&quot;https://orgmode.org/manual/Headlines.html&quot;&gt;headings&lt;/a&gt;, starting with &lt;code&gt;*&lt;/code&gt; and &lt;code&gt;**&lt;/code&gt;, respectively. The tacit rule is that recipes within a category should substitute for each other&#8212;thus, &lt;code&gt;Cakes &amp;amp; tortes&lt;/code&gt; is a valid category because &lt;a href=&quot;https://smittenkitchen.com/2015/12/tres-leches-cake-a-taco-party/&quot;&gt;tres leches cake&lt;/a&gt; could substitute for &lt;a href=&quot;https://www.americastestkitchen.com/recipes/9648-olive-oil-cake&quot;&gt;olive oil cake&lt;/a&gt;; but it couldn&#8217;t substitute for &lt;a href=&quot;https://www.budgetbytes.com/pickled-red-onions/&quot;&gt;pickled red onions&lt;/a&gt;, so it wouldn&#8217;t make sense to group them under a &lt;code&gt;Mexican&lt;/code&gt; heading.&lt;/p&gt;
&lt;!-- This removes nearly all ambiguity from the sorting/searching process and makes it extremely easy to search recipes. --&gt;
&lt;!-- For example, I can find meatless recipes for my vegetarian friends, or if I&apos;m making a [Japanese entr&#233;e](https://www.seriouseats.com/recipes/2018/01/japanese-curry-kare.html), I can easily find a [Japanese side dish](https://cooking.nytimes.com/recipes/1015648-simple-seaweed-salad) to complement it. --&gt;
&lt;p&gt;The final top-level heading is &lt;code&gt;Notes&lt;/code&gt;. The first thing here is a &lt;a href=&quot;https://en.wikipedia.org/wiki/Price_book&quot;&gt;price book&lt;/a&gt;&#8212;a simple table of ingredients I buy often, and at which nearby grocery stores they are cheapest, with the cheapest price in bold.&lt;a href=&quot;#fn2&quot; class=&quot;footnote-ref&quot; id=&quot;fnref2&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt; I also rounded up to the nearest dime to make mental math easier, and combat stores&#8217; &lt;a href=&quot;https://en.wikipedia.org/wiki/Psychological_pricing&quot;&gt;psychological tricks&lt;/a&gt;.&lt;/p&gt;
&lt;pre class=&quot;org-mode&quot;&gt;&lt;code&gt;** Price book:
- Rules of thumb:
  - Apple/peach/onion :: 1/2lb ($1/ @ $2/lb, $1.50/ @ $3/lb)
  - Banana :: 1/3lb (15&#162;/ @ 50&#162;/lb)
  - Head of garlic :: 1/8lb
  - Chicken drumstick :: 7oz
| Food               | Trader Joe&amp;#39;s | Whole Foods |
|--------------------+--------------+-------------|
| Milk (1/2gal)      | *$1.70*      | $2.20       |
| Eggs (dozen large) | *$2*         | $3          |
| Butter (4 sticks)  | *$3*         | $3.50       |
| Coffee (12oz)      | $4           | $4          |
| Garlic (head)      | 70&#162;          | *~50&#162;*      |
| Lemon              | 50&#162;          | 50&#162;         |&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The second subheading under &lt;code&gt;Notes&lt;/code&gt; is &lt;code&gt;Unsorted Recipes&lt;/code&gt;, where recipes are automatically placed when added (see &lt;a href=&quot;#adding-recipes&quot;&gt;below&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;Finally, a &lt;code&gt;Settings&lt;/code&gt; subheading contains the &lt;a href=&quot;https://www.gnu.org/software/emacs/manual/html_node/emacs/Specifying-File-Variables.html&quot;&gt;in-file settings&lt;/a&gt;&#8212;this must be the last thing in the file. The first line sets the &lt;a href=&quot;https://orgmode.org/manual/Refile-and-Copy.html&quot;&gt;refile&lt;/a&gt; targets to the second-level headings, so recipes can easily be moved between categories while keeping them at the third heading level. The second line sets &lt;a href=&quot;https://orgmode.org/manual/Setting-tags.html&quot;&gt;&lt;code&gt;org-tags-column&lt;/code&gt;&lt;/a&gt; to &lt;code&gt;-105&lt;/code&gt; from the default value of &lt;code&gt;-77&lt;/code&gt;. I have a lot of tags on recipes, and this reduces visual clutter by moving them farther to the right.&lt;/p&gt;
&lt;pre class=&quot;org-mode&quot;&gt;&lt;code&gt;** Settings:
# Local variables:
# org-refile-targets: ((&amp;quot;~/org/Cooking.org&amp;quot; :level . 2))
# org-tags-column: -105
# End:&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As a final bonus, this structure makes it easy to see how many recipes I have: hit &lt;kbd&gt;M-!&lt;/kbd&gt; to get a shell prompt, then run &lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span class=&quot;fu&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;#39;^\*\*\*&amp;#39;&lt;/span&gt; Cooking.org &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;wc&lt;/span&gt; -l&lt;/code&gt;.&lt;/p&gt;
&lt;h1 id=&quot;recipe-structure&quot;&gt;Recipe structure&lt;/h1&gt;
&lt;p&gt;The third level is for the recipes themselves. These basically consist of a &lt;a href=&quot;https://orgmode.org/manual/Property-syntax.html&quot;&gt;properties drawer&lt;/a&gt; for the metadata, a &lt;a href=&quot;https://orgmode.org/manual/Checkboxes.html&quot;&gt;checklist&lt;/a&gt; for the ingredients, and a &lt;a href=&quot;https://orgmode.org/manual/Plain-lists.html&quot;&gt;numbered list&lt;/a&gt; for the directions.&lt;/p&gt;
&lt;p&gt;For example, here is a recipe for marinated eggs: the properties drawer runs from &lt;code&gt;:PROPERTIES:&lt;/code&gt; to &lt;code&gt;:END:&lt;/code&gt;, followed by the ingredients prepended with &lt;code&gt;- [ ]&lt;/code&gt;, then the directions and an endnote.&lt;/p&gt;
&lt;pre class=&quot;org-mode&quot;&gt;&lt;code&gt;*** HAVEMADE Japanese Marinated Soft Boiled Egg for Ramen (Ajitsuke Tamago)          :weekend:japanese:
:PROPERTIES:
:Author: J. Kenji L&#243;pez-Alt
:Source:
:Sent_by:
:Yield: 6 eggs
:Prep_Time: 0:10
:Cook_Time: 4:00
:Total_Time: 4:10
:Cost:
:Description: Perfectly seasoned soft-boiled eggs for the best homemade ramen.
:URL: https://www.seriouseats.com/recipes/2012/03/ajitsuke-tamago-japanese-marinated-soft-boiled-egg-recipe.html
:Added: [2019-01-03 Thu]
:END:
- [ ] 1 cup water
- [ ] 1 cup sake
- [ ] 1/2 cup soy sauce
- [ ] 1/2 cup mirin
- [ ] 1/2 cup sugar
- [ ] 6 eggs


1. Combine water, sake, soy, mirin, and sugar in a medium bowl and
   whisk until sugar is dissolved. Set aside.

2. Bring 2 quarts of water to a boil in a medium saucepan over high
   heat. Pierce fat end of each egg with a thumbtack to make a tiny
   hole (this prevents them from cracking and eliminates the air
   bubble at the end). Carefully lower eggs into water with a wire
   mesh spider or slotted spoon. Reduce heat to maintain a bare
   simmer. Cook for exactly 6 minutes. Drain hot water and carefully
   peel eggs under cold running water (the whites will be quite
   delicate).

3. Transfer eggs to a bowl that just barely fits them all. Pour
   marinade on top until eggs are covered or just floating. Place a
   double-layer of paper towels on top and press down until completely
   saturated in liquid to help keep eggs submerged and marinating
   evenly. Refrigerate and marinate at least four hours and up to 12.
   Discard marinade after 12 hours. Store eggs in a sealed container
   in the fridge for up to 3 days. Reheat in ramen soup to serve.

Note: This recipe can be made using leftover broth from chashu pork.
If you have this broth, replace all the ingredients in the marinade
with the broth.&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The ingredients list is interactive: with the cursor on one of the list items, I can use &lt;code&gt;C-c C-c&lt;/code&gt; to check or uncheck it. This is extremely useful for making shopping lists. The directions list has to be separated by &lt;em&gt;two&lt;/em&gt; blank lines from the ingredients list, or org-mode will parse them as being part of the same list, and insist they both be bullets or both be numbers.&lt;/p&gt;
&lt;p&gt;The properties drawer has slots for most of the metadata that comes with a recipe: author, yield, estimated time, etc., as well as one for the URL, and the date it was added to &lt;code&gt;Cooking.org&lt;/code&gt;. Combined with the tag structure, it is a breeze to search for recipes by hitting &lt;kbd&gt;C-c / m&lt;/kbd&gt; and typing in a &lt;a href=&quot;https://orgmode.org/manual/Matching-tags-and-properties.html&quot;&gt;match pattern&lt;/a&gt;. This creates a &lt;a href=&quot;https://orgmode.org/manual/Sparse-Trees.html&quot;&gt;sparse tree&lt;/a&gt;, which shows the titles of all matching recipes. For example, I can search for:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Chinese recipes with the pattern &lt;code&gt;chinese&lt;/code&gt;;&lt;/li&gt;
&lt;li&gt;Chinese recipes that are &lt;em&gt;also&lt;/em&gt; vegetarian with &lt;code&gt;chinese+vegetarian&lt;/code&gt;;&lt;/li&gt;
&lt;li&gt;Vegetarian Chinese recipes I&#8217;ve never made before with &lt;code&gt;chinese+vegetarian/NEVERMADE&lt;/code&gt;;&lt;/li&gt;
&lt;li&gt;Recipes I&#8217;ve added in the past month with &lt;code&gt;Added&amp;gt;=&amp;quot;&amp;lt;-1m&amp;gt;&amp;quot;&lt;/code&gt;, or since May with &lt;code&gt;Added&amp;gt;=&amp;quot;&amp;lt;2020-05-01&amp;gt;&amp;quot;&lt;/code&gt;;&lt;/li&gt;
&lt;li&gt;Recipes that come together in less than 90 minutes with &lt;code&gt;Total_time&amp;lt;&amp;quot;1:30&amp;quot;&lt;/code&gt;;&lt;a href=&quot;#fn3&quot; class=&quot;footnote-ref&quot; id=&quot;fnref3&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Recipes from the New York Times with &lt;code&gt;URL={cooking.nytimes.com}&lt;/code&gt;. The braces indicate a regular expression.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There is also the &lt;kbd&gt;C-c / p&lt;/kbd&gt; command for simple equality matches&#8212;for example, if I wanted to find all recipes by &lt;a href=&quot;https://en.wikipedia.org/wiki/Amanda_Hesser&quot;&gt;Amanda Hesser&lt;/a&gt;&#8212;which supports tab completion.&lt;/p&gt;
&lt;h1 id=&quot;adding-recipes&quot;&gt;Adding recipes&lt;/h1&gt;
&lt;p&gt;Although adding a new recipe is as easy as creating a new heading, it would be tedious to copy the properties drawer each time. A much easier way is to use &lt;a href=&quot;https://orgmode.org/manual/Capture.html&quot;&gt;capture&lt;/a&gt;, which allows the quick &#8220;capturing&#8221; and filing of data from any open file. I keep the following &lt;a href=&quot;https://orgmode.org/manual/Capture-templates.html&quot;&gt;capture template&lt;/a&gt; in my &lt;code&gt;~/.emacs&lt;/code&gt; file:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode lisp&quot;&gt;&lt;code class=&quot;sourceCode commonlisp&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-1&quot; title=&quot;1&quot;&gt;(custom-set-variables&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-2&quot; title=&quot;2&quot;&gt; &amp;#39;(org-capture-templates&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-3&quot; title=&quot;3&quot;&gt;    &amp;#39;((&lt;span class=&quot;st&quot;&gt;&amp;quot;r&amp;quot;&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;Recipe&amp;quot;&lt;/span&gt; entry&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-4&quot; title=&quot;4&quot;&gt;      (file+headline &lt;span class=&quot;st&quot;&gt;&amp;quot;~/org/Cooking.org&amp;quot;&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;Unsorted recipes:&amp;quot;&lt;/span&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-5&quot; title=&quot;5&quot;&gt;      &lt;span class=&quot;st&quot;&gt;&amp;quot;* NEVERMADE %? :weekday:&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-6&quot; title=&quot;6&quot;&gt;&lt;span class=&quot;st&quot;&gt;:PROPERTIES:&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-7&quot; title=&quot;7&quot;&gt;&lt;span class=&quot;st&quot;&gt;:Author:&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-8&quot; title=&quot;8&quot;&gt;&lt;span class=&quot;st&quot;&gt;:Source:&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-9&quot; title=&quot;9&quot;&gt;&lt;span class=&quot;st&quot;&gt;:Sent_by:&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-10&quot; title=&quot;10&quot;&gt;&lt;span class=&quot;st&quot;&gt;:Yield:&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-11&quot; title=&quot;11&quot;&gt;&lt;span class=&quot;st&quot;&gt;:Prep_Time:&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-12&quot; title=&quot;12&quot;&gt;&lt;span class=&quot;st&quot;&gt;:Cook_Time:&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-13&quot; title=&quot;13&quot;&gt;&lt;span class=&quot;st&quot;&gt;:Total_Time:&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-14&quot; title=&quot;14&quot;&gt;&lt;span class=&quot;st&quot;&gt;:Cost:&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-15&quot; title=&quot;15&quot;&gt;&lt;span class=&quot;st&quot;&gt;:Description:&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-16&quot; title=&quot;16&quot;&gt;&lt;span class=&quot;st&quot;&gt;:URL:&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-17&quot; title=&quot;17&quot;&gt;&lt;span class=&quot;st&quot;&gt;:Added: %u&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-18&quot; title=&quot;18&quot;&gt;&lt;span class=&quot;st&quot;&gt;:END:&amp;quot;&lt;/span&gt;))))&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I can add a recipe from any file by hitting &lt;kbd&gt;C-c c r&lt;/kbd&gt;; org-mode will create a new recipe under &lt;code&gt;Unsorted Recipes&lt;/code&gt; with the template above, and I just have to fill in the details. The &lt;code&gt;%u&lt;/code&gt; is &lt;a href=&quot;https://orgmode.org/manual/Template-expansion.html&quot;&gt;automatically replaced&lt;/a&gt; with the current date, and the &lt;code&gt;%?&lt;/code&gt; tells org-mode where to put the cursor. Since most recipes follow the same basic pattern (paragraph of metadata, unnumbered list of ingredients, numbered list of directions), formatting the recipes as described above is very quick, with a few caveats: times have to be formatted as &lt;code&gt;HH:MM&lt;/code&gt;, and the description can&#8217;t run into multiple paragraphs (I use &lt;code&gt;//&lt;/code&gt; as a paragraph separator, but I&#8217;m not thrilled with this solution).&lt;/p&gt;
&lt;p&gt;Finally, the new recipe can be easily refiled with &lt;kbd&gt;C-c C-w&lt;/kbd&gt;.&lt;/p&gt;
&lt;h1 id=&quot;final-thoughts&quot;&gt;Final thoughts&lt;/h1&gt;
&lt;p&gt;The main downside to this system is that there is no easy way to store images. Many recipes have &lt;a href=&quot;https://smittenkitchen.com/2012/03/potato-knish-two-ways/&quot;&gt;complicated assemblies&lt;/a&gt; that are best explained in pictures. The best I can do is store a note that says something like &#8220;see pictures in original recipe&#8221;, which has been good enough so far.&lt;/p&gt;
&lt;!--
I&apos;ll end with another upside though; namely, that I still have those charts that were cluttering up the folder, but now they&apos;re actually useful since they&apos;re the only things in there.
Here&apos;s one I made for the [mother sauces](https://en.wikipedia.org/wiki/Sauce#French_cuisine) (click to download PDF):

[![](MotherSauces.png)](MotherSauces.pdf)
--&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot;&gt;&lt;p&gt;In Emacs-speak, &lt;kbd&gt;C&lt;/kbd&gt; is the control key, &lt;kbd&gt;M&lt;/kbd&gt;, or &#8220;meta&#8221; is alt, and &lt;kbd&gt;S&lt;/kbd&gt; is shift. So &lt;kbd&gt;M-2 S-Tab&lt;/kbd&gt; means you hit alt-2, then shift-tab in sequence.&lt;a href=&quot;#fnref1&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot;&gt;&lt;p&gt;This is just a subset for illustration; my actual table is larger.&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn3&quot;&gt;&lt;p&gt;In this and the above example, notice the quotation marks.&lt;a href=&quot;#fnref3&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
	</description>
		</item>
		<item>
			<title>Menu Categorization</title>
			<link>https://alexklapheke.github.io/blog/publish/menu.md</link>
			<pubDate>Fri, 03 Jul 2020 18:11:59 -0400</pubDate>
	<description>
&lt;div class=&quot;epigraph&quot;&gt;
&lt;p&gt;The History of every major Galactic Civilization tends to pass through three distinct and recognizable phases, those of Survival, Inquiry and Sophistication, otherwise known as the How, Why and Where phases.&lt;/p&gt;
&lt;p&gt;For instance, the first phase is characterized by the question &#8220;How can we eat?&#8221;, the second by the question &#8220;Why do we eat?&#8221; and the third by the question, &#8220;Where shall we have lunch?&#8221;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Since 2011, the New York Public Library has maintained &lt;a href=&quot;http://menus.nypl.org/&quot;&gt;&#8220;What&#8217;s on the menu?&#8221;&lt;/a&gt;, a collection of tens of thousands of restaurant menus going back to the mid-nineteenth century. This is an invaluable collection not just for data scientists, but for food historians, since it is well known that foods go in and out of fashion like clothing. For example, the famed &lt;a href=&quot;https://en.wikipedia.org/wiki/Grand_Central_Oyster_Bar_%26_Restaurant&quot;&gt;Oyster Bar&lt;/a&gt; at Grand Central Terminal, which in 1941 &lt;a href=&quot;https://commons.wikimedia.org/wiki/File:Grand_Central_Terminal_Restaurant_menu_1941.jpg&quot;&gt;featured&lt;/a&gt; &#8220;cream of chicken &#224; la reine&#8221;, &#8220;broiled sweetbreads on toast with Virginia ham&#8221;, and &#8220;farina custard pudding, Melba sauce&#8221; (not to mention oysters for a nickel apiece), today &lt;a href=&quot;https://web.archive.org/web/20160315171449/http://www.oysterbarny.com/pdf/dailymenu.pdf&quot;&gt;serves&lt;/a&gt; such mouthfuls as &#8220;poached farmed Norwegian salmon over baby red oak-watercress salad with charred scallion-honey vinaigrette, avocado, and goat cheese.&#8221;&lt;/p&gt;
&lt;p&gt;These vicissitudes are due partly to economics. In 1914, avocados, then known as &#8220;alligator pears&#8221;, &lt;a href=&quot;https://time.com/4832655/avocado-american-history/&quot;&gt;could go for&lt;/a&gt; $1 each&#8212;more that $25 today. But economics can be adulterated by public perception. David Foster Wallace, considering the lobster, wrote that &lt;span class=&quot;citation&quot; data-cites=&quot;wallace2004consider&quot;&gt;[-@wallace2004consider,p. 55]&lt;/span&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Up until sometime in the 1800s, though, lobster was literally low-class food, eaten only by the poor and institutionalized. Even in the harsh penal environment of early America, some colonies had laws against feeding lobsters to inmates more than once a week because it was thought to be cruel and unusual, like making people eat rats. One reason for their low status was how plentiful lobsters were in old New England. &#8220;Unbelievable abundance&#8221; is how one source describes the situation, including accounts of Plymouth pilgrims wading out and capturing all they wanted by hand, and of early Boston&#8217;s seashore being littered with lobsters after hard storms&#8212;these latter were treated as a smelly nuisance and ground up for fertilizer. There is also the fact that premodern lobster was often cooked dead and then preserved, usually packed in salt or crude hermetic containers. Maine&#8217;s earliest lobster industry was based around a dozen such seaside canneries in the 1840s, from which lobster was shipped as far away as California, in demand only because it was cheap and high in protein, basically chewable fuel.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;By 1941, of course, the Oyster Bar&#8217;s menu lists &#8220;alligator pear salad&#8221; for 45&#162; and &#8220;lobster pan roast&#8221;&#8212;one of the priciest items named&#8212;for $1.45.&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; In this project I wanted to see if, using this data,&lt;a href=&quot;#fn2&quot; class=&quot;footnote-ref&quot; id=&quot;fnref2&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt; I could predict the year a menu was served based on the dishes listed.&lt;/p&gt;
&lt;h1 id=&quot;data-structuring&quot;&gt;Data structuring&lt;/h1&gt;
&lt;p&gt;The NYPL provides the data in the very simple &lt;a href=&quot;https://en.wikipedia.org/wiki/Snowflake_schema&quot;&gt;snowflake schema&lt;/a&gt; shown in &lt;span class=&quot;citation&quot; data-cites=&quot;fig:schema&quot;&gt;@fig:schema&lt;/span&gt;. The central table is &lt;code&gt;MenuItem.csv&lt;/code&gt;, in which each of the 1,334,417 rows represents an item on a menu. Each references a particular dish, which are named in &lt;code&gt;Dish.csv&lt;/code&gt; (426,959 comestibles in total), and each is also referenced to a page in &lt;code&gt;MenuPage.csv&lt;/code&gt;, which are in turn referenced in &lt;code&gt;Menu.csv&lt;/code&gt; to the particular bills of fare on which they appear.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;menu-schema.svg&quot; alt=&quot;Menu dataset table schema (some columns omitted). Source code&quot; id=&quot;fig:schema&quot; /&gt;&lt;figcaption&gt;Menu dataset table schema (some columns omitted). &lt;a href=&quot;https://gist.github.com/alexklapheke/a197eed2a9ba742aa0080c1bdbfa579c&quot;&gt;Source code&lt;/a&gt;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Since all I wanted was the name of the dish (from &lt;code&gt;Dish.csv&lt;/code&gt;), the date (from &lt;code&gt;Menu.csv&lt;/code&gt;), and the menu ID (in case I wanted to group dishes by menu), I merged the data frames like so:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Add menu id to each menu item&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-2&quot; title=&quot;2&quot;&gt;df &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; pd.merge(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-3&quot; title=&quot;3&quot;&gt;    left &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; menu_item[[&lt;span class=&quot;st&quot;&gt;&amp;quot;dish_id&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;menu_page_id&amp;quot;&lt;/span&gt;]],&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-4&quot; title=&quot;4&quot;&gt;    right &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; menu_page[[&lt;span class=&quot;st&quot;&gt;&amp;quot;id&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;menu_id&amp;quot;&lt;/span&gt;]],&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-5&quot; title=&quot;5&quot;&gt;    how &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-6&quot; title=&quot;6&quot;&gt;    left_on &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;menu_page_id&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-7&quot; title=&quot;7&quot;&gt;    right_on &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-8&quot; title=&quot;8&quot;&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-9&quot; title=&quot;9&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-10&quot; title=&quot;10&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Add menu date to each menu id&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-11&quot; title=&quot;11&quot;&gt;df &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; pd.merge(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-12&quot; title=&quot;12&quot;&gt;    left &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; df,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-13&quot; title=&quot;13&quot;&gt;    right &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; menu[[&lt;span class=&quot;st&quot;&gt;&amp;quot;id&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;date&amp;quot;&lt;/span&gt;]],&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-14&quot; title=&quot;14&quot;&gt;    how &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-15&quot; title=&quot;15&quot;&gt;    left_on &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;menu_id&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-16&quot; title=&quot;16&quot;&gt;    right_on &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-17&quot; title=&quot;17&quot;&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-18&quot; title=&quot;18&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-19&quot; title=&quot;19&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Add dish name to each menu item&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-20&quot; title=&quot;20&quot;&gt;df &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; pd.merge(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-21&quot; title=&quot;21&quot;&gt;    left &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; df,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-22&quot; title=&quot;22&quot;&gt;    right &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; dish[[&lt;span class=&quot;st&quot;&gt;&amp;quot;id&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;]],&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-23&quot; title=&quot;23&quot;&gt;    how &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;right&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-24&quot; title=&quot;24&quot;&gt;    left_on &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;dish_id&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-25&quot; title=&quot;25&quot;&gt;    right_on &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-26&quot; title=&quot;26&quot;&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-27&quot; title=&quot;27&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-28&quot; title=&quot;28&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Remove intermediate columns&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-29&quot; title=&quot;29&quot;&gt;df &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; df[[&lt;span class=&quot;st&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;date&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;menu_id&amp;quot;&lt;/span&gt;]]&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This left me with a single data frame of menu items to clean and parse.&lt;/p&gt;
&lt;h1 id=&quot;data-cleaning&quot;&gt;Data cleaning&lt;/h1&gt;
&lt;h2 id=&quot;dates&quot;&gt;Dates&lt;/h2&gt;
&lt;p&gt;The first work to be done was on the dates. For example, 638 dates turned out to be incorrect or malformed. In some, like &lt;code&gt;1091-01-27&lt;/code&gt;, the error was transparent, but with less than 0.05% of the data so corrupted, I decided to just drop them. However, another 68,438 items&#8212;5% of the data&#8212;were missing dates altogether. Since they were useless to the analysis, and I couldn&#8217;t know if there was a pattern to the missingness, I was forced to drop these as well. Then, from the 1.27 million well-formed dates remaining, I extracted the year and decade, the latter of which would prove a more reasonable target for modeling than the former.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Drop malformed dates&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-2&quot; title=&quot;2&quot;&gt;df[&lt;span class=&quot;st&quot;&gt;&amp;quot;date&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; pd.to_datetime(df[&lt;span class=&quot;st&quot;&gt;&amp;quot;date&amp;quot;&lt;/span&gt;], errors&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;coerce&amp;quot;&lt;/span&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-3&quot; title=&quot;3&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-4&quot; title=&quot;4&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Calculate year and decade&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-5&quot; title=&quot;5&quot;&gt;df[&lt;span class=&quot;st&quot;&gt;&amp;quot;year&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; df[&lt;span class=&quot;st&quot;&gt;&amp;quot;date&amp;quot;&lt;/span&gt;].dt.year&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-6&quot; title=&quot;6&quot;&gt;df[&lt;span class=&quot;st&quot;&gt;&amp;quot;decade&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; df[&lt;span class=&quot;st&quot;&gt;&amp;quot;year&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;10&lt;/span&gt;&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;A further problem is that our dataset&#8217;s classes are heavily unbalanced. Looking at &lt;span class=&quot;citation&quot; data-cites=&quot;fig:decade&quot;&gt;@fig:decade&lt;/span&gt;, we see that the great preponderance of them&#8212;a full 63% of menus and 62% of items&#8212;are from the initial two decades of the twentieth century.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;menu-items-by-decade.svg&quot; alt=&quot;Number of menus (left) and menu items (right) by decade&quot; id=&quot;fig:decade&quot; /&gt;&lt;figcaption&gt;Number of menus (left) and menu items (right) by decade&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;This could cause problems during modeling, not only because a na&#239;ve model could latch onto the majority class and return it without considering the inputs, but because the meagerness of data&#8212;particularly before 1880 and after 1990&#8212;will leave the model with inadequate information to categorize &lt;em&gt;any&lt;/em&gt; menu as being from these eras.&lt;/p&gt;
&lt;h2 id=&quot;menus&quot;&gt;Menus&lt;/h2&gt;
&lt;p&gt;Looking at the number of items featured on each menu, we see that although 22.7% of them feature fewer than a hundred items, several reach into the thousands, with a startling outlier:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;menu-item-length.svg&quot; alt=&quot;Number of items on menus (log10 scale)&quot; id=&quot;fig:items&quot; /&gt;&lt;figcaption&gt;Number of items on menus (log&lt;sub&gt;10&lt;/sub&gt; scale)&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;That last menu, a &lt;a href=&quot;http://menus.nypl.org/menus/31054&quot;&gt;1933 Plaza Hotel menu&lt;/a&gt;, is actually 62 menus bound together, totalling 4,060 dishes. However, even the runner-up, a &lt;a href=&quot;http://menus.nypl.org/menus/34201&quot;&gt;1914 Waldorf Astoria menu&lt;/a&gt;, packs 1,360 dishes into ten octavo-sized pages. (For reference, the famously voluminous Cheesecake Factory menu has &lt;a href=&quot;https://www.mentalfloss.com/article/566482/why-the-cheesecake-factorys-menu-is-so-big&quot;&gt;&#8220;only&#8221;&lt;/a&gt; 250 items.) This shouldn&#8217;t matter to the model, of course, since it will be trained only on individual dish names.&lt;/p&gt;
&lt;h2 id=&quot;dishes&quot;&gt;Dishes&lt;/h2&gt;
&lt;p&gt;The dish names themselves were somewhat less tractable. The menus are transcribed by hand, eliminating the need to deal with OCR errors, but many items were unreasonably long.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;menu-name-length.svg&quot; alt=&quot;Character length of menu items (log10 scale)&quot; id=&quot;fig:length&quot; /&gt;&lt;figcaption&gt;Character length of menu items (log&lt;sub&gt;10&lt;/sub&gt; scale)&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;As the histogram in &lt;span class=&quot;citation&quot; data-cites=&quot;fig:length&quot;&gt;@fig:length&lt;/span&gt; shows, these go well beyond gusty descriptions like our &#8220;poached farmed Norwegian salmon&#8221;&#8212;the longest, from first class on a &lt;a href=&quot;http://menus.nypl.org/menus/29358&quot;&gt;1993 Virgin Atlantic flight&lt;/a&gt;, reads with the paragraph breaks removed like a deranged Basil Fawlty:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Afternoon Tea- A Great British Tradition- Tea, the most universally consumed of all drinks, is especially popular in Britain where the annual consumption is something in the region of 512 million cups. W. E. Gladstone observed &#8220;If you are cold, tea will warm you- if you are heated, it will cool you- if you are depressed, it will cheer you- if you are excited, it will calm you.&#8221; First brought to England c. 1559 by Giambattista Rusmusio, tea did not evolve into an afternoon meal until the end of the 18th century. Anna, Duchess of Bedford, invented afternoon tea to fill the long gap between early lunch and dinner which bored many house parties. It became a meal surrounded by etiquette and customs, delicate china, silver, cake stands and doilies- a time when friend and family meet. Famous tea parties include Mad Hatter&#8217;s (Alice&#8217;s Adventures in Wonderland by Lewis Carroll 1865), the Boston Tea Party, 1773, and not forgetting HM Queen Elizabeth II&#8217;s annual garden parties at Buckingham Palace. The Duke of Wellington declared that &#8220;Tea cleared my head and left no misapprehensions.&#8221; He was right- tea contains small amounts of two B vitamins, and has no calories, artificial flavourings or colourings. It is said to cure gout, apoplexy, epilepsy, gall stones and sleepiness, and one&#8217;s longevity is assured. &#8220;Thank God for Tea! What would the world do without tea?&#8221;- Sydney Smith&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Like the erroneous dates, these were sparse&#8212;only 6,682, or 0.5% of the listed dishes exceeded 100 characters, and these held only 3.7% of the dataset&#8217;s total characters. However, the decision to drop them was less clear-cut, since they potentially contained period-specific text which could be used to inform a model. I ultimately stetted them for this reason.&lt;/p&gt;
&lt;p&gt;I then processed the text. &lt;!-- were listed in foreign languages,  --&gt; 251 menu items contained non-ASCII characters, of which 126 were in French,&lt;a href=&quot;#fn3&quot; class=&quot;footnote-ref&quot; id=&quot;fnref3&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt; 56 Chinese, 21 German, 20 Swedish, 11 Greek, 10 Hindi, 3 Hungarian, and one lonely item in Polish. The remaining three were English with special characters such as &#189;. Happily, the excellent Python library &lt;a href=&quot;https://pypi.org/project/Unidecode/&quot;&gt;Unidecode&lt;/a&gt; can do most of the heavy lifting here, stripping accents, and Romanizing the Greek, Hindi, and Chinese.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; unidecode &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; unidecode&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-2&quot; title=&quot;2&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-3&quot; title=&quot;3&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Remove special characters&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-4&quot; title=&quot;4&quot;&gt;df[&lt;span class=&quot;st&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; df[&lt;span class=&quot;st&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;].&lt;span class=&quot;bu&quot;&gt;apply&lt;/span&gt;(unidecode)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-5&quot; title=&quot;5&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-6&quot; title=&quot;6&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Check for remaining non-ASCII characters&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-7&quot; title=&quot;7&quot;&gt;df[df[&lt;span class=&quot;st&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;].&lt;span class=&quot;bu&quot;&gt;str&lt;/span&gt;.match(&lt;span class=&quot;st&quot;&gt;&amp;quot;[^&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\x00&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\x7F&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;]&amp;quot;&lt;/span&gt;)][&lt;span class=&quot;st&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;]&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It then remained only to normalize to lower case and tokenize on the regular expression &lt;code&gt;[a-z&apos;-]+&lt;/code&gt;, which captures strings of letters, apostrophes, and hyphens and throws out other punctuation and numbers (since this destroys ordering information, I put it into a new column called &lt;code&gt;tokens&lt;/code&gt;).&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; nltk.tokenize &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; RegexpTokenizer&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-2&quot; title=&quot;2&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; nltk.corpus &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; stopwords&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-3&quot; title=&quot;3&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-4&quot; title=&quot;4&quot;&gt;tokenizer &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; RegexpTokenizer(&lt;span class=&quot;st&quot;&gt;&amp;quot;[a-z&amp;#39;-]+&amp;quot;&lt;/span&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-5&quot; title=&quot;5&quot;&gt;stopwords &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;set&lt;/span&gt;(stopwords.words(&lt;span class=&quot;st&quot;&gt;&amp;quot;english&amp;quot;&lt;/span&gt;))&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-6&quot; title=&quot;6&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-7&quot; title=&quot;7&quot;&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; tokenize(text):&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-8&quot; title=&quot;8&quot;&gt;    tokens &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;set&lt;/span&gt;(tokenizer.tokenize(text))&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-9&quot; title=&quot;9&quot;&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot; &amp;quot;&lt;/span&gt;.join(tokens &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt; stopwords)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-10&quot; title=&quot;10&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-11&quot; title=&quot;11&quot;&gt;df[&lt;span class=&quot;st&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; df[&lt;span class=&quot;st&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;].&lt;span class=&quot;bu&quot;&gt;str&lt;/span&gt;.lower()&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb4-12&quot; title=&quot;12&quot;&gt;df[&lt;span class=&quot;st&quot;&gt;&amp;quot;tokens&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; df[&lt;span class=&quot;st&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;].&lt;span class=&quot;bu&quot;&gt;apply&lt;/span&gt;(tokenize)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I also threw out &lt;a href=&quot;https://en.wikipedia.org/wiki/Stop_words&quot;&gt;stopwords&lt;/a&gt; such as &#8220;the&#8221;. The text was now ready for exploring trends and building a predictive model.&lt;/p&gt;
&lt;h1 id=&quot;data-exploration&quot;&gt;Data exploration&lt;/h1&gt;
&lt;h2 id=&quot;cross-sectional&quot;&gt;Cross-sectional&lt;/h2&gt;
&lt;p&gt;I first examined the top words from each decade, excerpted in &lt;span class=&quot;citation&quot; data-cites=&quot;fig:1850&quot;&gt;@fig:1850&lt;/span&gt;&#8211;&lt;span class=&quot;citation&quot; data-cites=&quot;fig:1990&quot;&gt;@fig:1990&lt;/span&gt;.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;menu-decade-1850.svg&quot; alt=&quot;Most common words on menus from the 1850s&quot; id=&quot;fig:1850&quot; /&gt;&lt;figcaption&gt;Most common words on menus from the 1850s&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;There are only a few menus from the 1850s in the collection, but we can get a sense of the palate. Names of wines&#8212;&lt;em&gt;madeira&lt;/em&gt;, &lt;em&gt;sherry&lt;/em&gt;, and &lt;em&gt;claret&lt;/em&gt;, and probably also &lt;em&gt;ch&#226;teau&lt;/em&gt; and &lt;em&gt;pale&lt;/em&gt;&#8212;feature prominently, and the most common cooking methods are boiling and roasting.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;menu-decade-1910.svg&quot; alt=&quot;Most common words on menus from the 1910s&quot; id=&quot;fig:1910&quot; /&gt;&lt;figcaption&gt;Most common words on menus from the 1910s&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;By the 1910s, we have a new picture: fried foods are popular, as are cream sauces. Chicken and beef have made the list, as, notably, does salad, as fresh fruits and vegetables become more available to the average patron.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;menu-decade-1950.svg&quot; alt=&quot;Most common words on menus from the 1950s&quot; id=&quot;fig:1950&quot; /&gt;&lt;figcaption&gt;Most common words on menus from the 1950s&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;We see fewer changes in the post-war era, but &#8220;fresh&#8221; has been advanced, as have French &lt;em&gt;de&lt;/em&gt; &#8216;of&#8217; and German &lt;em&gt;mit&lt;/em&gt; &#8216;with&#8217;, indicating European dishes, or at least European phrasings, coming into vogue.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;menu-decade-1990.svg&quot; alt=&quot;Most common words on menus from the 1990s&quot; id=&quot;fig:1990&quot; /&gt;&lt;figcaption&gt;Most common words on menus from the 1990s&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;In the 1990s, &#8220;fried&#8221; has been replaced by &#8220;grilled&#8221;, and a renewed interest in French cuisine seems to be the &lt;em&gt;dernier cri&lt;/em&gt;, as five of the ten are French grammatical words not filtered by the English stopword list (and &lt;em&gt;de&lt;/em&gt; outpacing the next-highest word by almost 2 to 1).&lt;/p&gt;
&lt;h2 id=&quot;longitudinal&quot;&gt;Longitudinal&lt;/h2&gt;
&lt;p&gt;Equally illuminating is to look at the waxing and waning of particular foods across time, in the style of &lt;a href=&quot;https://books.google.com/ngrams&quot;&gt;Google Ngrams&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-1&quot; title=&quot;1&quot;&gt;words &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;st&quot;&gt;&amp;quot;lobster&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;oyster&amp;quot;&lt;/span&gt;]&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-2&quot; title=&quot;2&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-3&quot; title=&quot;3&quot;&gt;occurrences &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; {word: df[&lt;span class=&quot;st&quot;&gt;&amp;quot;tokens&amp;quot;&lt;/span&gt;].&lt;span class=&quot;bu&quot;&gt;str&lt;/span&gt;.contains(&lt;span class=&quot;ss&quot;&gt;f&amp;quot;&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;{&lt;/span&gt;word&lt;span class=&quot;sc&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;b&amp;quot;&lt;/span&gt;) &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; word &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; words}&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb5-4&quot; title=&quot;4&quot;&gt;menu_item_prop &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; pd.DataFrame(occurrences).join([df[&lt;span class=&quot;st&quot;&gt;&amp;quot;year&amp;quot;&lt;/span&gt;]).groupby(&lt;span class=&quot;st&quot;&gt;&amp;quot;year&amp;quot;&lt;/span&gt;).mean()&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The Madeira that was so popular in the 1850s dropped off steeply soon after (&lt;span class=&quot;citation&quot; data-cites=&quot;fig:madeira&quot;&gt;@fig:madeira&lt;/span&gt;).&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;menu-term-madeira.svg&quot; alt=&quot;Percent of menu items per year containing the word &#8220;Madeira&#8221;&quot; id=&quot;fig:madeira&quot; /&gt;&lt;figcaption&gt;Percent of menu items per year containing the word &#8220;Madeira&#8221;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;We see the Sun rise and set on the age of Jell-O in &lt;span class=&quot;citation&quot; data-cites=&quot;fig:jello&quot;&gt;@fig:jello&lt;/span&gt;, and in &lt;span class=&quot;citation&quot; data-cites=&quot;fig:tofu&quot;&gt;@fig:tofu&lt;/span&gt; the nascence of tofu.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;menu-term-jell-o.svg&quot; alt=&quot;Percent of menu items per year containing the word &#8220;Jell-O&#8221;&quot; id=&quot;fig:jello&quot; /&gt;&lt;figcaption&gt;Percent of menu items per year containing the word &#8220;Jell-O&#8221;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;figure&gt;
&lt;img src=&quot;menu-term-tofu.svg&quot; alt=&quot;Percent of menu items per year containing the word &#8220;tofu&#8221;&quot; id=&quot;fig:tofu&quot; /&gt;&lt;figcaption&gt;Percent of menu items per year containing the word &#8220;tofu&#8221;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;It is also interesting to look at descriptors. Organic food is rooted in the environmental movement of the &#8217;60s and &#8217;70s, but doesn&#8217;t appear on restaurant menus until the turn of the millennium.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;menu-term-organic.svg&quot; alt=&quot;Percent of menu items per year containing the word &#8220;organic&#8221;&quot; id=&quot;fig:organic&quot; /&gt;&lt;figcaption&gt;Percent of menu items per year containing the word &#8220;organic&#8221;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Health terms such as &#8220;diet&#8221; show a similar trend, appearing in numbers in the &#8217;70s.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;menu-term-health-healthy-diet-lite.svg&quot; alt=&quot;Percent of menu items per year containing health terms  &#160;&#8220;health&#8221; &#160;&#8220;healthy&#8221; &#160;&#8220;diet&#8221; &#160;&#8220;lite&#8221; &quot; id=&quot;fig:health&quot; /&gt;&lt;figcaption&gt;Percent of menu items per year containing health terms&lt;br /&gt;
&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;4&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke-width=&quot;4&quot; stroke=&quot;#e7298a&quot; /&gt;&lt;/svg&gt;&#160;&#8220;health&#8221;&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;4&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke-width=&quot;4&quot; stroke=&quot;#66a61e&quot; /&gt;&lt;/svg&gt;&#160;&#8220;healthy&#8221;&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;4&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke-width=&quot;4&quot; stroke=&quot;#e6ab02&quot; /&gt;&lt;/svg&gt;&#160;&#8220;diet&#8221;&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;4&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke-width=&quot;4&quot; stroke=&quot;#a6761d&quot; /&gt;&lt;/svg&gt;&#160;&#8220;lite&#8221;&lt;br /&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;We can also use foreign words that commonly appear on menus as a rough proxy for how fashionable those cuisines were in different periods.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;menu-term-au-alla-mit.svg&quot; alt=&quot;Percent of menu items per year containing foreign prepositions  &#160;au (Fr. &#8216;in the style of&#8217;) &#160;alla (It. &#8216;in the style of&#8217;) &#160;mit (Gm. &#8216;with&#8217;)&quot; id=&quot;fig:auallamit&quot; /&gt;&lt;figcaption&gt;Percent of menu items per year containing foreign prepositions&lt;br /&gt;
&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;4&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke-width=&quot;4&quot; stroke=&quot;#e7298a&quot; /&gt;&lt;/svg&gt;&#160;&lt;em&gt;au&lt;/em&gt; (Fr. &#8216;in the style of&#8217;)&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;4&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke-width=&quot;4&quot; stroke=&quot;#66a61e&quot; /&gt;&lt;/svg&gt;&#160;&lt;em&gt;alla&lt;/em&gt; (It. &#8216;in the style of&#8217;)&lt;br /&gt;
&lt;svg width=&quot;20&quot; height=&quot;4&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke-width=&quot;4&quot; stroke=&quot;#e6ab02&quot; /&gt;&lt;/svg&gt;&#160;&lt;em&gt;mit&lt;/em&gt; (Gm. &#8216;with&#8217;)&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;A clear post-war interest in French and German cuisine manifests itself&#8212;although the 40% of menu items in 2005 containing &lt;em&gt;mit&lt;/em&gt; is more likely an artifact of a small sample than a genuine trend.&lt;/p&gt;
&lt;h1 id=&quot;modeling&quot;&gt;Modeling&lt;/h1&gt;
&lt;p&gt;The first step is to sample from the data, firstly to correct the class imbalance seen in &lt;span class=&quot;citation&quot; data-cites=&quot;fig:decade&quot;&gt;@fig:decade&lt;/span&gt; above, but more importantly, to curtail the incredibly large matrix we would get if we vectorized the entire data frame.&lt;a href=&quot;#fn4&quot; class=&quot;footnote-ref&quot; id=&quot;fnref4&quot;&gt;&lt;sup&gt;4&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;co&quot;&gt;# We want each class to have only as many as the smallest class&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-2&quot; title=&quot;2&quot;&gt;sample_size &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; df.groupby(&lt;span class=&quot;st&quot;&gt;&amp;quot;decade&amp;quot;&lt;/span&gt;)[&lt;span class=&quot;st&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;].count().&lt;span class=&quot;bu&quot;&gt;min&lt;/span&gt;()&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-3&quot; title=&quot;3&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-4&quot; title=&quot;4&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Sample randomly from each decade&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb6-5&quot; title=&quot;5&quot;&gt;sample &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; df.sample(frac&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;).groupby(&lt;span class=&quot;st&quot;&gt;&amp;quot;decade&amp;quot;&lt;/span&gt;).head(sample_size)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then we define our variables and create train and test classes:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb7&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; sklearn.model_selection &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; train_test_split&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-2&quot; title=&quot;2&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-3&quot; title=&quot;3&quot;&gt;X &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; sample[&lt;span class=&quot;st&quot;&gt;&amp;quot;tokens&amp;quot;&lt;/span&gt;]&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-4&quot; title=&quot;4&quot;&gt;y &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; sample[&lt;span class=&quot;st&quot;&gt;&amp;quot;decade&amp;quot;&lt;/span&gt;]&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-5&quot; title=&quot;5&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb7-6&quot; title=&quot;6&quot;&gt;X_train, X_test, y_train, y_test &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; train_test_split(X, y, stratify&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;y)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Since the &lt;code&gt;tokens&lt;/code&gt; column has already been cleaned, we can it for modeling using &lt;a href=&quot;https://en.wikipedia.org/wiki/Tf%E2%80%93idf&quot;&gt;tf-idf&lt;/a&gt; vectorization, which assigns high scores to words which are highly localized, occurring, say, only in the 1970s and nowhere else. This turns a vector of words into a vector of tf-idf scores.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb8&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; sklearn.feature_extraction.text &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; TfidfVectorizer&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-2&quot; title=&quot;2&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-3&quot; title=&quot;3&quot;&gt;tfidf &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; TfidfVectorizer()&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-4&quot; title=&quot;4&quot;&gt;X_train_vec &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; tfidf.fit_transform(X_train)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb8-5&quot; title=&quot;5&quot;&gt;X_test_vec &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; tfidf.transform(X_test)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Finally, the model itself can be constructed. I use a Gaussian na&#239;ve Bayes classifier, which is standard despite the data not following a Gaussian distribution.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb9-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; sklearn.naive_bayes &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; GaussianNB&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb9-2&quot; title=&quot;2&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb9-3&quot; title=&quot;3&quot;&gt;bayes &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; GaussianNB().fit(X_train_vec.toarray(), y_train)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Finally, we assess the accuracy of the model.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb10&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb10-1&quot; title=&quot;1&quot;&gt;bayes.score(X_train_vec.toarray(), y_train)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb10-2&quot; title=&quot;2&quot;&gt;bayes.score(X_test_vec.toarray(), y_test)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The results are pretty disappointing: 77.5% train accuracy and 17.6% test accuracy mean that the model arbitrarily latched onto some words that weren&#8217;t really indicative of their decades. This is due to our miserliness with the data: the model was only allowed to see 0.2% of the menu items. We can fix this by taking the second-lowest class rather than the lowest. This will give us &lt;em&gt;mostly&lt;/em&gt; balanced classes, but with fewer in the 1870s, to which only 174 menus are dated.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb11-1&quot; title=&quot;1&quot;&gt;sample_size &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; df.groupby(&lt;span class=&quot;st&quot;&gt;&amp;quot;decade&amp;quot;&lt;/span&gt;)[&lt;span class=&quot;st&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;].count().sort_values().iloc[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;]&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The results are more promising: 52.7% train and 21.7% test accuracy. Another consideration is that, since our classes are ordinal, even when the model is wrong, it may only be wrong by a decade or two. We can check this by defining a &#8220;fuzzy accuracy&#8221; score, and seeing how&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb12&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; fuzzy_accuracy(y_true, y_pred, tolerance):&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-2&quot; title=&quot;2&quot;&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; np.mean(np.&lt;span class=&quot;bu&quot;&gt;abs&lt;/span&gt;(y_true &lt;span class=&quot;op&quot;&gt;-&lt;/span&gt; y_pred) &lt;span class=&quot;op&quot;&gt;&amp;lt;=&lt;/span&gt; tolerance)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-3&quot; title=&quot;3&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-4&quot; title=&quot;4&quot;&gt;fuzzy_accuracy(y_train, bayes.predict(X_train_vec.toarray()), tolerance&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;10&lt;/span&gt;)&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb12-5&quot; title=&quot;5&quot;&gt;fuzzy_accuracy(y_test, bayes.predict(X_test_vec.toarray()), tolerance&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;10&lt;/span&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We now get 62.7% train and 40.2% test accuracy with a tolerance of one decade. With more memory available, it would be possible to feed more of the dataset into the model, and perhaps create a yet more accurate model.&lt;/p&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot;&gt;&lt;p&gt;In 2020, $7.85 and $25.29, respectively&lt;a href=&quot;#fnref1&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot;&gt;&lt;p&gt;Retrieved April 27, 2020&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn3&quot;&gt;&lt;p&gt;Or else in what Chesterton called &#8220;a sort of super-French employed by cooks, but quite unintelligible to Frenchmen&#8221;&lt;a href=&quot;#fnref3&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn4&quot;&gt;&lt;p&gt;Sampling function borrowed from &lt;a href=&quot;https://stackoverflow.com/a/56841648&quot; class=&quot;uri&quot;&gt;https://stackoverflow.com/a/56841648&lt;/a&gt;&lt;a href=&quot;#fnref4&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
	</description>
		</item>
		<item>
			<title>COVID-19 Sentiment Analysis</title>
			<link>https://alexklapheke.github.io/blog/publish/covid-sentiment.md</link>
			<pubDate>Tue, 23 Jun 2020 15:58:12 -0400</pubDate>
	<description>
&lt;p&gt;This project is joint work with Luken Weaver, Jon Godin, and Reza Farrokhi.&lt;/p&gt;
&lt;div class=&quot;epigraph&quot;&gt;
&lt;p&gt;The Master said, &#8220;When the multitude hate a man, it is necessary to examine into the case. When the multitude like a man, it is necessary to examine into the case.&#8221;&lt;/p&gt;
&lt;/div&gt;
&lt;h1 id=&quot;background-problem-statement&quot;&gt;Background &amp;amp; problem statement&lt;/h1&gt;
&lt;p&gt;The COVID-19 crisis officially began in the US on January 20, when an infected traveler in Wuhan flew home to Washington State &lt;span class=&quot;citation&quot; data-cites=&quot;holshue2020first&quot;&gt;[@holshue2020first]&lt;/span&gt;. For the several months thence, in the absence of a unified national policy, states have engaged in a complicated fandango of business closures, mask orders, and quarantines for visitors. While it would take a much more sophisticated data analysis to gauge their effectiveness, we can look at how these policies were popularly received using social media sentiment as a proxy.&lt;/p&gt;
&lt;p&gt;We chose to compare sentiment between two cities in which the saga took quite different turns: New York, which suffered both an alarming outbreak and an austere lockdown (ongoing at time of writing), and Houston, which had a much easier time, with fewer infections than New York City had deaths, and a lockdown lasting barely a month (&lt;span class=&quot;citation&quot; data-cites=&quot;fig:nychou&quot;&gt;@fig:nychou&lt;/span&gt;).&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;covid-nyc-hou.svg&quot; alt=&quot;Case and death counts in New York City (all five boroughs) and in Harris County, Texas (which contains Houston) as of June 22. Data courtesy of the New York Times.   &#160;Cases  &#160;Deaths  &#160;Lockdown (statewide)&quot; id=&quot;fig:nychou&quot; /&gt;&lt;figcaption&gt;Case and death counts in New York City (all five boroughs) and in Harris County, Texas (which contains Houston) as of June 22. Data courtesy of the &lt;a href=&quot;https://github.com/nytimes/covid-19-data&quot;&gt;&lt;em&gt;New York Times&lt;/em&gt;&lt;/a&gt;.&lt;br&gt;&lt;br&gt; &lt;svg width=&quot;20&quot; height=&quot;4&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke-width=&quot;4&quot; stroke=&quot;#081220&quot; /&gt;&lt;/svg&gt;&#160;Cases&lt;br&gt; &lt;svg width=&quot;20&quot; height=&quot;4&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke-width=&quot;4&quot; stroke=&quot;#CE2A07&quot; /&gt;&lt;/svg&gt;&#160;Deaths&lt;br&gt; &lt;svg width=&quot;20&quot; height=&quot;10&quot;&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;20&quot; height=&quot;10&quot; fill=&quot;#E0E0E0&quot; stroke=&quot;none&quot; /&gt;&lt;/svg&gt;&#160;Lockdown (statewide)&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;A na&#239;ve hypothesis would be that Houstonians, faring better overall, would speak with more positive affect. Complicating this, of course, is the profusion of topics on which people might converse, including: China, Donald Trump, Anthony Fauci, the CDC and WHO, governors Andrew Cuomo&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; and Greg Abbott&lt;a href=&quot;#fn2&quot; class=&quot;footnote-ref&quot; id=&quot;fnref2&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;, cruise ships, quarantines, face masks, and the cancellations of events, not to mention the pathogen itself and its physiological effects. Our goal, therefore, was to isolate topics of conversation, and examine the sentiment surrounding particular public figures.&lt;/p&gt;
&lt;h1 id=&quot;data-collection&quot;&gt;Data collection&lt;/h1&gt;
&lt;p&gt;Our preferred data source was Twitter, which, with a third of a billion users, captures an enormous fraction of the public discourse. In addition, there is an up-to-date, curated &lt;a href=&quot;https://github.com/thepanacealab/covid19_twitter&quot;&gt;dataset&lt;/a&gt; of COVID-19 related tweets &lt;span class=&quot;citation&quot; data-cites=&quot;banda2020a&quot;&gt;[@banda2020a]&lt;/span&gt;. However, time and budget allowed few tweets to be captured&#8212;either on the order of 10&lt;sup&gt;3&lt;/sup&gt; total, or stretching back only seven days. In addition, the paucity of geotags&#8212;by &lt;a href=&quot;https://www.forbes.com/sites/kalevleetaru/2019/03/04/visualizing-seven-years-of-twitters-evolution-2012-2018/&quot;&gt;some estimates&lt;/a&gt;, on the order of 1%&#8212;would make filtering by city nearly impossible.&lt;/p&gt;
&lt;p&gt;Reddit turned out to be somewhat more hospitable, as &lt;a href=&quot;https://github.com/pushshift/api&quot;&gt;pushshift&lt;/a&gt; provides free access to the Reddit API, as well as a &lt;a href=&quot;http://files.pushshift.io/reddit/comments/&quot;&gt;full dataset&lt;/a&gt; of Reddit comments stretching back to the site&#8217;s founding &lt;span class=&quot;citation&quot; data-cites=&quot;baumgartner2020pushshift&quot;&gt;[@baumgartner2020pushshift]&lt;/span&gt;, although the latter source was not updated frequently enough for our purpose. Reddit users subscribe to interest communities called &#8220;subreddits&#8221;, prefixed with &#8220;/r/&#8221;, some of which are for cities and other locales. While it can&#8217;t be verified that a particular subscriber is a resident, we assume that a large proportion of them are. One downside of this structure is that subreddits can become &lt;a href=&quot;https://en.wikipedia.org/wiki/Echo_chamber_(media)&quot;&gt;echo chambers&lt;/a&gt; which do not represent the larger population.&lt;/p&gt;
&lt;!-- and gain (or lose) points for posting interesting, helpful, or funny comments in those communities. --&gt;
&lt;p&gt;Another difficulty is that although Reddit ranks in the &lt;a href=&quot;https://www.alexa.com/siteinfo/reddit.com&quot;&gt;top 20 websites&lt;/a&gt; by traffic, the volume of posts pales next to Twitter. Although each metropolitan subreddit records hundreds of thousands of subscribers, by the &lt;a href=&quot;https://en.wikipedia.org/wiki/1%25_rule_(Internet_culture)&quot;&gt;90&#8211;9&#8211;1 rule of thumb&lt;/a&gt;, we guessed that in a subreddit with on the order of 10&lt;sup&gt;5&lt;/sup&gt; subscribers, only about 10&lt;sup&gt;3&lt;/sup&gt; would be active commenters, as shown in &lt;span class=&quot;citation&quot; data-cites=&quot;tbl:commenters&quot;&gt;@tbl:commenters&lt;/span&gt;.&lt;/p&gt;
&lt;table&gt;
&lt;caption&gt;City and subreddit populations and commenter estimates {#tbl:commenters}&lt;/caption&gt;
&lt;thead&gt;
&lt;tr class=&quot;header&quot;&gt;
&lt;th&gt;Subreddit&lt;/th&gt;
&lt;th&gt;City pop.&lt;/th&gt;
&lt;th&gt;Subscribers&lt;/th&gt;
&lt;th&gt;Casual commenters&lt;/th&gt;
&lt;th&gt;Active commenters&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;/r/nyc&lt;/td&gt;
&lt;td&gt;8,300,000&lt;/td&gt;
&lt;td&gt;225,000&lt;/td&gt;
&lt;td&gt;&#8776;20,000&lt;/td&gt;
&lt;td&gt;&#8776;2,000&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;/r/houston&lt;/td&gt;
&lt;td&gt;2,300,000&lt;/td&gt;
&lt;td&gt;150,000&lt;/td&gt;
&lt;td&gt;&#8776;13,500&lt;/td&gt;
&lt;td&gt;&#8776;1,500&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;We focused on comments, since most of the substantive (read: sentiment-laden) discussion happens there; however, these are not guaranteed to contain topic-relevant keywords, so we searched for posts whose titles contained any of the keywords &#8220;COVID&#8221;, &#8220;coronavirus&#8221;, &#8220;quarantine&#8221;, or &#8220;pandemic&#8221;. Reddit &lt;a href=&quot;https://github.com/reddit-archive/reddit/blob/master/r2/r2/lib/utils/_utils.pyx#L39-L40&quot;&gt;generates&lt;/a&gt; a base 36 ID for each post and comment on the site, so we collated post IDs with comment IDs, as the simplified code snippet below illustrates.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; requests&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-2&quot; title=&quot;2&quot;&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; pandas &lt;span class=&quot;im&quot;&gt;as&lt;/span&gt; pd&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-3&quot; title=&quot;3&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-4&quot; title=&quot;4&quot;&gt;comments &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; []&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-5&quot; title=&quot;5&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-6&quot; title=&quot;6&quot;&gt;&lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; subreddit &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; [&lt;span class=&quot;st&quot;&gt;&amp;quot;nyc&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;houston&amp;quot;&lt;/span&gt;]:&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-7&quot; title=&quot;7&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-8&quot; title=&quot;8&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# Get posts with the most comments&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-9&quot; title=&quot;9&quot;&gt;    res &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; requests.get(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-10&quot; title=&quot;10&quot;&gt;        &lt;span class=&quot;st&quot;&gt;&amp;quot;https://api.pushshift.io/reddit/search/submission&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-11&quot; title=&quot;11&quot;&gt;        params &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; {&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-12&quot; title=&quot;12&quot;&gt;            &lt;span class=&quot;st&quot;&gt;&amp;quot;subreddit&amp;quot;&lt;/span&gt;: subreddit,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-13&quot; title=&quot;13&quot;&gt;            &lt;span class=&quot;st&quot;&gt;&amp;quot;size&amp;quot;&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;400&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-14&quot; title=&quot;14&quot;&gt;            &lt;span class=&quot;st&quot;&gt;&amp;quot;sort_type&amp;quot;&lt;/span&gt;: &lt;span class=&quot;st&quot;&gt;&amp;quot;num_comments&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-15&quot; title=&quot;15&quot;&gt;            &lt;span class=&quot;st&quot;&gt;&amp;quot;sort&amp;quot;&lt;/span&gt;: &lt;span class=&quot;st&quot;&gt;&amp;quot;desc&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-16&quot; title=&quot;16&quot;&gt;        })&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-17&quot; title=&quot;17&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-18&quot; title=&quot;18&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# Parse JSON&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-19&quot; title=&quot;19&quot;&gt;    posts &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; pd.DataFrame(res.json()[&lt;span class=&quot;st&quot;&gt;&amp;quot;data&amp;quot;&lt;/span&gt;])&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-20&quot; title=&quot;20&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-21&quot; title=&quot;21&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# Get comments from posts&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-22&quot; title=&quot;22&quot;&gt;    res &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; requests.get(&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-23&quot; title=&quot;23&quot;&gt;        &lt;span class=&quot;st&quot;&gt;&amp;quot;https://api.pushshift.io/reddit/search/comment&amp;quot;&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-24&quot; title=&quot;24&quot;&gt;        params &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; {&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-25&quot; title=&quot;25&quot;&gt;            &lt;span class=&quot;st&quot;&gt;&amp;quot;subreddit&amp;quot;&lt;/span&gt;: subreddit,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-26&quot; title=&quot;26&quot;&gt;            &lt;span class=&quot;st&quot;&gt;&amp;quot;link_id&amp;quot;&lt;/span&gt;: ([&lt;span class=&quot;st&quot;&gt;&amp;quot;t3_&amp;quot;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; n &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; n &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; posts[&lt;span class=&quot;st&quot;&gt;&amp;quot;id&amp;quot;&lt;/span&gt;]]),&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-27&quot; title=&quot;27&quot;&gt;            &lt;span class=&quot;st&quot;&gt;&amp;quot;size&amp;quot;&lt;/span&gt;: &lt;span class=&quot;dv&quot;&gt;1000&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-28&quot; title=&quot;28&quot;&gt;        })&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-29&quot; title=&quot;29&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-30&quot; title=&quot;30&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# Collect parsed output&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb1-31&quot; title=&quot;31&quot;&gt;    comments.append(pd.DataFrame(res.json()[&lt;span class=&quot;st&quot;&gt;&amp;quot;data&amp;quot;&lt;/span&gt;]))&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In toto, we collected 150,000 comments from /r/nyc, and 85,000 from /r/houston, and randomly sampled 85,000 New York comments for the analysis to avoid variance issues.&lt;/p&gt;
&lt;h1 id=&quot;sentiment-analysis&quot;&gt;Sentiment analysis&lt;/h1&gt;
&lt;p&gt;The sentiment analysis itself was done with the VADER sentiment parser &lt;span class=&quot;citation&quot; data-cites=&quot;vader&quot;&gt;[@vader]&lt;/span&gt;, a sophisticated rule-based parser that incorporates contextual information such as negations (&#8220;not&#8221;), intensifiers (&#8220;very&#8221;), hedges (&#8220;somewhat&#8221;), and even emoticons (&#8220;:)&#8221;).&lt;a href=&quot;#fn3&quot; class=&quot;footnote-ref&quot; id=&quot;fnref3&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt; For these reasons, it works best on unprocessed text:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; nltk.sentiment.vader &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; SentimentIntensityAnalyzer&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-2&quot; title=&quot;2&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-3&quot; title=&quot;3&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Instantiate sentiment analyzer &amp;amp; compute sentiments&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-4&quot; title=&quot;4&quot;&gt;analyzer &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; SentimentIntensityAnalyzer()&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-5&quot; title=&quot;5&quot;&gt;sentiments &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; pd.DataFrame(&lt;span class=&quot;bu&quot;&gt;map&lt;/span&gt;(analyzer.polarity_scores, comments[&lt;span class=&quot;st&quot;&gt;&amp;quot;text&amp;quot;&lt;/span&gt;]))&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-6&quot; title=&quot;6&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-7&quot; title=&quot;7&quot;&gt;&lt;span class=&quot;co&quot;&gt;# Append to original data frame&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb2-8&quot; title=&quot;8&quot;&gt;comments &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; comments.join(sentiments.set_index(comments.index))&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It provides a &#8220;sentiment intensity&#8221; score which is signed for polarity (positive good, negative bad). We took the 5-day rolling mean of the sentiments of all comments, filtering for various keywords.&lt;/p&gt;
&lt;!-- ![](Sentiment-Governors-5day.svg){#fig:gov} --&gt;
&lt;p&gt;Two important caveats apply, the first of which is that knowing &lt;em&gt;what&lt;/em&gt; the sentiment is doesn&#8217;t tell you &lt;em&gt;why&lt;/em&gt;. For example, in late April, /r/nyc responded negatively to the keyword &#8220;Fauci&#8221;, but this turned out to be displeasure not with Fauci himself, but rather with Trump, who had considered firing him. Thus, sentiment &lt;em&gt;around&lt;/em&gt; a public figure should not be conflated with sentiment &lt;em&gt;toward&lt;/em&gt; that figure. The second caveat is that positive and negative sentiments can cancel; so although a highly positive or negative overall sentiment score reflects unanimity in these feelings, a neutral score does not represent apathy, but simply lack of consensus.&lt;/p&gt;
&lt;p&gt;One way consensus is achieved on Reddit is by voting: users vote for (&#8220;upvote&#8221;) or against (&#8220;downvote&#8221;) comments, and the comment&#8217;s score is the number of votes for minus the number against. If voting is a way of agreeing with the sentiment of a comment, then it can be seen as tacitly expressing the same sentiment. We accounted for this by eliminating comments that scored less than one, and weighting the sentiment of the remainder by their scores:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-1&quot; title=&quot;1&quot;&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; numpy &lt;span class=&quot;im&quot;&gt;as&lt;/span&gt; np&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-2&quot; title=&quot;2&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-3&quot; title=&quot;3&quot;&gt;comments[&lt;span class=&quot;st&quot;&gt;&amp;quot;weighted&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; np.maximum(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;,&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-4&quot; title=&quot;4&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# Sentiment score&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-5&quot; title=&quot;5&quot;&gt;    comments[&lt;span class=&quot;st&quot;&gt;&amp;quot;compound&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-6&quot; title=&quot;6&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# Reddit score&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-7&quot; title=&quot;7&quot;&gt;    comments[&lt;span class=&quot;st&quot;&gt;&amp;quot;score&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-8&quot; title=&quot;8&quot;&gt;    &lt;span class=&quot;co&quot;&gt;# Scaling factor (for convenience; does not change analysis)&lt;/span&gt;&lt;/a&gt;
&lt;a class=&quot;sourceLine&quot; id=&quot;cb3-9&quot; title=&quot;9&quot;&gt;    &lt;span class=&quot;fl&quot;&gt;0.75&lt;/span&gt;)&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;One potential pitfall is that since the highest-scoring comments appear highest on the page, this can be subject to the &lt;a href=&quot;https://en.wikipedia.org/wiki/Bandwagon_effect&quot;&gt;bandwagon effect&lt;/a&gt;, by which users see, and then upvote, comments that are already popular.&lt;/p&gt;
&lt;p&gt;We graphed the weighted sentiments of COVID-related posts in 2020 (&lt;span class=&quot;citation&quot; data-cites=&quot;fig:2020&quot;&gt;@fig:2020&lt;/span&gt;), and formulated a baseline sentiment for comparison&#8212;maybe sentiment is more positive in haler times, or maybe New Yorkers really are &lt;a href=&quot;https://www.youtube.com/watch?v=lX4MoaTFp9g&quot;&gt;less positive&lt;/a&gt; in general&#8212;so we looked at comments from the same months in the previous year, without filtering by keyword (&lt;span class=&quot;citation&quot; data-cites=&quot;fig:2019&quot;&gt;@fig:2019&lt;/span&gt;).&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;Sentiment-Citywide-2020-5day.svg&quot; alt=&quot;COVID-related sentiment across cities, 2020 (5-day rolling mean)   &#160;New York  &#160;Houston &quot; id=&quot;fig:2020&quot; /&gt;&lt;figcaption&gt;COVID-related sentiment across cities, 2020 (5-day rolling mean)&lt;br&gt;&lt;br&gt; &lt;svg width=&quot;20&quot; height=&quot;4&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke-width=&quot;4&quot; stroke=&quot;#FF5500&quot; /&gt;&lt;/svg&gt;&#160;New York&lt;br&gt; &lt;svg width=&quot;20&quot; height=&quot;4&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke-width=&quot;4&quot; stroke=&quot;#0658CF&quot; /&gt;&lt;/svg&gt;&#160;Houston&lt;br&gt;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;The overall results were unilluminating; the only particularly positive or negative periods, in February 2020, are essentially artifacts due to insufficient data (the virus had not yet seized the nation&#8217;s attention).&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;Sentiment-Citywide-2019-5day.svg&quot; alt=&quot;General sentiment across cities, 2019 (5-day rolling mean)   &#160;New York  &#160;Houston &quot; id=&quot;fig:2019&quot; /&gt;&lt;figcaption&gt;General sentiment across cities, 2019 (5-day rolling mean)&lt;br&gt;&lt;br&gt; &lt;svg width=&quot;20&quot; height=&quot;4&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke-width=&quot;4&quot; stroke=&quot;#FF5500&quot; /&gt;&lt;/svg&gt;&#160;New York&lt;br&gt; &lt;svg width=&quot;20&quot; height=&quot;4&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke-width=&quot;4&quot; stroke=&quot;#0658CF&quot; /&gt;&lt;/svg&gt;&#160;Houston&lt;br&gt;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;A clearer picture arose around public figures. After filtering by the surname of each state&#8217;s governor, we see a positive spike in New York in the early days of shutdowns, whereas Houston takes a swift negative turn when Abbott declares lockdown, and swiftly becomes positive after he orders its end (&lt;span class=&quot;citation&quot; data-cites=&quot;fig:gov&quot;&gt;@fig:gov&lt;/span&gt;).&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;Sentiment-Governors-5day.svg&quot; alt=&quot;Sentiment around governors across cities, 2020 (5-day rolling mean)   &#160;New York (Keyword &#8220;Cuomo&#8221;)  &#160;Houston (Keyword &#8220;Abbott&#8221;) &quot; id=&quot;fig:gov&quot; /&gt;&lt;figcaption&gt;Sentiment around governors across cities, 2020 (5-day rolling mean)&lt;br&gt;&lt;br&gt; &lt;svg width=&quot;20&quot; height=&quot;4&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke-width=&quot;4&quot; stroke=&quot;#FF5500&quot; /&gt;&lt;/svg&gt;&#160;New York (Keyword &#8220;Cuomo&#8221;)&lt;br&gt; &lt;svg width=&quot;20&quot; height=&quot;4&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke-width=&quot;4&quot; stroke=&quot;#0658CF&quot; /&gt;&lt;/svg&gt;&#160;Houston (Keyword &#8220;Abbott&#8221;)&lt;br&gt;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;This seems to imply that New Yorkers, having been much harder hit, were more sanguine about curtailments of public life than the relatively freewheeling Texans.&lt;/p&gt;
&lt;p&gt;A similarly revealing pattern is shown in response to the keyword &#8220;Trump&#8221; (&lt;span class=&quot;citation&quot; data-cites=&quot;fig:trump&quot;&gt;@fig:trump&lt;/span&gt;). While comments about the president tended negative overall, they dipped steeply in late April, possibly in response to his defunding the WHO.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;Sentiment-Trump-5day.svg&quot; alt=&quot;Sentiment around President Trump across cities, 2020 (5-day rolling mean)   &#160;New York (Keyword &#8220;Trump&#8221;)  &#160;Houston (Keyword &#8220;Trump&#8221;) &quot; id=&quot;fig:trump&quot; /&gt;&lt;figcaption&gt;Sentiment around President Trump across cities, 2020 (5-day rolling mean)&lt;br&gt;&lt;br&gt; &lt;svg width=&quot;20&quot; height=&quot;4&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke-width=&quot;4&quot; stroke=&quot;#FF5500&quot; /&gt;&lt;/svg&gt;&#160;New York (Keyword &#8220;Trump&#8221;)&lt;br&gt; &lt;svg width=&quot;20&quot; height=&quot;4&quot;&gt;&lt;line x1=&quot;0&quot; y1=&quot;0&quot; x2=&quot;20&quot; y2=&quot;0&quot; stroke-width=&quot;4&quot; stroke=&quot;#0658CF&quot; /&gt;&lt;/svg&gt;&#160;Houston (Keyword &#8220;Trump&#8221;)&lt;br&gt;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;h1 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h1&gt;
&lt;p&gt;We have shown that public attitudes as expressed on social media can be tied to world events, and analyzed attitudes toward events during the COVID-19 crisis. This analysis could be expanded with, e.g., a more sophisticated weighting scheme, more precise filtering, or a larger dataset.&lt;/p&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot;&gt;&lt;p&gt;Dem., NY, in office since 2011&lt;a href=&quot;#fnref1&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot;&gt;&lt;p&gt;Rep., TX, in office since 2015&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn3&quot;&gt;&lt;p&gt;Some sample inputs and scores are shown below:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&quot;header&quot;&gt;
&lt;th&gt;Text&lt;/th&gt;
&lt;th&gt;Score&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;great!&lt;/td&gt;
&lt;td&gt;+0.6588&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;great&lt;/td&gt;
&lt;td&gt;+0.6249&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;very good&lt;/td&gt;
&lt;td&gt;+0.4927&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;good&lt;/td&gt;
&lt;td&gt;+0.4404&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;not bad&lt;/td&gt;
&lt;td&gt;+0.4310&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;somewhat good&lt;/td&gt;
&lt;td&gt;+0.3832&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;okay&lt;/td&gt;
&lt;td&gt;+0.2263&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;meh&lt;/td&gt;
&lt;td&gt;&#8722;0.0772&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;not good&lt;/td&gt;
&lt;td&gt;&#8722;0.3412&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;bad&lt;/td&gt;
&lt;td&gt;&#8722;0.5423&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;a href=&quot;#fnref3&quot; class=&quot;footnote-back&quot;&gt;&#8617;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
	</description>
		</item>
		<item>
			<title>Foreword</title>
			<link>https://alexklapheke.github.io/blog/publish/foreword.md</link>
			<pubDate>Mon, 22 Jun 2020 06:10:59 -0400</pubDate>
	<description>
&lt;div class=&quot;epigraph&quot;&gt;
&lt;p&gt;I should not talk so much about myself if there were anybody else whom I knew as well.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;As a preface to this blog, let me introduce myself: I&#8217;m a linguist turned data scientist living in the Boston area. While a lot of my work deals with natural language, I&#8217;m interested in the gamut of data and what knowledge can be gleaned from it. &lt;!-- Typifying this is the current COVID-19 crisis---Massachusetts is now in the thirteenth week of a state of emergency---during which uncertainty, epidemiological data (&quot;[The Curve](https://en.wikipedia.org/wiki/Epidemic_curve)&quot;) has been exalted almost to a kind of augury. --&gt; I won&#8217;t comment much on pop data science or world events, but I hope that through reasoned analysis I can provide clarity about what data I can get hold of.&lt;/p&gt;
&lt;p&gt;I entered data science after leaving academia, but the transition wasn&#8217;t abrupt. I&#8217;d learned to code some years prior, and ran experiments as a graduate student, punctiliously collecting small data sets, modeling them in R, and encapsulating the results in manuscripts and slides. The tools I use have changed (Python largely displacing R), and the data sets are some orders of magnitude larger, but my work in graduate school laid the flagstones for a data science career.&lt;/p&gt;
&lt;p&gt;This blog will mainly comprise overviews of the data projects I&#8217;m working on, essays on how I approach data, particularly language data, and posts about how I use various tools&#8212;not just programming languages and text editors, but also models and theorems. I hope not only to showcase what insights can be loosed from a dataset (and what illusory insights come of unsound analyses), but also serve as an aid and reference to other data scientists&#8212;not least among whom, my future self. A full portfolio of my work can be found on &lt;a href=&quot;https://alexklaphe.github.io/&quot;&gt;my homepage&lt;/a&gt;.&lt;/p&gt;
&lt;!-- The good news now is that, as the graph below shows, the curve seems to have peaked,[^rcode] and while it would be remiss to hazard that we&apos;re in the clear, or comment on the efficacy of this or that public health policy, I will say that I look forward to writing about my data investigations, and 

![New COVID-19 cases in Massachusetts (14-day moving average)](covid-mass.svg)\

[^rcode]: The full R code to generate this graph is below:

    ```r
    library(tidyverse)
    svg(&quot;covid-mass.svg&quot;, width = 5, height = 5)

    us_state &lt;- &quot;Massachusetts&quot;
    days &lt;- 14

    read.csv(&quot;https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv&quot;) %&gt;%
    filter(state == us_state) %&gt;%
    mutate(date = as.POSIXct(date, format = &quot;%F&quot;)) %&gt;%
    mutate(newcases = cases - c(0, head(cases, -1))) %&gt;%
    mutate(newcases_moving = stats::filter(newcases, rep(1 / days, days))) %&gt;%
    ggplot(aes(x = date, y = newcases_moving)) +
    geom_point() +
    theme_classic() +
    theme(
            text = element_text(family = &quot;Linux Libertine O&quot;),
            axis.line = element_blank(),
            panel.grid.major.y = element_line(colour = &quot;gray90&quot;)
        ) +
    labs(
            title = paste0(&quot;New cases in &quot;, us_state, &quot; (&quot;, days, &quot;-day moving average)&quot;),
            subtitle = bquote(paste(&quot;Data courtesy of the &quot;, italic(&quot;New York Times&quot;),
                                    &quot;. Updated &quot;, .(format(Sys.time(), &quot;%b %-d, %Y&quot;)))),
            x = &quot;Date&quot;,
            y = &quot;New cases&quot;
        )
    ```
--&gt;
	</description>
		</item>
	</channel>
</rss>
