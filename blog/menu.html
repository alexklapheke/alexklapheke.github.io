<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta charset="UTF-8">
		<meta name="generator" content="pandoc" />
		<meta name="author" content="Alexander Klapheke">
		<meta name="robots" content="index,follow">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="last-modified" content="">

		<link rel="canonical" href="https://alexklapheke.github.io/blog/menu.html">
		<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
		<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
		</style>
		<link rel="stylesheet" href="../include/style.css" />
		<link rel="stylesheet" href="../include/blog.css" />
		<!--[if lt IE 9]>
			<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
		<![endif]-->
		<script src="../include/sidenotes.js" charset="utf-8"></script>
		<script src="../include/sorttable.js" charset="utf-8"></script>

		<title>Menu categorization</title>
	</head>
	<body>
		<header>
			<!-- http://microformats.org/wiki/hcard -->
			<div class="author vcard">
			<h1>
				<a href="https://alexklapheke.github.io">
				<span class="given-name">Alexander</span>
				<span class="family-name"><abbr class="ipa" lang="x-ipa" title="[kl&#601;&#39;pik]">Klapheke</abbr></span>
				</a>
			</h1>

				<div id="contact">
					<!-- http://hcard.geekhood.net/encode/ -->
					<a
					class='email
					href="mailto:x@y"
					'
					href
					=	'
					&#x20;&#x6d;&#x61;&#x69;&#x6c;&#x74;&#x6f;&#58;%20&#x61;&#x6c;&#x25;6&#x35;%7&#x38;&#x25;&#54;&#98;la&#x25;7&#x30;h&#37;6&#x35;&#x25;&#x36;&#x62;&#37;&#x36;&#x35;&#37;&#x34;0&#x67;&#109;&#97;%&#x36;9l&#x25;&#50;&#101;%&#x36;&#51;&#111;&#x6d;&#x3f;
					'>&#97;&#x6c;&#x65;&#120;&#x6B;lap&#x68;&#x65;k<!--
					mailto:abuse@hotmail.com
					</a>
					-->&shy;&#x65;&#64;&#103;&#109;&#x61;i&#108;&#x2E;&#99;&#x6f;&#109;</a>
					<br>
					<a href="../0xBCB7A837.asc">Public key</a> <span class="grayed">(<abbr title="F1BD E18B 7525 95A9 7BC4 FB04 A349 9FF5 2DF0 94AB">fingerprint</abbr>)</span>

					<br><br>

					<a class="social" href="https://github.com/alexklapheke">GitHub</a> <span class="bullet">&bull;</span>
					<a class="social" href="https://linkedin.com/in/alexander-klapheke">LinkedIn</a> <span class="bullet">&bull;</span>
					<a class="social" href="../AlexanderKlapheke-Resume.pdf">R&eacute;sum&eacute;</a>
				</div>
			</div>

			<p id="blurb">I&rsquo;m a data scientist and self-taught coder (Python, R, Haskell) with a background in linguistics and math and over 10 years&rsquo; experience explaining technical concepts to laypeople.</p>

		</header>
		<article class="hentry">
		<div id="titleblock">
		<h1 class="entry-title">Menu categorization</h1>
		<p>
			<time datetime="2020-07-03T18:11:59-0400" class="published">Friday, July 3, 2020</time>
			<span class="bullet">&bull;</span>
			<span class="wordcount">2,478 words</span>
			<span class="bullet">&bull;</span>
			<span class="license"><abbr title="Licensed under Creative Commons Attribution 4.0"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC-BY</a></abbr></span>
			<span class="bullet">&bull;</span>
			<span class="addenda">&#128206;&nbsp;<a href="https://github.com/alexklapheke/menu">code</a></span>
			<span class="bullet">&bull;</span>
			<a class="source" href="https://raw.githubusercontent.com/alexklapheke/alexklapheke.github.io/master/blog/menu.md">View source</a>
		</p>
		</div>
		<nav id="TOC">
<ul>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li><a href="#data-structuring"><span class="toc-section-number">2</span> Data structuring</a></li>
<li><a href="#data-cleaning"><span class="toc-section-number">3</span> Data cleaning</a><ul>
<li><a href="#dates"><span class="toc-section-number">3.1</span> Dates</a></li>
<li><a href="#menus"><span class="toc-section-number">3.2</span> Menus</a></li>
<li><a href="#dishes"><span class="toc-section-number">3.3</span> Dishes</a></li>
</ul></li>
<li><a href="#data-exploration"><span class="toc-section-number">4</span> Data exploration</a><ul>
<li><a href="#cross-sectional"><span class="toc-section-number">4.1</span> Cross-sectional</a></li>
<li><a href="#longitudinal"><span class="toc-section-number">4.2</span> Longitudinal</a></li>
</ul></li>
<li><a href="#modeling"><span class="toc-section-number">5</span> Modeling</a></li>
</ul>
		</nav>
			<div class="entry-content">
<div class="epigraph">
<p>The History of every major Galactic Civilization tends to pass through three distinct and recognizable phases, those of Survival, Inquiry and Sophistication, otherwise known as the How, Why and Where phases.</p>
<p>For instance, the first phase is characterized by the question &#8220;How can we eat?&#8221;, the second by the question &#8220;Why do we eat?&#8221; and the third by the question, &#8220;Where shall we have lunch?&#8221;</p>
</div>
<section id="introduction" class="level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>Since 2011, the New York Public Library has maintained <a href="http://menus.nypl.org/">&#8220;What&#8217;s on the menu?&#8221;</a>, a collection of tens of thousands of restaurant menus going back to the mid-nineteenth century. This is an invaluable collection not just for data scientists, but for food historians, since it is well known that foods go in and out of fashion like clothing. For example, the famed <a href="https://en.wikipedia.org/wiki/Grand_Central_Oyster_Bar_%26_Restaurant">Oyster Bar</a> at Grand Central Terminal, which in 1941 <a href="https://commons.wikimedia.org/wiki/File:Grand_Central_Terminal_Restaurant_menu_1941.jpg">featured</a> &#8220;cream of chicken &#224; la reine&#8221;, &#8220;broiled sweetbreads on toast with Virginia ham&#8221;, and &#8220;farina custard pudding, Melba sauce&#8221; (not to mention oysters for a nickel apiece), today <a href="https://web.archive.org/web/20160315171449/http://www.oysterbarny.com/pdf/dailymenu.pdf">serves</a> such mouthfuls as &#8220;poached farmed Norwegian salmon over baby red oak-watercress salad with charred scallion-honey vinaigrette, avocado, and goat cheese.&#8221;</p>
<p>These vicissitudes are due partly to economics. In 1914, avocados, then known as &#8220;alligator pears&#8221;, <a href="https://time.com/4832655/avocado-american-history/">could go for</a> $1 each&#8212;more that $25 today. But economics can be adulterated by public perception. David Foster Wallace, considering the lobster, wrote that:<span class="citation" data-cites="wallace2004consider"><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></span></p>
<blockquote>
<p>Up until sometime in the 1800s, though, lobster was literally low-class food, eaten only by the poor and institutionalized. Even in the harsh penal environment of early America, some colonies had laws against feeding lobsters to inmates more than once a week because it was thought to be cruel and unusual, like making people eat rats. One reason for their low status was how plentiful lobsters were in old New England. &#8220;Unbelievable abundance&#8221; is how one source describes the situation, including accounts of Plymouth pilgrims wading out and capturing all they wanted by hand, and of early Boston&#8217;s seashore being littered with lobsters after hard storms&#8212;these latter were treated as a smelly nuisance and ground up for fertilizer. There is also the fact that premodern lobster was often cooked dead and then preserved, usually packed in salt or crude hermetic containers. Maine&#8217;s earliest lobster industry was based around a dozen such seaside canneries in the 1840s, from which lobster was shipped as far away as California, in demand only because it was cheap and high in protein, basically chewable fuel.</p>
</blockquote>
<p>By 1941, of course, the Oyster Bar&#8217;s menu lists &#8220;alligator pear salad&#8221; for 45&#162; and &#8220;lobster pan roast&#8221;&#8212;one of the priciest items named&#8212;for $1.45.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> In this project I wanted to see if, using this data,<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> I could predict the year a menu was served based on the dishes listed.</p>
</section>
<section id="data-structuring" class="level1">
<h1><span class="header-section-number">2</span> Data structuring</h1>
<p>The NYPL provides the data in the very simple <a href="https://en.wikipedia.org/wiki/Snowflake_schema">snowflake schema</a> shown in fig.&#160;1. The central table is <code>MenuItem.csv</code>, in which each of the 1,334,417 rows represents an item on a menu. Each references a particular dish, which are named in <code>Dish.csv</code> (426,959 comestibles in total), and each is also referenced to a page in <code>MenuPage.csv</code>, which are in turn referenced in <code>Menu.csv</code> to the particular bills of fare on which they appear.</p>
<figure>
<object data="images/e21ef90bc35863a4987861c018579662522e923c.svg" alt="Figure 1: Menu dataset table schema (some columns omitted). Source code" id="fig:schema" ><img src="images/e21ef90bc35863a4987861c018579662522e923c.svg" alt="Figure 1: Menu dataset table schema (some columns omitted). Source code" id="fig:schema" /></object><figcaption>Figure 1: Menu dataset table schema (some columns omitted). <a href="https://gist.github.com/alexklapheke/a197eed2a9ba742aa0080c1bdbfa579c">Source code</a></figcaption>
</figure>
<p>Since all I wanted was the name of the dish (from <code>Dish.csv</code>), the date (from <code>Menu.csv</code>), and the menu ID (in case I wanted to group dishes by menu), I merged the data frames like so:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># Add menu id to each menu item</span></a>
<a class="sourceLine" id="cb1-2" title="2">df <span class="op">=</span> pd.merge(</a>
<a class="sourceLine" id="cb1-3" title="3">    left <span class="op">=</span> menu_item[[<span class="st">&quot;dish_id&quot;</span>, <span class="st">&quot;menu_page_id&quot;</span>]],</a>
<a class="sourceLine" id="cb1-4" title="4">    right <span class="op">=</span> menu_page[[<span class="st">&quot;id&quot;</span>, <span class="st">&quot;menu_id&quot;</span>]],</a>
<a class="sourceLine" id="cb1-5" title="5">    how <span class="op">=</span> <span class="st">&quot;right&quot;</span>,</a>
<a class="sourceLine" id="cb1-6" title="6">    left_on <span class="op">=</span> <span class="st">&quot;menu_page_id&quot;</span>,</a>
<a class="sourceLine" id="cb1-7" title="7">    right_on <span class="op">=</span> <span class="st">&quot;id&quot;</span></a>
<a class="sourceLine" id="cb1-8" title="8">)</a>
<a class="sourceLine" id="cb1-9" title="9"></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co"># Add menu date to each menu id</span></a>
<a class="sourceLine" id="cb1-11" title="11">df <span class="op">=</span> pd.merge(</a>
<a class="sourceLine" id="cb1-12" title="12">    left <span class="op">=</span> df,</a>
<a class="sourceLine" id="cb1-13" title="13">    right <span class="op">=</span> menu[[<span class="st">&quot;id&quot;</span>, <span class="st">&quot;date&quot;</span>]],</a>
<a class="sourceLine" id="cb1-14" title="14">    how <span class="op">=</span> <span class="st">&quot;right&quot;</span>,</a>
<a class="sourceLine" id="cb1-15" title="15">    left_on <span class="op">=</span> <span class="st">&quot;menu_id&quot;</span>,</a>
<a class="sourceLine" id="cb1-16" title="16">    right_on <span class="op">=</span> <span class="st">&quot;id&quot;</span></a>
<a class="sourceLine" id="cb1-17" title="17">)</a>
<a class="sourceLine" id="cb1-18" title="18"></a>
<a class="sourceLine" id="cb1-19" title="19"><span class="co"># Add dish name to each menu item</span></a>
<a class="sourceLine" id="cb1-20" title="20">df <span class="op">=</span> pd.merge(</a>
<a class="sourceLine" id="cb1-21" title="21">    left <span class="op">=</span> df,</a>
<a class="sourceLine" id="cb1-22" title="22">    right <span class="op">=</span> dish[[<span class="st">&quot;id&quot;</span>, <span class="st">&quot;name&quot;</span>]],</a>
<a class="sourceLine" id="cb1-23" title="23">    how <span class="op">=</span> <span class="st">&quot;right&quot;</span>,</a>
<a class="sourceLine" id="cb1-24" title="24">    left_on <span class="op">=</span> <span class="st">&quot;dish_id&quot;</span>,</a>
<a class="sourceLine" id="cb1-25" title="25">    right_on <span class="op">=</span> <span class="st">&quot;id&quot;</span></a>
<a class="sourceLine" id="cb1-26" title="26">)</a>
<a class="sourceLine" id="cb1-27" title="27"></a>
<a class="sourceLine" id="cb1-28" title="28"><span class="co"># Remove intermediate columns</span></a>
<a class="sourceLine" id="cb1-29" title="29">df <span class="op">=</span> df[[<span class="st">&quot;name&quot;</span>, <span class="st">&quot;date&quot;</span>, <span class="st">&quot;menu_id&quot;</span>]]</a></code></pre></div>
<p>This left me with a single data frame of menu items to clean and parse.</p>
</section>
<section id="data-cleaning" class="level1">
<h1><span class="header-section-number">3</span> Data cleaning</h1>
<section id="dates" class="level2">
<h2><span class="header-section-number">3.1</span> Dates</h2>
<p>The first work to be done was on the dates. For example, 638 dates turned out to be incorrect or malformed. In some, like <code>1091-01-27</code>, the error was transparent, but with less than 0.05% of the data so corrupted, I decided to just drop them. However, another 68,438 items&#8212;5% of the data&#8212;were missing dates altogether. Since they were useless to the analysis, and I couldn&#8217;t know if there was a pattern to the missingness, I was forced to drop these as well. Then, from the 1.27 million well-formed dates remaining, I extracted the year and decade, the latter of which would prove a more reasonable target for modeling than the former.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># Drop malformed dates</span></a>
<a class="sourceLine" id="cb2-2" title="2">df[<span class="st">&quot;date&quot;</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">&quot;date&quot;</span>], errors<span class="op">=</span><span class="st">&quot;coerce&quot;</span>)</a>
<a class="sourceLine" id="cb2-3" title="3">df.dropna(inplace<span class="op">=</span><span class="va">True</span>)</a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co"># Calculate year and decade</span></a>
<a class="sourceLine" id="cb2-6" title="6">df[<span class="st">&quot;year&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;date&quot;</span>].dt.year</a>
<a class="sourceLine" id="cb2-7" title="7">df[<span class="st">&quot;decade&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;year&quot;</span>] <span class="op">//</span> <span class="dv">10</span> <span class="op">*</span> <span class="dv">10</span></a></code></pre></div>
<p>A further problem is that our dataset&#8217;s classes are heavily unbalanced. Looking at fig.&#160;2, we see that the great preponderance of them&#8212;a full 63% of menus and 62% of items&#8212;are from the initial two decades of the twentieth century.</p>
<figure>
<object data="images/1dd20f58075aee57f212300ff5e6b2ffe63a6034.svg" alt="Figure 2: Number of menus (left) and menu items (right) by decade" id="fig:decade" ><img src="images/1dd20f58075aee57f212300ff5e6b2ffe63a6034.svg" alt="Figure 2: Number of menus (left) and menu items (right) by decade" id="fig:decade" /></object><figcaption>Figure 2: Number of menus (left) and menu items (right) by decade</figcaption>
</figure>
<p>This could cause problems during modeling, not only because a na&#239;ve model could latch onto the majority class and return it without considering the inputs, but because the meagerness of data&#8212;particularly before 1880 and after 1990&#8212;will leave the model with inadequate information to categorize <em>any</em> menu as being from these eras.</p>
</section>
<section id="menus" class="level2">
<h2><span class="header-section-number">3.2</span> Menus</h2>
<p>Looking at the number of items featured on each menu, we see that although 22.7% of them feature fewer than a hundred items, several reach into the thousands, with one startling outlier:</p>
<figure>
<object data="images/ac4a666eef8d26a4926f0acf2cf8ff6de67feb93.svg" alt="Figure 3: Number of items on menus (log10 scale)" id="fig:items" ><img src="images/ac4a666eef8d26a4926f0acf2cf8ff6de67feb93.svg" alt="Figure 3: Number of items on menus (log10 scale)" id="fig:items" /></object><figcaption>Figure 3: Number of items on menus (log<sub>10</sub> scale)</figcaption>
</figure>
<p>That last menu, a <a href="http://menus.nypl.org/menus/31054">1933 Plaza Hotel menu</a>, is actually 62 menus bound together, totalling 4,060 dishes. However, even the runner-up, a <a href="http://menus.nypl.org/menus/34201">1914 Waldorf Astoria menu</a>, packs 1,360 dishes into ten octavo-sized pages. (For reference, the famously voluminous Cheesecake Factory menu has <a href="https://www.mentalfloss.com/article/566482/why-the-cheesecake-factorys-menu-is-so-big">&#8220;only&#8221;</a> 250 items.) This shouldn&#8217;t matter to the model, of course, since it will be trained only on individual dish names.</p>
</section>
<section id="dishes" class="level2">
<h2><span class="header-section-number">3.3</span> Dishes</h2>
<p>The dish names themselves were somewhat less tractable. The menus are transcribed by hand, eliminating the need to deal with OCR errors, but many items were unreasonably long.</p>
<figure>
<object data="images/a47dd4bf94ca107a2ea087828d7ec1885d4141b9.svg" alt="Figure 4: Character length of menu items (log10 scale)" id="fig:length" ><img src="images/a47dd4bf94ca107a2ea087828d7ec1885d4141b9.svg" alt="Figure 4: Character length of menu items (log10 scale)" id="fig:length" /></object><figcaption>Figure 4: Character length of menu items (log<sub>10</sub> scale)</figcaption>
</figure>
<p>As the histogram in fig.&#160;4 shows, these go well beyond gusty descriptions like our &#8220;poached farmed Norwegian salmon&#8221;&#8212;the longest, from first class on a <a href="http://menus.nypl.org/menus/29358">1993 Virgin Atlantic flight</a>, reads with the paragraph breaks removed like a deranged Basil Fawlty:</p>
<blockquote>
<p>Afternoon Tea- A Great British Tradition- Tea, the most universally consumed of all drinks, is especially popular in Britain where the annual consumption is something in the region of 512 million cups. W. E. Gladstone observed &#8220;If you are cold, tea will warm you- if you are heated, it will cool you- if you are depressed, it will cheer you- if you are excited, it will calm you.&#8221; First brought to England c. 1559 by Giambattista Rusmusio, tea did not evolve into an afternoon meal until the end of the 18th century. Anna, Duchess of Bedford, invented afternoon tea to fill the long gap between early lunch and dinner which bored many house parties. It became a meal surrounded by etiquette and customs, delicate china, silver, cake stands and doilies- a time when friend and family meet. Famous tea parties include Mad Hatter&#8217;s (Alice&#8217;s Adventures in Wonderland by Lewis Carroll 1865), the Boston Tea Party, 1773, and not forgetting HM Queen Elizabeth II&#8217;s annual garden parties at Buckingham Palace. The Duke of Wellington declared that &#8220;Tea cleared my head and left no misapprehensions.&#8221; He was right- tea contains small amounts of two B vitamins, and has no calories, artificial flavourings or colourings. It is said to cure gout, apoplexy, epilepsy, gall stones and sleepiness, and one&#8217;s longevity is assured. &#8220;Thank God for Tea! What would the world do without tea?&#8221;- Sydney Smith</p>
</blockquote>
<p>Like the erroneous dates, these were sparse&#8212;only 6,682, or 0.5% of the listed dishes exceeded 100 characters, and these held only 3.7% of the dataset&#8217;s total characters. However, the decision to drop them was less clear-cut, since they potentially contained period-specific text which could be used to inform a model. I ultimately stetted them for this reason.</p>
<p>I then processed the text.  251 menu items contained non-ASCII characters, of which 126 were in French,<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> 56 Chinese, 21 German, 20 Swedish, 11 Greek, 10 Hindi, 3 Hungarian, and one lonely item in Polish. The remaining three were English with special characters such as &#189;. Happily, the excellent Python library <a href="https://pypi.org/project/Unidecode/">Unidecode</a> can do most of the heavy lifting here, stripping accents, and Romanizing the Greek, Hindi, and Chinese.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" title="1"><span class="im">from</span> unidecode <span class="im">import</span> unidecode</a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co"># Remove special characters</span></a>
<a class="sourceLine" id="cb3-4" title="4">df[<span class="st">&quot;name&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;name&quot;</span>].<span class="bu">apply</span>(unidecode)</a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co"># Check for remaining non-ASCII characters</span></a>
<a class="sourceLine" id="cb3-7" title="7">df[df[<span class="st">&quot;name&quot;</span>].<span class="bu">str</span>.match(<span class="st">&quot;[^</span><span class="ch">\x00</span><span class="st">-</span><span class="ch">\x7F</span><span class="st">]&quot;</span>)][<span class="st">&quot;name&quot;</span>]</a></code></pre></div>
<p>It then remained only to normalize to lower case and tokenize on the regular expression <code>[a-z'-]+</code>, which captures strings of letters, apostrophes, and hyphens and throws out other punctuation and numbers (since this destroys ordering information, I put it into a new column called <code>tokens</code>).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" title="1"><span class="im">from</span> nltk.tokenize <span class="im">import</span> RegexpTokenizer</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="im">from</span> nltk.corpus <span class="im">import</span> stopwords</a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4">tokenizer <span class="op">=</span> RegexpTokenizer(<span class="st">&quot;[a-z&#39;-]+&quot;</span>)</a>
<a class="sourceLine" id="cb4-5" title="5">stopwords <span class="op">=</span> <span class="bu">set</span>(stopwords.words(<span class="st">&quot;english&quot;</span>))</a>
<a class="sourceLine" id="cb4-6" title="6"></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="kw">def</span> tokenize(text):</a>
<a class="sourceLine" id="cb4-8" title="8">    tokens <span class="op">=</span> <span class="bu">set</span>(tokenizer.tokenize(text))</a>
<a class="sourceLine" id="cb4-9" title="9">    <span class="cf">return</span> <span class="st">&quot; &quot;</span>.join(tokens <span class="op">-</span> stopwords)</a>
<a class="sourceLine" id="cb4-10" title="10"></a>
<a class="sourceLine" id="cb4-11" title="11">df[<span class="st">&quot;name&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;name&quot;</span>].<span class="bu">str</span>.lower()</a>
<a class="sourceLine" id="cb4-12" title="12">df[<span class="st">&quot;tokens&quot;</span>] <span class="op">=</span> df[<span class="st">&quot;name&quot;</span>].<span class="bu">apply</span>(tokenize)</a></code></pre></div>
<p>I also threw out <a href="https://en.wikipedia.org/wiki/Stop_words">stopwords</a> such as &#8220;the&#8221;. The text was now ready for exploring trends and building a predictive model.</p>
</section>
</section>
<section id="data-exploration" class="level1">
<h1><span class="header-section-number">4</span> Data exploration</h1>
<section id="cross-sectional" class="level2">
<h2><span class="header-section-number">4.1</span> Cross-sectional</h2>
<p>I first examined the top words from each decade, excerpted in fig.&#160;5&#8211;fig.&#160;8.</p>
<figure>
<object data="images/3a04acfdc390f9309b3cf78806d685e9b02434ea.svg" alt="Figure 5: Most common words on menus from the 1850s" id="fig:1850" ><img src="images/3a04acfdc390f9309b3cf78806d685e9b02434ea.svg" alt="Figure 5: Most common words on menus from the 1850s" id="fig:1850" /></object><figcaption>Figure 5: Most common words on menus from the 1850s</figcaption>
</figure>
<p>There are only a few menus from the 1850s in the collection, but we can get a sense of the palate. Names of wines&#8212;<em>madeira</em>, <em>sherry</em>, and <em>claret</em>, and probably also <em>ch&#226;teau</em> and <em>pale</em>&#8212;feature prominently, and the most common cooking methods are boiling and roasting.</p>
<figure>
<object data="images/122b6b74e110c1dc2b7425adaed5d377da8df865.svg" alt="Figure 6: Most common words on menus from the 1910s" id="fig:1910" ><img src="images/122b6b74e110c1dc2b7425adaed5d377da8df865.svg" alt="Figure 6: Most common words on menus from the 1910s" id="fig:1910" /></object><figcaption>Figure 6: Most common words on menus from the 1910s</figcaption>
</figure>
<p>By the 1910s, we have a new picture: fried foods are popular, as are cream sauces. Chicken and beef have made the list, as, notably, does salad, as fresh fruits and vegetables become more available to the average patron.</p>
<figure>
<object data="images/0da635cbd4d4a354db51f4e5ab3017b5fa4a120d.svg" alt="Figure 7: Most common words on menus from the 1950s" id="fig:1950" ><img src="images/0da635cbd4d4a354db51f4e5ab3017b5fa4a120d.svg" alt="Figure 7: Most common words on menus from the 1950s" id="fig:1950" /></object><figcaption>Figure 7: Most common words on menus from the 1950s</figcaption>
</figure>
<p>We see fewer changes in the post-war era, but &#8220;fresh&#8221; has been advanced, as have French <em>de</em> &#8216;of&#8217; and German <em>mit</em> &#8216;with&#8217;, indicating European dishes, or at least European phrasings, coming into vogue.</p>
<figure>
<object data="images/723984e59c0e4e8141e3374f230a6946b946f0a6.svg" alt="Figure 8: Most common words on menus from the 1990s" id="fig:1990" ><img src="images/723984e59c0e4e8141e3374f230a6946b946f0a6.svg" alt="Figure 8: Most common words on menus from the 1990s" id="fig:1990" /></object><figcaption>Figure 8: Most common words on menus from the 1990s</figcaption>
</figure>
<p>In the 1990s, &#8220;fried&#8221; has been replaced by &#8220;grilled&#8221;, and a renewed interest in French cuisine seems to be the <em>dernier cri</em>, as five of the ten are French grammatical words not filtered by the English stopword list (and <em>de</em> outpacing the next-highest word by almost 2 to 1).</p>
</section>
<section id="longitudinal" class="level2">
<h2><span class="header-section-number">4.2</span> Longitudinal</h2>
<p>Equally illuminating is to look at the waxing and waning of particular foods across time, in the style of <a href="https://books.google.com/ngrams">Google Ngrams</a>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" title="1">words <span class="op">=</span> [<span class="st">&quot;lobster&quot;</span>, <span class="st">&quot;oyster&quot;</span>]</a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3">occurrences <span class="op">=</span> {word: df[<span class="st">&quot;tokens&quot;</span>].<span class="bu">str</span>.contains(<span class="ss">f&quot;</span><span class="ch">\\</span><span class="ss">b</span><span class="sc">{</span>word<span class="sc">}</span><span class="ch">\\</span><span class="ss">b&quot;</span>) <span class="cf">for</span> word <span class="kw">in</span> words}</a>
<a class="sourceLine" id="cb5-4" title="4">menu_item_prop <span class="op">=</span> pd.DataFrame(occurrences).join([df[<span class="st">&quot;year&quot;</span>]).groupby(<span class="st">&quot;year&quot;</span>).mean()</a></code></pre></div>
<p>The Madeira that was so popular in the 1850s dropped off steeply soon after (fig.&#160;9).</p>
<figure>
<object data="images/55176d110106bf97c9df11bc5d37b3dec891fa5b.svg" alt="Figure 9: Percent of menu items per year containing the word &#8220;Madeira&#8221;" id="fig:madeira" ><img src="images/55176d110106bf97c9df11bc5d37b3dec891fa5b.svg" alt="Figure 9: Percent of menu items per year containing the word &#8220;Madeira&#8221;" id="fig:madeira" /></object><figcaption>Figure 9: Percent of menu items per year containing the word &#8220;Madeira&#8221;</figcaption>
</figure>
<p>We see the Sun rise and set on the age of Jell-O in fig.&#160;10, and in fig.&#160;11 the nascence of tofu.</p>
<figure>
<object data="images/d7650987a52a9968e759d9e982fa315a003a784c.svg" alt="Figure 10: Percent of menu items per year containing the word &#8220;Jell-O&#8221;" id="fig:jello" ><img src="images/d7650987a52a9968e759d9e982fa315a003a784c.svg" alt="Figure 10: Percent of menu items per year containing the word &#8220;Jell-O&#8221;" id="fig:jello" /></object><figcaption>Figure 10: Percent of menu items per year containing the word &#8220;Jell-O&#8221;</figcaption>
</figure>
<figure>
<object data="images/242a8f0179d5369eece0428dc40c34d25f421627.svg" alt="Figure 11: Percent of menu items per year containing the word &#8220;tofu&#8221;" id="fig:tofu" ><img src="images/242a8f0179d5369eece0428dc40c34d25f421627.svg" alt="Figure 11: Percent of menu items per year containing the word &#8220;tofu&#8221;" id="fig:tofu" /></object><figcaption>Figure 11: Percent of menu items per year containing the word &#8220;tofu&#8221;</figcaption>
</figure>
<p>It is also interesting to look at descriptors. Organic food is rooted in the environmental movement of the &#8217;60s and &#8217;70s, but doesn&#8217;t appear on restaurant menus until the turn of the millennium.</p>
<figure>
<object data="images/465c7e3374dde92e731b828ea2f3f4e57c9f567e.svg" alt="Figure 12: Percent of menu items per year containing the word &#8220;organic&#8221;" id="fig:organic" ><img src="images/465c7e3374dde92e731b828ea2f3f4e57c9f567e.svg" alt="Figure 12: Percent of menu items per year containing the word &#8220;organic&#8221;" id="fig:organic" /></object><figcaption>Figure 12: Percent of menu items per year containing the word &#8220;organic&#8221;</figcaption>
</figure>
<p>Health terms such as &#8220;diet&#8221; show a similar trend, appearing in numbers in the &#8217;70s.</p>
<figure>
<object data="images/b21f5423a476f59753e4714af6e8367e55d951a1.svg" alt="Figure 13: Percent of menu items per year containing health terms  &#160;&#8220;health&#8221; &#160;&#8220;healthy&#8221; &#160;&#8220;diet&#8221; &#160;&#8220;lite&#8221; " id="fig:health" ><img src="images/b21f5423a476f59753e4714af6e8367e55d951a1.svg" alt="Figure 13: Percent of menu items per year containing health terms  &#160;&#8220;health&#8221; &#160;&#8220;healthy&#8221; &#160;&#8220;diet&#8221; &#160;&#8220;lite&#8221; " id="fig:health" /></object><figcaption>Figure 13: Percent of menu items per year containing health terms<br />
<br />
<svg width="20" height="4"><line x1="0" y1="0" x2="20" y2="0" stroke-width="4" stroke="#e7298a" /></svg>&#160;&#8220;health&#8221;<br />
<svg width="20" height="4"><line x1="0" y1="0" x2="20" y2="0" stroke-width="4" stroke="#66a61e" /></svg>&#160;&#8220;healthy&#8221;<br />
<svg width="20" height="4"><line x1="0" y1="0" x2="20" y2="0" stroke-width="4" stroke="#e6ab02" /></svg>&#160;&#8220;diet&#8221;<br />
<svg width="20" height="4"><line x1="0" y1="0" x2="20" y2="0" stroke-width="4" stroke="#a6761d" /></svg>&#160;&#8220;lite&#8221;<br />
</figcaption>
</figure>
<p>We can also use foreign words that commonly appear on menus as a rough proxy for how fashionable those cuisines were in different periods.</p>
<figure>
<object data="images/1d1e57611acc1f871be5269d4c4febffa43f7369.svg" alt="Figure 14: Percent of menu items per year containing foreign prepositions  &#160;au (Fr. &#8216;in the style of&#8217;) &#160;alla (It. &#8216;in the style of&#8217;) &#160;mit (Gm. &#8216;with&#8217;)" id="fig:auallamit" ><img src="images/1d1e57611acc1f871be5269d4c4febffa43f7369.svg" alt="Figure 14: Percent of menu items per year containing foreign prepositions  &#160;au (Fr. &#8216;in the style of&#8217;) &#160;alla (It. &#8216;in the style of&#8217;) &#160;mit (Gm. &#8216;with&#8217;)" id="fig:auallamit" /></object><figcaption>Figure 14: Percent of menu items per year containing foreign prepositions<br />
<br />
<svg width="20" height="4"><line x1="0" y1="0" x2="20" y2="0" stroke-width="4" stroke="#e7298a" /></svg>&#160;<em>au</em> (Fr. &#8216;in the style of&#8217;)<br />
<svg width="20" height="4"><line x1="0" y1="0" x2="20" y2="0" stroke-width="4" stroke="#66a61e" /></svg>&#160;<em>alla</em> (It. &#8216;in the style of&#8217;)<br />
<svg width="20" height="4"><line x1="0" y1="0" x2="20" y2="0" stroke-width="4" stroke="#e6ab02" /></svg>&#160;<em>mit</em> (Gm. &#8216;with&#8217;)</figcaption>
</figure>
<p>A clear post-war interest in French and German cuisine manifests itself&#8212;although the 40% of menu items in 2005 containing <em>mit</em> is more likely an artifact of a small sample than a genuine trend.</p>
</section>
</section>
<section id="modeling" class="level1">
<h1><span class="header-section-number">5</span> Modeling</h1>
<p>The first step is to sample from the data, firstly to correct the class imbalance seen in fig.&#160;2 above, but more importantly, to curtail the incredibly large matrix we would get if we vectorized the entire data frame.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># We want each class to have only as many as the smallest class</span></a>
<a class="sourceLine" id="cb6-2" title="2">sample_size <span class="op">=</span> df.groupby(<span class="st">&quot;decade&quot;</span>)[<span class="st">&quot;name&quot;</span>].count().<span class="bu">min</span>()</a>
<a class="sourceLine" id="cb6-3" title="3"></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co"># Sample randomly from each decade</span></a>
<a class="sourceLine" id="cb6-5" title="5">sample <span class="op">=</span> df.sample(frac<span class="op">=</span><span class="dv">1</span>).groupby(<span class="st">&quot;decade&quot;</span>).head(sample_size)</a></code></pre></div>
<p>Then we define our variables and create train and test classes:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb7-1" title="1"><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3">X <span class="op">=</span> sample[<span class="st">&quot;tokens&quot;</span>]</a>
<a class="sourceLine" id="cb7-4" title="4">y <span class="op">=</span> sample[<span class="st">&quot;decade&quot;</span>]</a>
<a class="sourceLine" id="cb7-5" title="5"></a>
<a class="sourceLine" id="cb7-6" title="6">X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, stratify<span class="op">=</span>y)</a></code></pre></div>
<p>Since the <code>tokens</code> column has already been cleaned, we can it for modeling using <a href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf">tf-idf</a> vectorization, which assigns high scores to words which are highly localized, occurring, say, only in the 1970s and nowhere else. This turns a vector of words into a matrix of tf-idf scores.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb8-1" title="1"><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3">tfidf <span class="op">=</span> TfidfVectorizer()</a>
<a class="sourceLine" id="cb8-4" title="4">X_train_vec <span class="op">=</span> tfidf.fit_transform(X_train)</a>
<a class="sourceLine" id="cb8-5" title="5">X_test_vec <span class="op">=</span> tfidf.transform(X_test)</a></code></pre></div>
<p>Finally, the model itself can be constructed. I use a Gaussian na&#239;ve Bayes classifier, which is standard despite the data not following a Gaussian distribution.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb9-1" title="1"><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> GaussianNB</a>
<a class="sourceLine" id="cb9-2" title="2"></a>
<a class="sourceLine" id="cb9-3" title="3">bayes <span class="op">=</span> GaussianNB().fit(X_train_vec.toarray(), y_train)</a></code></pre></div>
<p>Finally, we assess the accuracy of the model.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb10-1" title="1">bayes.score(X_train_vec.toarray(), y_train)</a>
<a class="sourceLine" id="cb10-2" title="2">bayes.score(X_test_vec.toarray(), y_test)</a></code></pre></div>
<p>The results are pretty disappointing: 77.5% train accuracy and 17.6% test accuracy mean that the model arbitrarily latched onto some words that weren&#8217;t really indicative of their decades. This is due to our miserliness with the data: the model was only allowed to see 0.2% of the menu items. We can fix this by taking the second-lowest class rather than the lowest. This will give us <em>mostly</em> balanced classes, but with fewer in the 1870s, to which only 174 menus are dated.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb11-1" title="1">sample_size <span class="op">=</span> df.groupby(<span class="st">&quot;decade&quot;</span>)[<span class="st">&quot;name&quot;</span>].count().sort_values().iloc[<span class="dv">1</span>]</a></code></pre></div>
<p>The results are more promising: 52.7% train and 21.7% test accuracy. Another consideration is that, since our classes are ordinal, even when the model is wrong, it may only be wrong by a decade or two. We can check this by defining a &#8220;fuzzy accuracy&#8221; score, and seeing how</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">def</span> fuzzy_accuracy(y_true, y_pred, tolerance):</a>
<a class="sourceLine" id="cb12-2" title="2">    <span class="cf">return</span> np.mean(np.<span class="bu">abs</span>(y_true <span class="op">-</span> y_pred) <span class="op">&lt;=</span> tolerance)</a>
<a class="sourceLine" id="cb12-3" title="3"></a>
<a class="sourceLine" id="cb12-4" title="4">fuzzy_accuracy(y_train, bayes.predict(X_train_vec.toarray()), tolerance<span class="op">=</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb12-5" title="5">fuzzy_accuracy(y_test, bayes.predict(X_test_vec.toarray()), tolerance<span class="op">=</span><span class="dv">10</span>)</a></code></pre></div>
<p>We now get 62.7% train and 40.2% test accuracy with a tolerance of one decade. With more memory available, it would be possible to feed more of the dataset into the model, and perhaps create a yet more accurate model.</p>
</section>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>&#8220;Consider the Lobster,&#8221; <em>Gourmet</em>, August 2004, 55.<a href="#fnref1" class="footnote-back">&#8617;</a></p></li>
<li id="fn2"><p>In 2020, $7.85 and $25.29, respectively<a href="#fnref2" class="footnote-back">&#8617;</a></p></li>
<li id="fn3"><p>Retrieved April 27, 2020<a href="#fnref3" class="footnote-back">&#8617;</a></p></li>
<li id="fn4"><p>Or else in what Chesterton called &#8220;a sort of super-French employed by cooks, but quite unintelligible to Frenchmen&#8221;<a href="#fnref4" class="footnote-back">&#8617;</a></p></li>
<li id="fn5"><p>Sampling function borrowed from <a href="https://stackoverflow.com/a/56841648" class="uri">https://stackoverflow.com/a/56841648</a><a href="#fnref5" class="footnote-back">&#8617;</a></p></li>
</ol>
</section>
			</div>
		</article>
	</body>
</html>
